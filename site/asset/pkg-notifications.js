(function(){define("modules/clean/accessibility/tabbable",["jquery"],function(e){return(function(){function t(){t.initialized||this.listen()}return t.initialized=!1,t.prototype.listen=function(){return t.initialized=!0,e(document).on("keydown",(function(t){return function(t){if(9===t.keyCode)return e(document.body).addClass("tabbing")}})(this)),e(document).on("mousedown",(function(t){return function(t){return e(document.body).removeClass("tabbing")}})(this))},t.initialize_module=function(){return new t},t})()})}).call(this),function(){define("modules/clean/components/scooter/badge",["external/classnames","external/react","external/underscore","modules/core/i18n"],function(e,t,n,o){var i,r,a,s,c,u;return c=o._,u=t.DOM,a={TOP_RIGHT:"TOP_RIGHT"},s=Object.freeze(["normal","loud"]),i=t.createClass({statics:{POSITIONS:a,VARIANTS:s},displayName:"Badge",mixins:[t.addons.PureRenderMixin],propTypes:{position:t.PropTypes.oneOf(n.values(a)),variant:t.PropTypes.oneOf(s),isMaestroDesign:t.PropTypes.bool},getDefaultProps:function(){return{variant:"normal",isMaestroDesign:!1}},_getClassNames:function(){return this.props.isMaestroDesign?"maestro-badge":e({"c-badge":!0,"c-badge--top-right":this.props.position===a.TOP_RIGHT,"c-badge--loud":"loud"===this.props.variant})},render:function(){return u.div({className:this._getClassNames(),"aria-hidden":!0},this.props.children)}}),r=t.createClass({statics:{POSITIONS:a,VARIANTS:s},displayName:"CounterBadge",mixins:[t.addons.PureRenderMixin],propTypes:{count:t.PropTypes.number,position:t.PropTypes.oneOf(n.values(a)),variant:t.PropTypes.oneOf(s),maxCount:t.PropTypes.number,isMaestroDesign:t.PropTypes.bool},render:function(){var e,n,o,r,a,s,l;return s=this.props,e=s.count,l=s.variant,a=s.position,r=s.maxCount,n=s.isMaestroDesign,e?(o=null!=r&&e>r?c("%(count)s+",{comment:"label text for a counter badge, for example: 99+"}).format({count:r}):String(e),t.createElement(i,{position:a,variant:l,isMaestroDesign:n},o)):u.div()}}),{Badge:i,CounterBadge:r}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/loggers/folder_invite_impression_logger",["modules/clean/analytics","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/models"],function(t,n,o){var i,r,a,s,c,u,l,d;return c=t.ProEventsLogger,i=n.EventTypes,s=o.NotificationTypes,l=o.SharedFolderInviteOverQuotaStatuses,d={},a=3,u={},u[l.ALREADY_OVER]="view_shared_folder_notification_already_oq",u[l.WILL_BE_OVER]="view_shared_folder_notification_near_oq",r=(function(){function t(){this._handleRenderedNotifications=e(this._handleRenderedNotifications,this)}return t.prototype.listenTo=function(e){return e.addListener(i.RENDERED_NOTIFICATIONS,this._handleRenderedNotifications)},t.prototype.unlistenTo=function(e){return e.removeListener(i.RENDERED_NOTIFICATIONS,this._handleRenderedNotifications)},t.prototype._handleRenderedNotifications=function(e){var t;if(t=e.notifications,!this._hasLoggedOverQuotaImpressions)return this._hasLoggedOverQuotaImpressions=!0,this._logOverQuotaImpressions(t)},t.prototype._logOverQuotaImpressions=function(e){var t,n,o,i,r,l,d;for(l=e.slice(0,a),d=[],n=0,o=l.length;n<o;n++)if(i=l[n],i.type===s.SharedFolderInvite){if(r=i.typeData.overQuotaStatus,t=u[r]){c.log(t);break}d.push(void 0)}else d.push(void 0);return d},t})(),d.FolderInviteImpressionLogger=r,d})}.call(this),define("modules/clean/loggers/notification_tray_logger",["require","exports","modules/clean/ajax"],function(e,t,n){"use strict";function o(e){r({event_name:"tray_popup_shown",badge_count:e})}function i(){r({event_name:"mark_all_as_read"})}function r(e){n.SilentBackgroundRequest({url:"/log/notif_tray_events",data:{event_dict:JSON.stringify(e)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.logTrayOpen=o,t.logMarkAllAsRead=i}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},t=[].slice;define("modules/clean/notserver",["jquery","external/underscore","modules/constants/notserver","modules/core/exception","modules/core/uri","modules/clean/viewer"],function(n,o,i,r,a,s){var c,u,l,d,assert,p,h,f,m;assert=r.assert,c={},u=!1,d="/subscribe",l=(function(){function i(){}return i.prototype.add_notclient=function(e,t){return this.new_notclient(e),setTimeout(function(){return c[e].init(t)},2e3)},i.prototype.new_notclient=function(i){var r,s,l,p,h,f,m,_,g,v,b,y,w,S,N,E,A,T,k,L,C,R,M,q,x,I,U,P,D,O,B,F,j,G,H,W,Q,z,V,Y,K,J;return assert(e.call(c,i)<0,"cannot create more than one notclient per user"),L=function(e){return o.isNumber(e)&&e%1===0&&e>0},k=function(e){return o.isNumber(e)&&e%1===0&&e>=0},assert(L(i),"user_id must be a positive integer"),C=function(){var e;if(e=1<=arguments.length?t.call(arguments,0):[],u)return console.log.apply(console,e)},r=9e4,p=8096,f="user",h="list",E=!1,s=1e3,l=3e5,U=0,z=function(){var e;return e=0===w?0:Math.min(s*Math.pow(2,w-1),l),Math.max(e,U)},x=null,P={},N={},q=1,A=!1,T=!1,J=null,g=!1,B=!1,Y=[],Q=null,y=null,R=null,M={},D=!1,w=0,V=0,K=function(e,t){var n,o,i;o=[];for(n in t)i=t[n],n=parseInt(n,10),assert(L(n),"ns_ids must be positive integers: "+n),assert(k(i),"sjids must be nonnegative integers: "+i),null!=e[n]?o.push(e[n]=Math.min(e[n],i)):o.push(e[n]=i);return o},v=function(){var t,n,r,s;return assert(!o.isEmpty(P),"expected ns_map"),r={host_int:0,trace:window.location.pathname},t=o.pluck(o.values(N),"type"),e.call(t,f)>=0&&(assert(null!=x,"expected nid"),r.user_id=i,r.nid=null!=x?x.replace(/^0+(.)/,"$1"):void 0),e.call(t,h)>=0&&(r.ns_map=(function(){var e;e=[];for(n in P)s=P[n],e.push(n+"_"+s);return e})().join(",")),a.parse(d).updateQuery(r).toString().length>p&&delete r.ns_map,r},b=function(){var e;if(E)return e=z(),e>0?y=window.setTimeout(m,e):B?void 0:m()},m=function(){var e;return assert(!A&&!T,"connect: invalid state"),assert(x>=0||!o.isEmpty(P),"notclient: called connect with nothing to subscribe to"),C("###########################"),e=v(),null!=e.nid||e.ns_map?(C("connecting to notserver..."),A=!0,V+=1,J=n.ajax(d,{data:e,dataType:"json",error:function(){return g?void(g=!1):(w+=1,C("error connecting to notserver. bad rounds="+w+"."),A=!1,b())},success:function(e){return C("notserver connection closed. response:",e),A=!1,null!=e.chillout?(U=1e3*parseInt(e.chillout,10),C("notserver told us to chill for "+U+"ms")):U>0&&(C("setting notserver chillout back to 0ms"),U=0),"punt"===e.ret?b():(assert("new"===e.ret,"unknown notserver ret: "+e.ret),assert("refresh"in e,"expected notserver ret:new to have refresh keyword"),W(e.refresh))}})):void C("nothing to subscribe to. skipping notserver connection.")},_=function(){if(null!=J)return g=!0,J.abort(),J=null},O=function(){return B=!0,_()},H=function(){return O=!1,b()},F=function(){return U=0,A=!1,T=!1,_(),Y=[],window.clearTimeout(Q),window.clearTimeout(y),Q=null,y=null,R=null,M={},D=!1,w=0,b()},G=function(){return E=!1,U=0,x=null,P={},N={},0,q=1,A=!1,T=!1,J=null,g=!1,Y=[],window.clearTimeout(Q),window.clearTimeout(y),Q=null,y=null,R=null,M={},D=!1,w=0,V=0},W=function(t){var n,i,a,s,c,u,l,d;for(assert(!T&&!A,"run_handlers: invalid state"),assert(null===R,"run_handlers: new_nid must start at null"),assert(o.isEqual(M,{}),"run_handlers: new_ns_map must start at {}"),assert(!D,"expected one_or_more_handler_failures=false"),T=!0,C("running handlers..."),l=o.filter(o.values(N),function(n){var o;return o=n.type,e.call(t,o)>=0}),assert(!o.isEmpty(l),"notserver sent a ping for unsubscribed activity"),Y=o.pluck(l,"handler_id"),a=0,s=l.length;a<s;a++)u=l[a],n=u.handler,i=u.handler_id,c=u.name,d=u.type,C("running id="+i+", name="+c+", type="+d),n();return o.isEmpty(Y)?C("all handlers already finished running. no need for a slacker timeout."):(C("all handlers running. slacker timeout set."),Q=window.setTimeout(j,r))},j=function(){var e,t,n,i;for(assert(T&&!A,"called report_slackers in an invalid state."),assert(!o.isEmpty(Y,"report_slackers called w/ nothing slackin'")),C("found some slackers"),D=!0,i=[],t=0,n=Y.length;t<n;t++)e=Y[t],i.push(S(e));return i},S=function(t){if(!(e.call(Y,t)<0))return C("done handling: "+t),Y=o.without(Y,t),o.isEmpty(Y)?(C("all handlers are done running."),T=!1,window.clearTimeout(Q),null!=R&&(C("new nid: "+R),x=R),o.isEmpty(M)||(C("new ns_map:",M),P=M),D?(w+=1,C("one or more handler errors. bad_rounds="+w)):w=0,R=null,M={},D=!1,b()):void 0},I={get_user_id:function(){return i},get_nid:function(){return x},get_ns_map:function(){return o.clone(P)},get_consecutive_bad_rounds:function(){return w},get_total_rounds:function(){return V},get_notserver_chillout_ms:function(){return U},get_sleep_ms:z,subscribe_user:function(t){var n,i,r,a,s,c,u;for(assert(!T,"adding new handlers from inside handlers is not currently supported"),u=["name","handler","nid"],r=0,a=u.length;r<a;r++)c=u[r],assert(t[c],"subscribe_user requires this param be non-falsey: "+c+", "+t[c]);return assert(o.isFunction(t.handler),"handler must be a function"),C("adding user handler "+t.name),i=o.pluck(o.values(N),"type"),s=e.call(i,f)<0,n=q++,N[n]={handler_id:n,handler:t.handler,name:t.name,type:f},(null==x||t.nid<x)&&(x=t.nid,s=!0),s&&(C("first user handler added, reconnecting"),F()),n},subscribe_sfj:function(t){var n,i,r,a,s,c,u;for(assert(!T,"adding new handlers from inside handlers is not currently supported"),u=["name","handler"],r=0,a=u.length;r<a;r++)c=u[r],assert(t[c],"subscribe_sfj requires this param be non-falsey: "+c);return assert(o.isFunction(t.handler),"handler must be a function"),C("adding sfj handler "+t.name),i=o.pluck(o.values(N),"type"),s=e.call(i,h)<0,n=q++,N[n]={handler_id:n,handler:t.handler,name:t.name,type:h},s&&(C("first sfj handler added, reconnecting"),F()),n},unsubscribe:function(e){if(assert(e in N,"no subscribed handler with the given id"),T&&(console.warn("trying to unsubscribe '"+e+"' while is_handling is true"),D=!0,S(e)),delete N[e],o.isEmpty(N))return _()},handler_success:function(t,n){var o;if(!(e.call(Y,t)<0))return o=N[t].type,o===h?(assert("ns_map"in n,"ns_map required param is missing"),assert(!("nid"in n),"nid is disallowed from SFJ handlers"),K(M,n.ns_map)):(assert(o===f,"unknown handler type: "+o),assert("nid"in n,"nid required param is missing"),assert(!("ns_map"in n),"ns_map is disallowed from user handlers"),(null==R||n.nid<R)&&(R=n.nid)),S(t)},handler_failure:function(t){if(C("handler failed. handler_id="+t),!(e.call(Y,t)<0))return D=!0,S(t)},handle_visibility_change:function(){return window.document.hidden?_():F()},init:function(e){return assert(!E,"error: init() has been called twice."),K(P,e),E=!0,null==window.document.visibilityState?b():(document.addEventListener("visibilitychange",this.handle_visibility_change),window.document.hidden?void 0:b())},reset:G,abort:_,pause:O,resume:H,reconnect:F},c[i]=I,I},i})(),l=new l,f=s.get_viewer().get_users();for(p=0,h=f.length;p<h;p++)m=f[p],l.add_notclient(m.id,i.NS_MAP[m.id]);return{NotServer:l,NotClients:c}})}.call(this),function(){define("modules/clean/photos/batch_thumb_loader",["jquery","modules/clean/ajax","modules/core/uri","modules/constants/env"],function(e,t,n,o){return(function(){function i(e){var t,n;t=e.batch_size,n=e.max_parallel_requests,this.on_batch=e.on_batch,this.batch_logger=e.batch_logger,this.on_batch_success=e.on_batch_success,this.batch_size=t||this.DEFAULT_BATCH_SIZE,this.max_parallel_requests=n||this.DEFAULT_MAX_PARALLEL_REQUESTS,this.thumb_url_queue=[],this.batch_queue=[],this.callback_by_id={},this.request_ids_by_url={},this.num_requests_in_flight=0,this.flushing=!1,this.last_thumb_request_id=0,this.next_batch_id=0,this.cancelled_urls={},this.outstanding_batches={},this._request_callback_by_request_id={}}return i.prototype.DEFAULT_BATCH_SIZE=16,i.prototype.DEFAULT_MAX_PARALLEL_REQUESTS=6,i.prototype.MAX_URL_LENGTH=6e3,i.prototype.vend_request_id=function(){return this.last_thumb_request_id++,this.last_thumb_request_id.toString()},i.prototype.queue_thumb=function(t,n,i){var r,a,s,c,u,l,d,p,h,f;if(null==i&&(i={}),h=i.request_id,l=i.onrequest,!t)return null;if(e.support.cors&&o.BATCH_THUMB_ENDPOINTS.length){if(null==h&&(h=this.vend_request_id()),(null!=(d=this.request_ids_by_url[t])?d.length:void 0)>0){s=!1;for(r in this.outstanding_batches)for(p=this.outstanding_batches[r].urls,c=0,u=p.length;c<u;c++)f=p[c],f===t&&(s=!0);s&&"function"==typeof l&&l()}else this.thumb_url_queue.push(t),this.request_ids_by_url[t]=[];return this.request_ids_by_url[t].push(h),this.callback_by_id[h]={url:t,callback:n},this._request_callback_by_request_id[h]=l,this.thumb_url_queue.length>=this.batch_size&&(this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size)),this._send_batch_requests()),h}return"function"==typeof l&&l(),a=!0,"function"==typeof n&&n(t,a),null},i.prototype.cancel_thumb=function(e){var t,n,o,i,r,a,s,c,u,l,d,p,h,f,m,_,g,v,b,y,w,S,N,E,A;if(null!=this.callback_by_id[e]){for(E=this.callback_by_id[e].url,delete this.callback_by_id[e],delete this._request_callback_by_request_id[e],g=this.request_ids_by_url[E],i=s=0,u=g.length;s<u;i=++s)if(r=g[i],r===e){this.request_ids_by_url[E].splice(i,1);break}if(0===this.request_ids_by_url[E].length){for(delete this.request_ids_by_url[E],v=this.thumb_url_queue,i=c=0,l=v.length;c<l;i=++c)if(N=v[i],N===E)return void this.thumb_url_queue.splice(i,1);for(b=this.batch_queue,i=f=0,d=b.length;f<d;i=++f)for(n=b[i],a=m=0,p=n.length;m<p;a=++m)if(N=n[a],N===E)return n.splice(a,1),void(0===n.length&&this.batch_queue.splice(i,1));this.cancelled_urls[E]=1,S=[];for(o in this.outstanding_batches){for(y=this.outstanding_batches[o],A=y.urls,w=y.request,t=!0,_=0,h=A.length;_<h;_++)E=A[_],t=null!=this.cancelled_urls[E]&&t;if(t){w.abort();break}S.push(void 0)}return S}}},i.prototype.flush=function(){for(;this.thumb_url_queue.length;)this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size));return this._send_batch_requests()},i.prototype.reset=function(e){var t;return t=e.batch_size,this.batch_logger=e.batch_logger,this.batch_size=t||this.DEFAULT_BATCH_SIZE},i.prototype.clear=function(){return this.thumb_url_queue=[]},i.prototype.pause=function(){return this.flushing=!1},i.prototype._send_batch_requests=function(){var e,n,o,i,r,a,s,c,u,l,d,p,h,f,m;if(!(0===this.batch_queue.length||this.num_requests_in_flight>=this.max_parallel_requests)){for(this.flushing=!0,f=this.batch_queue.shift(),l=this._generate_request_params(f),i=l[0],u=l[1],o=l[2],"function"==typeof this.on_batch&&this.on_batch(f),r=0,s=f.length;r<s;r++)for(m=f[r],d=this.request_ids_by_url[m],a=0,c=d.length;a<c;a++)h=d[a],"function"==typeof(e=this._request_callback_by_request_id)[h]&&e[h](),delete this._request_callback_by_request_id[h];return n=this.next_batch_id,this.next_batch_id++,this.num_requests_in_flight++,p=t.SilentBackgroundRequest({xhrFields:{withCredentials:!0},url:i,type:u,data:o,success:this._success.bind(this,f),error:this._error.bind(this,f),complete:this._complete.bind(this,n)}),this.outstanding_batches[n]={urls:f,request:p},this._send_batch_requests()}},i.prototype._success=function(e,t){var n,o,i,r,a,s,c,u,l,d,p,h,f,m,_,g,v;for(d=t.split("\n"),p={},i=0,a=e.length;i<a;i++)v=e[i],p[v]=!1;for(l=r=0,s=d.length;r<s;l=++r)u=d[l],f=u.indexOf(":"),f!==-1&&(m=u.substring(0,f).split("-"),o=parseInt(m[0],10),n=u.substring(f+1),v=e[o],p[v]=!0,this._call_callback(v,n),"function"==typeof this.batch_logger&&this.batch_logger(l,e.length));for("function"==typeof this.on_batch_success&&this.on_batch_success(e),_=e.filter(function(e){return!p[e]}),g=[],h=0,c=_.length;h<c;h++)v=_[h],null==this.cancelled_urls[v]?g.push(this._call_callback(v,v)):g.push(void 0);return g},i.prototype._error=function(e){var t,n,o,i;for(o=[],t=0,n=e.length;t<n;t++)i=e[t],o.push(this._call_callback(i,i));return o},i.prototype._complete=function(e){var t,n,o,i,r;for(this.num_requests_in_flight--,o=this.outstanding_batches[e],r=o.urls,o.request,t=0,n=r.length;t<n;t++)i=r[t],delete this.cancelled_urls[i];if(delete this.outstanding_batches[e],this.flushing)return this._send_batch_requests()},i.prototype._call_callback=function(e,t){var n,o,i,r,a;if(n=0===t.indexOf("data:image")?t:e,null!=this.request_ids_by_url[e])for(r=this.request_ids_by_url[e].slice(),o=0,i=r.length;o<i;o++)a=r[o],this.callback_by_id[a]&&(this.callback_by_id[a].callback(n,!1),delete this.callback_by_id[a]);return delete this.request_ids_by_url[e]},i.prototype._generate_request_params=function(t){var i,r,a,s,c,u,l,d;return l=e.map(t,function(e){return n.parse(e).setScheme().setAuthority().toString()}),d=JSON.stringify(l),s=Math.abs(this._hash_string_to_int(d)),r=s%o.BATCH_THUMB_ENDPOINTS.length,i=o.BATCH_THUMB_ENDPOINTS[r],u={image_urls:d,parallel:!0},a=n.parse(i).setQuery(u).toString(),c=a.length>this.MAX_URL_LENGTH?"POST":"GET",[i,c,u]},i.prototype._hash_string_to_int=function(e){var t,n,o,i,r;if(n=0,0===e.length)return n;for(o=i=0,r=e.length;0<=r?i<r:i>r;o=0<=r?++i:--i)t=e.charCodeAt(o),n=(n<<5)-n+t;return n},i})()})}.call(this),define("modules/clean/react/account_menu/account_menu",["require","exports","tslib","external/react","external/reselect","modules/clean/event_handler","modules/clean/react/account_menu/account_menu_view","modules/clean/react/css","modules/core/uri","modules/clean/api_v2/client","modules/clean/react/account_menu/types","modules/clean/react/account_menu/urls","modules/clean/ajax_as_promised","modules/constants/subgrowth_experiments"],function(e,t,n,o,i,r,a,s,c,u,l,d,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=function(){return i.createSelector(function(e){return e.user},function(e){return e.viewer},function(e,t){var n,o=[];if(e.is_team||e.paid)e.is_team||!e.paid||t.role_exists("work")?e.is_team&&t.team_is_limited&&(o=[d.upsellLinks.TRY_BUSINESS]):n=d.upsellLinks.TRY_BUSINESS;else switch(h.SUBGROWTH_BIZ_WEB_CLIENT_DROP_DOWN_REROUTE){case"V1":n=d.upsellLinks.UPGRADE;break;case"V2":n=d.upsellLinks.UPGRADE_PLANS;break;default:n=d.upsellLinks.UPGRADE_BUY}return{quotaBarCTA:n,menuItemUpsells:o}})},m=(function(t){function i(n){var o=t.call(this,n)||this;return o.getUpsellLinks=f(),o.state={accountPhotoUrl:o.props.accountPhotoUrl||o.props.user.photo_circle_url,isDisabled:!0,accountSpaceUsage:{currentStatus:l.AccountSpaceUsageStatus.NOT_APPLICABLE},expSubgrowthProNearquotaMenuSpacebar:null},o.handleChangeAvatar=function(){e(["modules/clean/account_photo_modal/controller"],function(e){return(0,e.AccountPhotoModalController.show)()})},o.mounted=!1,o}return n.__extends(i,t),i.prototype.componentDidMount=function(){var e=this;this.mounted=!0,this.getQuotaData(),this.events.on(document,"db:account_photo:photo_set",function(t,n){var o=c.parse(n.saved_photo_url).updateQuery({size:"64x64"}).toString();e.setState({accountPhotoUrl:o})}),this.events.on(document,"db:account_photo:photo_deleted",function(){e.setState({accountPhotoUrl:null})}),this.setState({isDisabled:!1})},i.prototype.componentWillUnmount=function(){this.mounted=!1},i.prototype.getQuotaData=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,o,i;return n.__generator(this,function(n){switch(n.label){case 0:if(e=this.props.user,e.is_team)return[3,4];this.setState({accountSpaceUsage:{currentStatus:l.AccountSpaceUsageStatus.LOADING}}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.props.apiV2Client.rpc(e.id,"users/get_space_usage")];case 2:return t=n.sent(),this.mounted&&(o=t.used/t.allocation.allocated,o>=.8&&o<1&&this.getExpSubgrowthProNearquotaMenuSpacebar(),this.setState({accountSpaceUsage:{currentStatus:l.AccountSpaceUsageStatus.READY,used:t.used,allocated:t.allocation.allocated}})),[3,4];case 3:return i=n.sent(),this.mounted&&this.setState({accountSpaceUsage:{currentStatus:l.AccountSpaceUsageStatus.NOT_APPLICABLE}}),[3,4];case 4:return[2]}})})},i.prototype.getExpSubgrowthProNearquotaMenuSpacebar=function(){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return[4,p.SilentBackgroundRequest({url:"/get_subgrowth_pro_nearquota_menu_spacebar",dataType:"json",subject_user:this.props.user.id})];case 1:return e=t.sent(),this.mounted&&e&&this.setState({expSubgrowthProNearquotaMenuSpacebar:e.variant}),[2]}})})},i.prototype.render=function(){var e=this.state,t=e.isDisabled,n=e.accountPhotoUrl,i=e.accountSpaceUsage,r=e.expSubgrowthProNearquotaMenuSpacebar,s=this.props,c=s.logoutContinuationPath,u=s.onClick,l=s.showInstallLink,d=s.showProGiftingLink,p=s.showSettingsLink,h=s.user,f=s.viewer,m=this.getUpsellLinks(this.props),_=m.quotaBarCTA,g=m.menuItemUpsells;return o.createElement(a.AccountMenuView,{user:h,viewer:f,accountPhotoUrl:n,disabled:t,accountSpaceUsage:i,quotaBarCTA:_,menuItemUpsells:g,logoutContinuationPath:c,showInstallLink:l,showProGiftingLink:d,showSettingsLink:p,onClickChangeAvatar:this.handleChangeAvatar,onClickTrigger:u,expSubgrowthProNearquotaMenuSpacebar:r})},i})(o.Component);m.defaultProps={accountPhotoUrl:null,showInstallLink:!0,showProGiftingLink:!1,showSettingsLink:!0,apiV2Client:new u.ApiV2Client},m=n.__decorate([r.eventHandler],m);var _=s(m,["/static/css/account_menu_common-vfl4oLKs7.css","/static/css/pagelet-vflBp79rc.css","/static/css/spectrum/index-vflntDanD.css"]);t.AccountMenu=_}),define("modules/clean/react/account_menu/account_menu_view",["require","exports","tslib","external/spectrum/avatar","external/spectrum/account_menu","external/spectrum/button","external/spectrum/popover","external/react","modules/clean/react/account_menu/urls","modules/clean/static_urls","modules/core/i18n","modules/constants/trademark","modules/clean/react/account_menu/types","modules/clean/display_format","modules/constants/account_menu"],function(e,t,n,o,i,r,a,s,c,u,l,d,p,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=function(){return null},_=u.static_url("/static/images/avatar/faceholder-32-vflKWtuU5.png"),g=u.static_url("/static/images/avatar/faceholder-32@2x-vflYmh947.png"),v=function(e){return s.createElement(o.Avatar,{size:e.size,src:e.src||_,srcSet:e.srcSet||(e.src?void 0:g+" 2x"),alt:l._("Account photo")})},b=function(e){return s.createElement(i.AccountMenuItem,n.__assign({target:"_blank",rel:"noopener"},e))},y=function(){return s.createElement(b,{href:c.GIFTING_URL},l._("Gift Dropbox %(trademark_plus)s").format({trademark_plus:d.TRADEMARK_PLUS}))},w=function(e){return s.createElement(i.AccountMenuItem,{href:c.getLogoutUrl(e.continuation)},l._("Sign out"))},S=function(){return s.createElement(b,{href:c.INSTALL_URL},l._("Install"))};t.OverQuotaIcon=function(e){return s.createElement("svg",n.__assign({width:"24px",height:"24px",viewBox:"0 0 24 24"},e),s.createElement("g",{stroke:"none",strokeWidth:"1",fillRule:"evenodd"},s.createElement("g",{transform:"translate(-224.000000, -32.000000)"},s.createElement("g",{transform:"translate(224.000000, 32.000000)"},s.createElement("path",{d:"M16.4822397,17.9600934 C18.6953749,17.9600934 19.6038811,16.3972799 18.5180399,14.4810895 L13.960911,6.43909736 C12.8721172,4.51769655 11.1038811,4.52290698 10.0180399,6.43909736 L5.46091101,14.4810895 C4.37211722,16.4024903 5.27664243,17.9600934 7.4967112,17.9600934 L16.4822397,17.9600934 Z M12.9894755,15.9600934 L10.9894755,15.9600934 L10.9894755,13.9600934 L12.9894755,13.9600934 L12.9894755,15.9600934 L12.9894755,15.9600934 Z M12.9894755,12.9600934 L10.9894755,12.9600934 L10.9894755,8.96009345 L12.9894755,8.96009345 L12.9894755,12.9600934 L12.9894755,12.9600934 Z",id:"Shape"})))))},t.QuotaBar=function(e){var n=e.accountSpaceUsage,o=e.expSubgrowthProNearquotaMenuSpacebar;if(n.currentStatus===p.AccountSpaceUsageStatus.READY){var i=n.used,r=n.allocated,a=l._("%(used)s of %(allocated)s used").format({used:h.format_bytes(i),allocated:h.format_bytes(r)}),c=i<=r&&i/r>=.8;if(i<=r){var u="quota-bar-used",d=void 0,f=void 0,m=void 0;if(c&&"V1"===o){m=s.createElement("span",{className:"ax-visually-hidden"},l._("Almost out of quota")),u+=" quota-bar-used--near-quota";var _=Math.round((r-i)/r*100),g=l._("%(percent_remaining)s remaining").format({percent_remaining:l.format_percent(_)});d=s.createElement("div",{className:"near-quota-warning"},g)}return c&&"V2"===o&&(m=s.createElement("span",{className:"ax-visually-hidden"},l._("Almost out of quota")),u+=" quota-bar-used--near-quota",f=s.createElement(t.OverQuotaIcon,{className:"near-quota-icon"})),s.createElement("div",{className:"quota-bar-container"},s.createElement("div",{className:"quota-bar-empty"},s.createElement("div",{className:u,style:{width:Math.min(100,i/r*100)+"%"}}),d),a,m,f)}return s.createElement("div",{className:"quota-bar-container quota-bar-container--over-quota"},s.createElement("div",{className:"quota-bar-empty"},s.createElement("div",{className:"quota-bar-used quota-bar-used--over-quota"})),a,s.createElement("span",{className:"ax-visually-hidden"},l._("Exceeded account quota")),s.createElement(t.OverQuotaIcon,null))}return s.createElement("div",{className:"quota-bar-container"},s.createElement("div",{className:"quota-bar-empty"}),l._("Loading quota usage..."))};var N=function(e){var t=e.quotaBarCTA,n=t.label,o=t.href;return s.createElement("a",{className:"account-menu-upgrade-link",href:o},n)},E=function(e){return s.createElement(b,{href:e.href},e.label)},A=function(){return f.ACCOUNT_MENU_PAGELET?s.createElement(i.AccountMenuItem,{href:c.SETTINGS_URL},l._("Settings")):s.createElement(i.AccountMenuItem,{target:"_blank",href:c.SETTINGS_URL},l._("Settings"))},T=function(e){var n,o,i=e.accountSpaceUsage,a=e.quotaBarCTA,c=e.expSubgrowthProNearquotaMenuSpacebar;return i&&i.currentStatus!==p.AccountSpaceUsageStatus.NOT_APPLICABLE&&(n=s.createElement(t.QuotaBar,{accountSpaceUsage:i,expSubgrowthProNearquotaMenuSpacebar:c})),null!=a&&(o=s.createElement(N,{quotaBarCTA:a})),s.createElement("div",{className:"account-menu-user-summary"},s.createElement(r.Button,{variant:"circular",className:"account-menu-user-summary__change-avatar",onClick:e.onClickChangeAvatar},s.createElement(v,{size:40,src:e.accountPhotoUrl})),s.createElement("div",{className:"account-menu-user-summary__display-name"},e.userDisplayName),n,o)},k=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleTriggerClick=function(){var e=t.props,n=e.disabled,o=e.onClickTrigger;!n&&o&&o()},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.disabled,n=e.accountPhotoUrl,o=e.accountSpaceUsage,c=e.quotaBarCTA,u=e.menuItemUpsells,d=e.logoutContinuationPath,p=e.showInstallLink,h=e.showProGiftingLink,f=e.showSettingsLink,_=e.user,g=e.onClickChangeAvatar,b=e.expSubgrowthProNearquotaMenuSpacebar,N=_.display_name;return s.createElement(a.Popover,{className:"account-menu",onSelection:m},s.createElement(a.PopoverTrigger,{disabled:t,"aria-label":l._("Account menu")},s.createElement(r.Button,{tagName:"span",onClick:this.handleTriggerClick,disabled:t,variant:"circular"},s.createElement(v,{src:n}))),s.createElement(a.PopoverContent,{attachment:"right"},s.createElement(i.AccountMenuTitle,null,s.createElement(T,{accountPhotoUrl:n,userDisplayName:N,onClickChangeAvatar:g,accountSpaceUsage:o,quotaBarCTA:c,expSubgrowthProNearquotaMenuSpacebar:b})),f&&s.createElement(A,null),p&&s.createElement(S,null),u&&u.map(E),h&&s.createElement(y,null),s.createElement(i.AccountMenuSeparator,null),s.createElement(w,{continuation:d})))},t})(s.PureComponent);t.AccountMenuView=k}),define("modules/clean/react/account_menu/maestro_account_menu",["require","exports","tslib","modules/clean/react/account_menu/account_menu","external/react","modules/constants/browse","modules/constants/payments"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.user,n=e.viewer,s=a.PRO_GIFTING_LINK_VIEWABLE,c=r.SHOW_INSTALL_LINK;return i.createElement(o.AccountMenu,{user:t,viewer:n,dropdownHorizontalDisplacement:-40,showInstallLink:c,showProGiftingLink:s})},t})(i.Component);t.MaestroAccountMenu=s}),define("modules/clean/react/account_menu/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.NOT_APPLICABLE=3]="NOT_APPLICABLE"})(t.AccountSpaceUsageStatus||(t.AccountSpaceUsageStatus={}))}),define("modules/clean/react/account_menu/urls",["require","exports","modules/core/uri","modules/core/i18n","modules/constants/trademark"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLogoutUrl=function(e){return new n({scheme:"https",authority:"www.dropbox.com",path:"/logout",query:e?{cont:e}:void 0}).toString()},t.GIFTING_URL=new n({scheme:"https",authority:"www.dropbox.com",path:"/gift",query:{trigger:"dropdown"}}).toString(),t.INSTALL_URL=new n({scheme:"https",authority:"www.dropbox.com",path:"/install"}).toString(),t.SETTINGS_URL=new n({scheme:"https",authority:"www.dropbox.com",path:"/account"}).toString(),t.upsellLinks={UPGRADE:{label:o._("Upgrade"),href:new n({scheme:"https",authority:"www.dropbox.com",path:"/upgrade",query:{trigger:"direct"}}).toString()},UPGRADE_BUY:{label:o._("Upgrade"),href:new n({scheme:"https",authority:"www.dropbox.com",path:"/buy",query:{trigger:"direct"}}).toString()},UPGRADE_PLANS:{label:o._("Upgrade"),href:new n({scheme:"https",authority:"www.dropbox.com",path:"/plans",query:{trigger:"direct"}}).toString()},TRY_BUSINESS:{label:o._("Try %(trademark_business)s").format({trademark_business:i.TRADEMARK_BUSINESS}),href:new n({scheme:"https",authority:"www.dropbox.com",path:"/business/try",query:{_tk:"dropdown"}}).toString()}}}),define("modules/clean/react/maestro/header_conditions",["require","exports"],function(e,t){"use strict";function n(e){return!e.is_team_assume_user_session}Object.defineProperty(t,"__esModule",{value:!0}),t.showAccountMenu=n}),define("modules/clean/react/maestro/non_pagelet_top_menu_container",["require","exports","tslib","external/react","modules/clean/react/maestro/top_menu_container","modules/clean/react/account_menu/maestro_account_menu","modules/clean/react/css","modules/clean/react/maestro/header_conditions","modules/clean/react/user_notifications/dropdown","modules/clean/viewer"],function(e,t,n,o,i,r,a,s,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderTopMenus=function(e){var t;return e&&(t=o.createElement(r.MaestroAccountMenu,{user:this.props.user,viewer:this.props.viewer})),[o.createElement("div",{className:"notifications-widget-container",key:"notifications-widget"},o.createElement(c.UserNotificationsDropdown,{isMaestroDesign:!0,isPagelet:!1})),o.createElement("div",{className:"account-menu-widget-container",key:"account-menu-widget"},t)]},t.prototype.render=function(){var e=s.showAccountMenu(this.props.viewer),t=e?"":"top-menu-container--account-menu-hidden",r=n.__assign({},this.props,{rightContent:this.renderTopMenus(e),classNames:t});return o.createElement(i.TopMenuContainer,n.__assign({},r))},t})(o.Component);l.defaultProps={viewer:u.get_viewer()},t.NonPageletTopMenuContainer=a(l,["/static/css/pagelet-vflBp79rc.css"],[i.TopMenuContainer,c.UserNotificationsDropdown])}),define("modules/clean/react/maestro/nonpagelet_header",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/viewer","modules/clean/react/maestro/header","modules/clean/react/maestro/non_pagelet_top_menu_container"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getUser=function(){var e=r.get_viewer().get_users();if(0===e.length)throw new Error("No logged in user detected. This header can only be used with a logged in user.");return e[0]},t.prototype.render=function(){var e=o.createElement(s.NonPageletTopMenuContainer,{user:this.getUser(),
showSearchBar:this.props.showSearchBar,isSearchBarExpanded:this.props.isSearchBarExpanded,currentPath:this.props.currentPath,onSearch:this.props.onSearch,onSearchResultOpen:this.props.onSearchResultOpen});return o.createElement("div",{className:"maestro"},o.createElement("div",{className:"maestro-header--without-nav"},o.createElement("header",{className:"maestro-header page-header__shadow"},o.createElement("div",{className:"page-header"},o.createElement(a.MaestroHeaderLogo,null),o.createElement("div",{className:"maestro-header--right-content"},e)))))},t})(o.Component);c.defaultProps={showSearchBar:!1,isSearchBarExpanded:!1};var u=i(c,["/static/css/maestro_header_without_nav-vflAHAovi.css"],[],!0);t.NonPageletMaestroHeader=u}),define("modules/clean/react/user_notifications/actions",["require","exports","modules/clean/bolt","modules/clean/loggers/notification_logger","modules/clean/loggers/notification_tray_logger","modules/clean/notserver","modules/clean/react/user_notifications/api","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/store","modules/clean/referrer_cleansing_redirect"],function(e,t,n,o,i,r,a,s,c,u,l,d){"use strict";return new((function(){function t(){var e=this;this.onUserNotificationUpdate=function(){e.load().then(function(t){var n=e.getBoltChannelStates(t);e.boltClient.update_states(n)},function(){})},this.userNotificationRefreshCallback=function(){e.load().then(function(t){e.boltClient.unsubscribe();var o=e.getBoltChannelStates(t);o.length>0&&(e.boltClient=new n.BoltClient(o,e.onUserNotificationUpdate,e.userNotificationRefreshCallback),e.boltClient.start())},function(){})}}return t.prototype.asyncSharingAction=function(t){e(["modules/clean/react/user_notifications/sharing_actions"],t)},t.prototype.asyncGroupAction=function(t){e(["modules/clean/react/user_notifications/group_actions"],t)},t.prototype.load=function(){return c.userNotificationsDispatcher.dispatch({type:s.ActionTypes.LOAD_REQUEST}),a.getAll(l.userNotificationsStore.getCursor(),this.activeUserOnlyMode).then(function(e){var t=[];return t=t.concat(e.notifications),o.NotificationLogger.logReceive(t),c.userNotificationsDispatcher.dispatch({type:s.ActionTypes.LOAD_SUCCESS,data:e}),e},function(){c.userNotificationsDispatcher.dispatch({type:s.ActionTypes.LOAD_FAILURE})})},t.prototype.loadOnceAndWatch=function(e){var t=this;this.hasLoadedOnce||(this.hasLoadedOnce=!0,this.activeUserOnlyMode=null!=e&&e,this.load().then(function(e){t.watch(e)},function(){}))},t.prototype.acknowledge=function(e){c.userNotificationsDispatcher.dispatch({type:s.ActionTypes.ACKNOWLEDGEMENT_REQUEST_SINGLE,data:{notifications:[e]}}),a.ack(e)},t.prototype.markAllAsSeen=function(){var e=l.userNotificationsStore.getUnseen();0!==e.length&&(a.markAsSeen(e),c.userNotificationsDispatcher.dispatch({type:s.ActionTypes.MARK_AS_SEEN_REQUEST}))},t.prototype.watch=function(e){var t=this;if(e.userNotificationBoltMigration){var o=this.getBoltChannelStates(e);o.length>0&&(this.boltClient=new n.BoltClient(o,this.onUserNotificationUpdate,this.userNotificationRefreshCallback),this.boltClient.start())}else{var i=function(n){if(r.NotClients.hasOwnProperty(n)){var o=r.NotClients[n],i=null,s=window.ensemble;if(s&&s.viewer&&(i=s.viewer.getActiveUser()),!a.activeUserOnlyMode||(null!=i?i.userId:null)===parseInt(n,10))var c=o.subscribe_user({name:"UserNotificationsActions",handler:function(){t.load().then(function(e){o.handler_success(c,{nid:e.cursor[n]})},function(){o.handler_failure(c)})},nid:e.cursor[n]})}},a=this;for(var s in r.NotClients)i(s)}},t.prototype.getBoltChannelStates=function(e){var t=[];for(var o in e.cursor)if(e.cursor.hasOwnProperty(o)){var i=null,r=window.ensemble;if(r&&r.viewer&&(i=r.viewer.getActiveUser()),!this.activeUserOnlyMode||(null!=i?i.userId:null)===parseInt(o,10)){var a=new n.SignedChannelState("user_notification",o,e.cursor[o],e.boltToken[o]);t.push(a)}}return t},t.prototype.acknowledgeAll=function(){0!==l.userNotificationsStore.getUnacknowledgedCount()&&(i.logMarkAllAsRead(),o.NotificationLogger.logMarkAsRead(l.userNotificationsStore.getUnacknowledged(),o.NotificationLocations.TRAY),c.userNotificationsDispatcher.dispatch({type:s.ActionTypes.ACKNOWLEDGEMENT_REQUEST}),a.ackAll(this.activeUserOnlyMode))},t.prototype.viewNotifications=function(){this.markAllAsSeen()},t.prototype.actionPerformed=function(e,t){o.NotificationLogger.logAction(e,t),e.isUnread&&this.acknowledge(e)},t.prototype.triggerGenericLegacyNotificationAction=function(e){this.actionPerformed(e,"click")},t.prototype.dismissLegacySharingNotification=function(e,t){this.actionPerformed(e,"button_1"),this.asyncSharingAction(function(e){e.registerDismiss(t)})},t.prototype.mountFromLegacySharingNotification=function(e,t){this.actionPerformed(e,"button_0"),this.asyncSharingAction(function(e){e.registerMount(t)})},t.prototype.upgradeToMountFromLegacySharingNotification=function(e){this.actionPerformed(e,"button_0"),this.asyncSharingAction(function(e){e.upgradeToMount()})},t.prototype.triggerBluenoteAction=function(e,t,n){this.actionPerformed(e,n),t.actionType===u.BluenoteActionTypes.OpenUrl?this.performBluenoteOpenUrlAction(t.params):t.actionType===u.BluenoteActionTypes.MountSharedFolder?this.asyncSharingAction(function(n){n.performBluenoteMountSharedFolder(e,t.params)}):t.actionType===u.BluenoteActionTypes.ApproveGroupJoinRequest?this.asyncGroupAction(function(n){n.performBluenoteApproveGroupJoinRequestAction(e,t.params)}):t.actionType===u.BluenoteActionTypes.RemoveGroupJoinRequest&&this.asyncGroupAction(function(n){n.performBluenoteRemoveGroupJoinRequestAction(e,t.params)})},t.prototype.performBluenoteOpenUrlAction=function(e){e.urlPath&&d.redirect(e.urlPath)},t})())}),define("modules/clean/react/user_notifications/api",["require","exports","jquery","modules/clean/ajax","modules/clean/react/user_notifications/api_helper"],function(e,t,n,o,i){"use strict";function r(e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r={count:100,template_version:5};null!=e&&(r.last_received_nid_by_user_id=JSON.stringify(e));var a;if(t){if(null===e){var s=window,c=s.__REGISTER_NOTIFICATIONS_PREFETCH_HANDLER;if(c)return c.prefetchDeferred||(c.prefetchDeferred=n.Deferred(),c(function(e){c.prefetchDeferred.resolve(i.parseGetAllResponse(e))},function(){return null})),c.prefetchDeferred}a=o.SilentBackgroundRequest({url:"/web/notifications/retrieve_user",data:r,subject_user:window.ensemble.viewer.getActiveUser().userId,dataType:"json"})}else a=o.SilentBackgroundRequest({url:"/web/notifications/retrieve",data:r,dataType:"json"});return a.then(i.parseGetAllResponse)}function a(e){void 0===e&&(e=!1);var t;return t=e?o.SilentBackgroundRequest({url:"/web/notifications/ack_all_user",subject_user:window.ensemble.viewer.getActiveUser().userId,dataType:"json"}):o.SilentBackgroundRequest({url:"/web/notifications/ack_all",dataType:"json"}),t.then(function(e){return e.map(i.userNotificationDeserializer)})}function s(e){o.SilentBackgroundBeaconRequest({url:"/web/notifications/ack",subject_user:e.userId,data:{nids:JSON.stringify([e.id])},dataType:"json"})}function c(e){for(var t={},n=0,i=e;n<i.length;n++){var r=i[n];r.userId&&r.id&&(t[r.userId]||(t[r.userId]=[])).push(r.id)}var a={nids_by_user_id:JSON.stringify(t)};o.SilentBackgroundRequest({url:"/web/notifications/mark_seen",data:a,dataType:"json"})}Object.defineProperty(t,"__esModule",{value:!0});t.getAll=r,t.ackAll=a,t.ack=s,t.markAsSeen=c}),define("modules/clean/react/user_notifications/avatar_icon",["require","exports","tslib","external/react","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t){var n=e.call(this,t)||this,o=null,i=n.props.avatarIconRecord;return null!=i.avatarUrl&&(o=n.props.thumbStore.get_thumb(i.avatarUrl)),n.state={avatarImage:o},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.bindAvatarUrl(this.props)},t.prototype.componentWillUnmount=function(){this.unbindAvatarUrl()},t.prototype.componentWillReceiveProps=function(e){var t=this.props.avatarIconRecord,n=e.avatarIconRecord;t.avatarUrl!==n.avatarUrl&&(this.unbindAvatarUrl(),this.bindAvatarUrl(e))},t.prototype.bindAvatarUrl=function(e){var t=this,n=e.avatarIconRecord;null!=n.avatarUrl&&(this.thumbRequestId=e.thumbStore.bind_url(n.avatarUrl,{onSuccess:function(){var o=e.thumbStore.get_thumb(n.avatarUrl);t.setState({avatarImage:o})}}))},t.prototype.unbindAvatarUrl=function(){this.props.thumbStore.unbind_url(this.thumbRequestId)},t.prototype.render=function(){var e=this.props.avatarIconRecord;return null!=this.state.avatarImage?o.createElement("img",{className:this.props.className,src:this.state.avatarImage,alt:"",width:this.props.size,height:this.props.size}):o.createElement(i,{name:e.avatarInitials,dimension:this.props.size,initials:e.avatarInitials,shape:"CIRCLE",optionalClass:this.props.className})},t})(o.Component);a.displayName="AvatarIcon",a.defaultProps={size:r.AVATAR_DIMENSION_BY_SIZE.MEDIUM},t.AvatarIcon=a}),define("modules/clean/react/user_notifications/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userNotificationsDispatcher=n}),define("modules/clean/react/user_notifications/dropdown",["require","exports","tslib","external/underscore","external/classnames","external/react","modules/clean/accessibility/tabbable","modules/clean/loggers/notification_logger","modules/clean/loggers/notification_tray_logger","modules/clean/react/bubble_dropdown_v2","modules/clean/react/css","modules/clean/react/title_bubble","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dropdown_bell","modules/clean/react/user_notifications/dropdown_body","modules/clean/react/user_notifications/shared/tray_chrome","modules/clean/react/user_notifications/renderer","modules/clean/react/user_notifications/store","modules/constants/notifications","external/spectrum/popover","modules/core/i18n"],function(e,t,n,o,i,r,a,s,c,u,l,d,p,h,f,m,_,g,v,b,y,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=(function(e){function t(n){var o=e.call(this,n)||this;return o.onTrayMount=function(){c.logTrayOpen(o.state.actionableCount),p.viewNotifications()},o.logRenderWrapper=function(e,t){s.NotificationLogger.logRender(e,t,s.NotificationLocations.TRAY)},o.onMenuToggle=function(e){var n=e.isOpen;o.setState({isOpen:n}),t.requireAsyncModules()},o.state={actionableCount:v.userNotificationsStore.getActionableCount(),notifications:v.userNotificationsStore.getAllVisible(),isStoreLoading:v.userNotificationsStore.isLoading(),isDisabled:!0,isOpen:!1},o}return n.__extends(t,e),t.prototype.componentWillMount=function(){new a},t.prototype.componentDidMount=function(){p.loadOnceAndWatch(this.props.isPagelet),this.removeStoreListener=v.userNotificationsStore.addListener(this.onUpdateFromStore.bind(this)),this.onUpdateFromStore();var e=new g.NotificationRenderer;this.notificationRenderFunc=e.renderNotification.bind(e),this.setState(function(e,t){return e.isDisabled=!1,e})},t.prototype.componentWillUnmount=function(){this.removeStoreListener()},t.prototype.onUpdateFromStore=function(){this.setState(function(e,t){return e.actionableCount=v.userNotificationsStore.getActionableCount(),e.notifications=v.userNotificationsStore.getAllVisible(),e.isStoreLoading=v.userNotificationsStore.isLoading(),e})},t.prototype.render=function(){if(this.props.isMaestroDesign){var e=void 0;e=b.SHARED_TRAY_MODULE_ENABLED?r.createElement("div",{id:"event-feed-container"},r.createElement("div",{id:"event-feed"},r.createElement(_.NotificationsTrayChrome,{unreadSectionTitle:w._("Unread"),readSectionTitle:w._("Recent"),notifications:this.state.notifications,markAllAsReadButtonTitle:w._("Mark All as Read"),markAllAsReadAction:p.acknowledgeAll,isLoading:this.state.isStoreLoading,loadingMessage:w._("Loading ..."),emptyMessage:w._("You donâ€™t have any notifications yet."),notifRenderFunc:this.notificationRenderFunc,notifLogRenderFunc:this.logRenderWrapper,onTrayMount:this.onTrayMount}))):r.createElement(m.UserNotificationsDropdownBody,{isMaestroDesign:!0});var t=r.createElement(y.Popover,{onSelection:o.noop,onMenuToggle:this.onMenuToggle},r.createElement(y.PopoverTrigger,{"aria-label":w._("Notifications menu"),className:"notification-button"},r.createElement(f.UserNotificationsDropdownBell,{isMaestroDesign:!0,actionableCount:this.state.actionableCount,bellDesign:this.props.bellDesign,isSelected:this.state.isOpen})),r.createElement(y.PopoverContent,{attachment:"right",className:"notifications-popover-content"},r.createElement(y.PopoverContentTitle,null,w._("Notifications")),r.createElement("div",{className:"notifications-dropdown"},e)));return this.props.isMaestroDesign&&this.props.bellDesign===h.BellDesignTypes.GRAY_ICON&&(t=r.createElement(d,{content:w._("Notifications"),position:d.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"react-title-bar--title-bubble",isTargetPositionFixed:!0},t)),t}var n,a=i("header-nav-link","sprite-button","notification-button"),s=r.createElement("button",{className:a,title:w._("Notifications menu"),onClick:this.props.onClick,disabled:this.state.isDisabled},r.createElement(f.UserNotificationsDropdownBell,{actionableCount:this.state.actionableCount,isMaestroDesign:!1,bellDesign:this.props.bellDesign}));return n=this.props.accountMenuVisible?u.POSITIONS.BOTTOM_LEFT:u.POSITIONS.BOTTOM_ALIGN_RIGHT,r.createElement(u,{targetButton:s,targetFixed:!0,position:n,className:"no-padding notifications-dropdown"},r.createElement("div",{className:"notifications-header"},w._("Notifications")),r.createElement(m.UserNotificationsDropdownBody,{isMaestroDesign:!1}))},t})(r.Component);S.displayName="UserNotificationsDropdown",S.requireAsyncModules=o.once(function(){return e(["modules/clean/react/user_notifications/sharing_actions"],function(){return null})}),S.defaultProps={isPagelet:!1,isMaestroDesign:!0,accountMenuVisible:!0,bellDesign:h.BellDesignTypes.BLUE_ICON};var N=l(S,["/static/css/components/title_bubble-vfl3yK_gU.css","/static/css/components/bubble_dropdown_v2-vflzxzIjM.css","/static/css/spectrum/index-vflntDanD.css","/static/css/notifications-vflzhhUog.css"]);t.UserNotificationsDropdown=N}),define("modules/clean/react/user_notifications/dropdown_bell",["require","exports","tslib","external/classnames","external/spectrum/icon_global","external/react","modules/clean/components/scooter/badge","modules/clean/react/css","modules/clean/react/sprite","modules/clean/react/user_notifications/constants","modules/core/i18n"],function(e,t,n,o,i,r,a,s,c,u,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(t){var n=e.call(this,t)||this,o=n.props.actionableCount>0;return o&&n.scheduleShakeReset(),n.state={isShaking:o},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){clearTimeout(this.shakeResetTimeout)},t.prototype.componentWillReceiveProps=function(e){e.actionableCount>0&&e.actionableCount!==this.props.actionableCount&&(this.setState({isShaking:!0}),this.scheduleShakeReset())},t.prototype.scheduleShakeReset=function(){var e=this;clearTimeout(this.shakeResetTimeout),this.shakeResetTimeout=setTimeout(function(){e.setState({isShaking:!1})},500)},t.prototype.renderBell=function(){if(this.props.isMaestroDesign)return r.createElement(i.IconGlobal,{name:"notifications",className:"mcl-notifications-icon",selected:this.props.isSelected});var e=o({web:!0,"notifications-bell":!0,shake:this.state.isShaking});return r.createElement(c,{group:"web",name:"notifications_icon_blue",className:e,alt:l._("Notifications")})},t.prototype.renderBadge=function(){return this.props.isMaestroDesign&&this.props.bellDesign!==u.BellDesignTypes.GRAY_ICON?this.props.actionableCount?r.createElement("div",{className:"badge-red-dot"}):null:r.createElement(a.CounterBadge,{count:this.props.actionableCount,maxCount:99,position:a.CounterBadge.POSITIONS.TOP_RIGHT,isMaestroDesign:this.props.isMaestroDesign})},t.prototype.render=function(){var e="";return this.props.actionableCount>0&&(e=l.ungettext("%(count)s new","%(count)s new",this.props.actionableCount,{comment:"new notification count"}).format({count:this.props.actionableCount})),r.createElement("div",{className:"notification-button-bell-container"},r.createElement("span",{className:"ax-visually-hidden"},e),this.renderBell(),this.renderBadge())},t})(r.Component);d.defaultProps={actionableCount:0,isMaestroDesign:!1,bellDesign:u.BellDesignTypes.BLUE_ICON};var p=s(d,["/static/css/scooter/scooter-scoped-vfl8iXN08.css"]);t.UserNotificationsDropdownBell=p}),define("modules/clean/react/user_notifications/dropdown_bluenote_row",["require","exports","tslib","external/classnames","external/purify","external/react","modules/clean/keycode","modules/clean/react/button","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/avatar_icon","modules/clean/react/user_notifications/generic_icon","modules/clean/react/user_notifications/single_task_preview","modules/clean/react/user_notifications/thumbnail_preview"],function(e,t,n,o,i,r,a,s,c,u,l,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleSurfaceAction=function(){var e=n.props.notification,t=e.typeData.surfaceAction;null!=t&&c.triggerBluenoteAction(e,t,"surface")},n.handleKeyDown=function(e){e.keyCode!==a.KeyCode.ENTER&&e.keyCode!==a.KeyCode.SPACE||n.handleSurfaceAction()},n}return n.__extends(t,e),t.prototype.renderNotificationText=function(e){var t=e.typeData.displayMessage;return t?r.createElement("div",{className:"feed-text--button-wrapper"},r.createElement("button",{tabIndex:-1,className:"u-unbutton u-font-left feed-text__button"},r.createElement("div",{className:"feed-text__button-text",dangerouslySetInnerHTML:{__html:i.sanitize(t)}}))):null},t.prototype.renderImage=function(e){var t=e.typeData.icon;return t&&(t.avatarInitials||t.avatarUrl)?r.createElement(u.AvatarIcon,{avatarIconRecord:t,thumbStore:this.props.thumbStore,className:"feed-image feed-image--bluenote"}):r.createElement(l.GenericIcon,{genericIconRecord:t,className:"feed-image feed-image--bluenote"})},t.prototype.renderTimeAndRoleLabel=function(e){if(this.props.hideDisplayTimestamp)return null;var t=e.displayTime;return e.roleLabel&&!this.props.isMaestroDesign&&(t=t+"Â Â·Â "+e.roleLabel),r.createElement("span",{className:"feed-time"},t)},t.prototype.renderPreview=function(e){var t=e.typeData.preview;if(!t)return null;var n=null;t.showThumbnail&&e.bluenoteObject&&(n=r.createElement(p.ThumbnailPreview,{object:e.bluenoteObject}));var o=null;t.tasks&&t.tasks.tasks&&t.tasks.tasks.length>0&&t.tasks.tasks[0]&&(o=r.createElement(d.SingleTaskPreview,{task:t.tasks.tasks[0]}));var i=null;return t.quote&&(i=r.createElement("div",{className:"preview-quote"},t.quote)),r.createElement("div",null,n,o,i)},t.prototype.renderButton=function(e,t,n){return r.createElement(s.button,{className:"notification u-mar-right-xs u-mar-top-xs",importance:n>0?"tertiary":void 0,onClick:function(t){t.target.disabled=!0;var o=(e.typeData.buttonActions||[])[n];c.triggerBluenoteAction(e,o,"button_"+n),t.stopPropagation()}},t)},t.prototype.renderButtonActions=function(e){var t=this,n=[];return(e.typeData.buttonActions||[]).forEach(function(o,i){n.push(t.renderButton(e,o.buttonLabel,i))}),n.length>0?r.createElement("span",{className:"feed-action action-available"},n):null},t.prototype.render=function(){var e=this.props.notification,t=e.typeData;if(!t)return null;var n=o({"feed-row":!0,clickable:null!=t.surfaceAction,read:this.props.isAcknowledged});return r.createElement("div",{onClick:this.handleSurfaceAction,onKeyDown:this.handleKeyDown,className:n,role:"button",tabIndex:0},this.renderImage(e),this.renderNotificationText(e),this.renderPreview(e),this.renderTimeAndRoleLabel(e),this.renderButtonActions(e))},t})(r.Component);h.displayName="UserNotificationsDropdownBluenoteRow",h.defaultProps={isMaestroDesign:!1},t.UserNotificationsDropdownBluenoteRow=h}),define("modules/clean/react/user_notifications/dropdown_body",["require","exports","tslib","external/react","external/react-dom","jquery","modules/clean/loggers/folder_invite_impression_logger","modules/clean/loggers/notification_logger","modules/clean/loggers/notification_tray_logger","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/static_urls","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dropdown_row","modules/clean/react/user_notifications/dropdown_bluenote_row","modules/clean/react/user_notifications/event_emitter","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/store","modules/core/i18n","modules/clean/react/user_notifications/legacy_thumb_loader"],function(e,t,n,o,i,r,a,s,c,u,l,d,p,h,f,m,_,g,v,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUpdateFromStore=function(){t.setStateFromStore(),t.legacyRender()},t.onScroll=function(){t.hasMore&&t.scrollWithinOffsetToBottom(10)&&t.appendNotifications(10)},t.onMouseScroll=function(e){var n=e.originalEvent||e,o=n.detail?n.detail*-40:n.wheelDelta,r=i.findDOMNode(t);!t.hasMore&&o<=0&&t.scrollWithinOffsetToBottom(0)?e.preventDefault():o>=0&&0===r.scrollTop&&e.preventDefault()},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.folderInviteImpressionLogger=new a.FolderInviteImpressionLogger,this.folderInviteImpressionLogger.listenTo(m)},t.prototype.componentDidMount=function(){this.removeStoreListener=g.userNotificationsStore.addListener(this.onUpdateFromStore),this.addEventHandlers(),this.setStateFromStore(),this.legacyRender(),c.logTrayOpen(this.badgeCount),d.viewNotifications()},t.prototype.shouldComponentUpdate=function(){return!1},t.prototype.componentWillUnmount=function(){this.removeStoreListener(),this.folderInviteImpressionLogger.unlistenTo(m)},t.prototype.addEventHandlers=function(){var e=r(i.findDOMNode(this));e.scroll(this.onScroll),e.on("mousewheel",this.onMouseScroll),e.on("DOMMouseScroll",this.onMouseScroll)},t.prototype.setStateFromStore=function(){var e=g.userNotificationsStore.getAll();this.notifications=e.filter(function(e){return!e.isInvisible}),this.isLoading=g.userNotificationsStore.isLoading(),this.badgeCount=g.userNotificationsStore.getActionableCount()},t.prototype.removeNotifications=function(){return r(i.findDOMNode(this)).find("#event-feed").empty(),this.hasMore=this.notifications.length>0},t.prototype.appendNotifications=function(e){var t=r(i.findDOMNode(this)),n=t.find(".feed-row").length,a=this.notifications.slice(n,n+e);s.NotificationLogger.logRender(a,n,s.NotificationLocations.TRAY);for(var c=new u.GenericThumbStore,l=new b.LegacyThumbLoader,d=0,v=a;d<v.length;d++){var y=v[d],w=g.userNotificationsStore.isAcknowledged(y);if(y.rawDropdownRowHtml){var S=document.createElement("div");t.find("#event-feed").append(S),i.render(o.createElement(h,{notification:y,legacyThumbLoader:l,isAcknowledged:w}),S)}else if(y.typeId===_.NotificationTypes.Bluenote){var S=document.createElement("div");t.find("#event-feed").append(S),i.render(o.createElement(f.UserNotificationsDropdownBluenoteRow,{notification:y,thumbStore:c,isMaestroDesign:this.props.isMaestroDesign,isAcknowledged:w}),S)}}var N=n+a.length;this.hasMore=N<this.notifications.length,t.toggleClass("empty",0===N),m.emit(p.EventTypes.RENDERED_NOTIFICATIONS,{notifications:a})},t.prototype.scrollWithinOffsetToBottom=function(e){var t=i.findDOMNode(this);return t.scrollHeight-t.scrollTop-t.offsetHeight<=e},t.prototype.legacyRender=function(){this.isLoading||(this.removeNotifications(),this.appendNotifications(10))},t.prototype.render=function(){return o.createElement("div",{id:"event-feed-container",className:"show"},o.createElement("div",{id:"event-feed"},o.createElement("div",{id:"notification-loading"},o.createElement("img",{src:l.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:v._("Loading...")}))),o.createElement("div",{id:"event-feed-empty"},o.createElement("img",{src:l.static_url("/static/images/empty_notifications-vflQy8YVJ.png"),alt:""}),o.createElement("div",{id:"event-feed-empty-text"},v._("Weâ€™ll let you know when weâ€™ve got something new for you!"))))},t})(o.Component);y.displayName="UserNotificationsDropdownBody",y.defaultProps={isMaestroDesign:!1},t.UserNotificationsDropdownBody=y}),function(){define("modules/clean/react/user_notifications/dropdown_row",["external/react","external/underscore","jquery","modules/clean/datetime","modules/clean/react/user_notifications/legacy_thumb_loader","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/models","modules/clean/sprite"],function(e,t,n,o,i,r,a,s){var c,u,l;return c=i.LegacyThumbLoader,u=a.UserNotification,l=e.DOM.div,e.createClass({displayName:"UserNotificationsDropdownRow",propTypes:{notification:e.PropTypes.instanceOf(u).isRequired,legacyThumbLoader:e.PropTypes.instanceOf(c).isRequired,isAcknowledged:e.PropTypes.bool.isRequired,hideDisplayTimestamp:e.PropTypes.bool},componentDidMount:function(){return this._buildLegacyElement(this.props.notification,this.props.isAcknowledged)},_buildLegacyElement:function(e,t){var o;return o=n(this.refs.dropdownLegacyRow),o.html(e.rawDropdownRowHtml),this._initImages(o),this._setTimeLabel(o,e),this._addClientStateClasses(o,e,t),this._initActionHandlers(e,o),o},_initImages:function(e){return e.find("img").each((function(e){return function(t,o){var i;return i=n(o),i.attr("alt",""),e._loadImage(i)}})(this))},_setTimeLabel:function(e,t){var n;if(n=e.find("#feed-time-label"),null!=n)return this.props.hideDisplayTimestamp?n.text(""):n.text(t.displayTime)},_loadImage:function(e){var n;if(n=e.data("src"))return this.props.legacyThumbLoader.load(n).progress(function(){return e.data("src",null),e.data("loading-src",n)}).then(function(n){var o;return e.data("loading-src",null),o=function(){return e.addClass("thumbnail"),e.parent(".feed-thumbnail").addClass("has-frame")},0===n.indexOf("data:image")?o():(e.load(o),e.error(t.once(function(){var t;return t=e.data("fail-src")||s.SPACER,e.attr("src",t)}))),e.attr("src",n)})},_addClientStateClasses:function(e,t,n){var o;if(o=e.hasClass("feed-row")?e:e.find(".feed-row"),t.isInvisible&&o.addClass("invisible"),n)return o.addClass("read")},_initActionHandlers:function(e,t){return t.on("click",function(){return r.triggerGenericLegacyNotificationAction(e),!0}),t.on("click",".share-content-dismiss",function(){return r.dismissLegacySharingNotification(e,this),!1}),t.on("click",".share-content-mount",function(){return r.mountFromLegacySharingNotification(e,this),!1}),t.on("click",".share-content-upgrade-mount",function(){return r.upgradeToMountFromLegacySharingNotification(e),!1})},render:function(){return l({ref:"dropdownLegacyRow"})}})})}.call(this),define("modules/clean/react/user_notifications/event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";return new n}),define("modules/clean/react/user_notifications/generic_icon",["require","exports","external/react","modules/clean/react/image","modules/clean/static_urls"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericIcon=function(e){var t=e.genericIconRecord,r=null!=t?t.lowResIconUrl:null,a=null!=t?t.highResIconUrl:null;return null!=r&&null!=a||(r=i.static_url("/static/images/icons32/system_notification_default_icon-vflY4Rt4U.png"),a=i.static_url("/static/images/icons64/system_notification_default_icon-vflc0pSwy.png")),n.createElement("div",{className:e.className},n.createElement(o,{src:r,srcHiRes:a}))},t.GenericIcon.displayName="GenericIcon"}),function(){define("modules/clean/react/user_notifications/legacy_thumb_loader",["external/underscore","jquery","modules/clean/photos/batch_thumb_loader"],function(e,t,n){var o,i,r,a;return r=16,i=24,a={},o=(function(){function o(){var t;this._cache={},t=new n({batch_size:r,max_parallel_request:i}),this._queueThumb=function(e,n,o){return t.queue_thumb(e,n,{onrequest:o})},this._flushQueue=e.debounce(function(){return t.flush()},0)}return o.prototype.load=function(e){var n;return this._cache[e]||(n=new t.Deferred,this._queueThumb(e,n.resolve,n.notify),this._flushQueue(),this._cache[e]=n.promise()),this._cache[e]},o})(),a.LegacyThumbLoader=o,a})}.call(this),define("modules/clean/react/user_notifications/renderer",["require","exports","external/react","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/user_notifications/dropdown_bluenote_row","modules/clean/react/user_notifications/dropdown_row","modules/clean/react/user_notifications/legacy_thumb_loader","modules/clean/react/user_notifications/models"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(){this.legacyThumbLoader=new a.LegacyThumbLoader,this.genericThumbStore=new o.GenericThumbStore}return e.prototype.renderNotification=function(e,t){return e.rawDropdownRowHtml?n.createElement(r,{notification:e,legacyThumbLoader:this.legacyThumbLoader,isAcknowledged:t,hideDisplayTimestamp:!0}):e.typeId===s.NotificationTypes.Bluenote?n.createElement(i.UserNotificationsDropdownBluenoteRow,{notification:e,isMaestroDesign:!0,thumbStore:this.genericThumbStore,hideDisplayTimestamp:!0,isAcknowledged:t}):null},e})();t.NotificationRenderer=c}),define("modules/clean/react/user_notifications/shared/notification_row_wrapper",["require","exports","tslib","external/classnames","external/react","modules/clean/react/css"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={hover:!1},n.onMouseOver=n.onMouseOver.bind(n),n.onMouseOut=n.onMouseOut.bind(n),n}return n.__extends(t,e),t.prototype.onMouseOver=function(){this.setState({hover:!0})},t.prototype.onMouseOut=function(){this.setState({hover:!1})},t.prototype.renderInfoSheet=function(){var e=o({"notification-row-info-sheet":!0,"notification-row-info-sheet--visible":this.state.hover,"notification-row-info-sheet--unread":this.props.unread});return i.createElement("div",{className:e},i.createElement("div",{className:"notification-row-info-sheet--timestamp"},this.props.timestamp))},t.prototype.render=function(){return i.createElement("div",{className:"notification-row-wrapper",onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut},this.renderInfoSheet(),this.props.row)},t})(i.Component),s=r(a,["/static/css/user_notifications_shared-vfl7-5C1-.css"]);t.NotificationRowWrapper=s}),define("modules/clean/react/user_notifications/shared/tray_chrome",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/css","modules/clean/react/user_notifications/shared/tray_section"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){var n=e.call(this,t)||this;n.handleOnScroll=function(){n.scrollWithinOffsetToBottom(10)&&(n.logRendersForPage(n.state.visiblePages),n.setState({visiblePages:n.state.visiblePages+1}))},n.handleOnWheel=function(e){var t=e.originalEvent||e,o=t.deltaY?t.deltaY*-40:t.wheelDelta,r=i.findDOMNode(n);o<=0&&n.scrollWithinOffsetToBottom(0)?e.preventDefault():o>=0&&0===r.scrollTop&&e.preventDefault()};var o=n.processNotifications(n.props.notifications);return n.state={visiblePages:1,unreadNotifications:o.unreadNotifications,readNotifications:o.readNotifications},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.onTrayMount(),this.logRendersForPage(0)},t.prototype.processNotifications=function(e){
var t=this.state&&this.state.unreadNotifications||[],n={};t.forEach(function(e){return n[e.key]=!0});var o=[],i=[];return e.forEach(function(e){e.isUnread||n[e.key]?o.push(e):i.push(e)}),{unreadNotifications:o,readNotifications:i}},t.prototype.logRendersForPage=function(e){var t=this.state.unreadNotifications.concat(this.state.readNotifications).slice(10*e,10*(e+1));this.props.notifLogRenderFunc(t,10*e)},t.prototype.shouldComponentUpdate=function(e,t,n){return!(e.isLoading&&!this.props.isLoading)},t.prototype.componentWillReceiveProps=function(e,t){this.setState(this.processNotifications(e.notifications))},t.prototype.scrollWithinOffsetToBottom=function(e){var t=i.findDOMNode(this);return t.scrollHeight-t.scrollTop-t.offsetHeight<=e},t.prototype.render=function(){if(this.props.isLoading)return o.createElement("div",{className:"notifications-tray--loading"},this.props.loadingMessage);if(0===this.state.unreadNotifications.length&&0===this.state.readNotifications.length)return o.createElement("div",{className:"notifications-tray--empty"},this.props.emptyMessage);var e=this.state.unreadNotifications.slice(0,10*this.state.visiblePages),t=this.state.readNotifications.slice(0,10*this.state.visiblePages-e.length);return o.createElement("div",{className:"notifications-tray--loaded",onScroll:this.handleOnScroll,onWheel:this.handleOnWheel},o.createElement(a.NotificationsTraySection,{notifications:e,sectionTitle:this.props.unreadSectionTitle,actionButtonText:this.props.markAllAsReadButtonTitle,actionButtonAction:this.props.markAllAsReadAction,notifRenderFunc:this.props.notifRenderFunc,isUnreadSection:!0}),o.createElement(a.NotificationsTraySection,{notifications:t,sectionTitle:this.props.readSectionTitle,notifRenderFunc:this.props.notifRenderFunc,isUnreadSection:!1}))},t})(o.Component);s.displayName="NotificationsTrayChrome";var c=r(s,["/static/css/user_notifications_shared-vfl7-5C1-.css"]);t.NotificationsTrayChrome=c}),define("modules/clean/react/user_notifications/shared/tray_section",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/user_notifications/shared/notification_row_wrapper"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t){var n=e.call(this,t)||this;return n.onClickActionButton=n.onClickActionButton.bind(n),n}return n.__extends(t,e),t.prototype.onClickActionButton=function(){this.props.actionButtonAction&&this.props.actionButtonAction()},t.prototype.renderReadSectionHeader=function(){var e=null;return this.props.actionButtonText&&(e=o.createElement("button",{className:"notifications-tray-section-header--button",onClick:this.onClickActionButton},this.props.actionButtonText)),o.createElement("div",{className:"notifications-tray-section-header"},o.createElement("span",{className:"notifications-tray-section-header--title"},this.props.sectionTitle),e)},t.prototype.render=function(){if(0===this.props.notifications.length)return null;for(var e=[],t=0,n=this.props.notifications;t<n.length;t++){var i=n[t],a=this.props.notifRenderFunc(i,!i.isUnread);null!=a&&e.push(o.createElement(r.NotificationRowWrapper,{row:a,timestamp:i.displayTime,unread:i.isUnread}))}return o.createElement("div",null,this.renderReadSectionHeader(),e)},t})(o.Component),s=i(a,["/static/css/user_notifications_shared-vfl7-5C1-.css"]);t.NotificationsTraySection=s}),define("modules/clean/react/user_notifications/single_task_preview",["require","exports","tslib","external/classnames","external/spectrum/checkbox","external/react"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.task,t=e.isComplete?"checked":"unchecked",n=o({"preview-single-task--text":!0,"preview-single-task--text--complete":e.isComplete});return r.createElement("div",{className:"preview-single-task"},r.createElement("div",null,r.createElement(i.Checkbox,{className:"preview-single-task--checkbox",checked:t,disabled:!0})),r.createElement("div",{className:n},e.name))},t})(r.Component);t.SingleTaskPreview=a}),define("modules/clean/react/user_notifications/store",["require","exports","tslib","external/underscore","modules/clean/flux/flux_store","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/api_helper"],function(e,t,n,o,i,r,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(t){var n=e.call(this,t)||this;return n.isAcknowledged=function(e){return e.isRead},n.markNotificationAsReadLocally=function(e){e.isUnread&&(e.status=s.NotificationStatuses.Read)},n.isLoadingFlag=!1,n.userNotifications=[],n}return n.__extends(t,e),t.prototype.isLoading=function(){return this.isLoadingFlag},t.prototype.getActionableCount=function(){return this.getUnseenInternal().length},t.prototype.getUnacknowledgedCount=function(){return this.getUnacknowledgedInternal().length},t.prototype.getCursor=function(){return this.cursor},t.prototype.getAll=function(){return this.userNotifications},t.prototype.getAllVisible=function(){return this.userNotifications.filter(function(e){return!e.isInvisible})},t.prototype.getUnacknowledged=function(){return this.getUnacknowledgedInternal()},t.prototype.getUnacknowledgedInternal=function(){return this.userNotifications.filter(function(e){return e.isUnread})},t.prototype.getUnseen=function(){return this.getUnseenInternal()},t.prototype.getUnseenInternal=function(){return this.userNotifications.filter(function(e){return!e.isSeen})},t.prototype.onLoadRequest=function(){this.isLoadingFlag||(this.isLoadingFlag=!0,this.__emitChange())},t.prototype.onLoadSuccess=function(e){if(this.isLoadingFlag&&(this.isLoadingFlag=!1,this.__emitChange()),o.isEqual(e.cursor,this.cursor)||(this.cursor=e.cursor,this.__emitChange()),e.notifications.length>0){var t={};e.notifications.concat(this.userNotifications).forEach(function(e){t[e.key]||(t[e.key]=e)}),this.userNotifications=o.values(t).sort(c.userNotificationComparator),this.__emitChange()}},t.prototype.onLoadFailure=function(){this.isLoadingFlag&&(this.isLoadingFlag=!1,this.__emitChange())},t.prototype.onAcknowledgementRequest=function(){this.userNotifications.forEach(this.markNotificationAsReadLocally),this.__emitChange()},t.prototype.onAcknowledgementRequestSingle=function(e){this.markNotificationAsReadLocally(e),this.__emitChange()},t.prototype.onMarkAsSeenRequest=function(){this.userNotifications.forEach(function(e){e.isSeen||(e.seenState=s.NotificationSeenState.Seen)}),this.__emitChange()},t.prototype.__onDispatch=function(e){switch(e.action.type){case r.ActionTypes.LOAD_REQUEST:this.onLoadRequest();break;case r.ActionTypes.LOAD_SUCCESS:this.onLoadSuccess(e.action.data);break;case r.ActionTypes.LOAD_FAILURE:this.onLoadFailure();break;case r.ActionTypes.ACKNOWLEDGEMENT_REQUEST:this.onAcknowledgementRequest();break;case r.ActionTypes.ACKNOWLEDGEMENT_REQUEST_SINGLE:this.onAcknowledgementRequestSingle(e.action.data.notifications[0]);break;case r.ActionTypes.MARK_AS_SEEN_REQUEST:this.onMarkAsSeenRequest()}},t})(i);t.UserNotificationsStore=u,t.userNotificationsStore=new u(a.userNotificationsDispatcher)}),define("modules/clean/react/user_notifications/thumbnail_preview",["require","exports","tslib","external/react","modules/clean/static_urls"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={"paper-pad":"paper_doc_32","paper-folder":"folder_paper_team_32","dropbox-file":"page_white_gray_32","dropbox-folder":"folder_32"},a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.object;if(!e||!e.type||!e.name)return null;var t=e.thumbnailUrl;if(!t){var n=r[e.type];if(!n)return null;t=i.static_url("/static/images/sprites/file_icons_32/"+n+".png")}return o.createElement("div",{className:"preview-thumbnail--wrapper"},o.createElement("div",{className:"preview-thumbnail"},o.createElement("img",{className:"preview-thumbnail--icon",src:t,alt:""}),o.createElement("div",{className:"preview-thumbnail--text"},e.name)))},t})(o.Component);a.displayName="ThumbnailPreviewLegacy",t.ThumbnailPreview=a}),function(){define("modules/clean/sprite",["jquery","modules/core/html","modules/clean/static_urls"],function(e,t,n){var o;return o=n.static_url,{SPACER:o("/static/images/icons/icon_spacer-vflN3BYt2.gif"),CLASS_PREFIX:"s_",_make_class:function(e,t){return this.CLASS_PREFIX+e+"_"+t},src:function(t,n,o){return this.clear(t),e(t).addClass(this._make_class(n,o))},replace:function(t,n,o,i){return e(t).removeClass(this._make_class(n,o)).addClass(this._make_class(n,i))},clear:function(t){var n;return n=t.className.split(" "),n=e.grep(n,(function(e){return function(t){return t&&0!==t.indexOf(e.CLASS_PREFIX)}})(this)),t.className=n.join(" ")},make:function(t,n,o){var i;return o=this._prep_attrs(t,n,o),i=e("<img />",o),i[0]},html:function(e,n,o){var i,r;o=this._prep_attrs(e,n,o),i=["<img "];for(r in o)i.push(r,'="',t._raw_escape(o[r]),'" ');return i.push("/>"),new t(i.join(""))},_prep_attrs:function(e,t,n){var o;return null==n&&(n={}),n.src=n.src||this.SPACER,o=["sprite","sprite_"+e,this._make_class(e,t)],n.class&&o.push(n.class),n.class=o.join(" "),n},_get:function(e){return e.className},_set:function(e,t){return e.className=t,e.src=this.SPACER}}})}.call(this);
//# sourceMappingURL=pkg-notifications.min.js-vflc-qMCR.map