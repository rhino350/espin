define("modules/clean/admin/megaphone/prompt/api/utils",["require","exports","external/underscore"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){var e=function(t){return t.replace(/_(.)/g,function(t,e){return e.toUpperCase()})},n=function(t){return t.replace(/([a-z\d])([A-Z0-9])/g,function(t,e,i){return e+"_"+i.toLowerCase()})},o=function(t,e){if(null===e)return null;if(Array.isArray(e)){var i=[];return e.forEach(function(e){i.push(o(t,e))}),i}if("object"==typeof e){var n={};return Object.keys(e).forEach(function(i){n[t(i)]=o(t,e[i])}),n}return e},r=function(t,e){return o(t,e)},s=function(t){var e={},o=r(n,t);return i.each(i.keys(o),function(t){o[t]&&o[t].id?e[t]=o[t].id:e[t]=o[t]}),e.approved=!(!e.approved_time&&!e.approved_user),delete e.approved_time,delete e.approved_user_id,e.start_time_enabled=null!==e.ad&&null!==e.ad.start_time,e.end_time_enabled=null!==e.ad&&null!==e.ad.end_time,e.remind_me_later_enabled=null!==e.remind_me_later_type,e.remind_me_later_enabled||(e.remind_me_later_type=null,e.remind_me_later_delay=null),i.each(i.keys(e),function(t){"boolean"==typeof e[t]&&(e[t]=e[t]?"on":"off")}),e.upsell_promo_spec=e.cash_promo,delete e.cash_promo,delete e.id,delete e.created_time,delete e.promo_params,delete e.updated_time,delete e.user,delete e.locale,e};t.requestDataFromCampaignAndVersion=function(t,e){var o=s(t),a=r(n,e.content);delete o.content;var c=["modal_type"];return i.each(i.keys(a),function(t){if(i.contains(c,t))o[t]=a[t];else{if(null===a[t])return;var e=void 0;e=Array.isArray(a[t])?a[t].join("\n"):a[t],o["content["+t+"]"]=e}}),o.stormcrow_variant=e.stormcrowVariant,"content[image_url]"in o&&(o["content[image]"]=o["content[image_url]"],delete o["content[image_url]"]),"content[cancel_with_xIcon]"in o&&(o["content[cancel_with_x_icon]"]=o["content[cancel_with_xIcon]"],delete o["content[cancel_with_xIcon]"]),i.each(i.keys(o),function(t){"boolean"==typeof o[t]&&(o[t]=o[t]?"on":"off")}),o},t.toCamelCase=function(t){return r(e,t)},t.jsonToCamelCase=function(e){var i=JSON.parse(e);return t.toCamelCase(i)},t.stringToCamelCase=function(t){return e(t)}})(e.APIUtils||(e.APIUtils={}))}),define("modules/clean/ajax_minimal",["require","exports"],function(t,e){"use strict";function i(t){var e=document.cookie.match("(^|; )"+t+"=([^;]*)");return e?e[2]:""}function n(t,e){var n=new XMLHttpRequest;n.open("POST",t),n.withCredentials=!0,n.setRequestHeader("X-CSRF-Token",i("__Host-js_csrf")),n.send(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.post=n}),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/deprecated/uirequest",["jquery","external/underscore","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/css","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/dbmodal","modules/pagelet_config"],function(e,i,n,o,r,s,a,c,p,l){var u,d,_;return _=o._,u=p.DBModal,d=l.REQUIREJS_CONFIG,(function(){function o(e,n,o){if(this.$node=e,this.url=n,this.options=null!=o?o:{},this.complete=t(this.complete,this),this.handle_errors=t(this.handle_errors,this),this.error=t(this.error,this),this.perform_actions=t(this.perform_actions,this),this.success=t(this.success,this),this.shouldDelayComplete=!1,this.$node.hasClass("ajax-loading"))return!1;this.$node.addClass("ajax-loading"),s.FormWebRequest({url:this.url,type:null!=this.options.type?this.options.type:void 0,data:this.options.data||{},success:this.success,error:this.error,complete:this.complete,subject_user:this.options.subject_user,headers:i.extend({"X-RequireJS-Context":d.context,"X-UIRequest-Version":3},this.options.headers)})}return o.prototype.success=function(t,e,i){var n,o,r;return(r=c.extract_errors(i.responseText))?(this.handle_errors(r),void("function"==typeof(n=this.options).error&&n.error(i,e))):(t=JSON.parse(i.responseText),t.redirect?void(window.location.href=t.redirect):t.reload?void window.location.reload():(this.shouldDelayComplete=t.js||t.css,this.shouldDelayComplete?a.require_css_multi(t.css,(function(n){return function(){var o,r;return n.perform_actions(t.actions||[]),"function"==typeof(o=n.options).success&&o.success(t,e,i),n.$node.removeClass("ajax-loading"),"function"==typeof(r=n.options).complete?r.complete(i,e):void 0}})(this)):(this.perform_actions(t.actions||[]),void("function"==typeof(o=this.options).success&&o.success(t,e,i)))))},o.prototype.perform_actions=function(t){var i,o,s,a,c,p,l,d,_,m,h,f;for(m=[],c=0,p=t.length;c<p;c++)switch(o=t[c],a=o[0],s=o[1],f=o[2],i=this.$node,f&&"modal"!==a&&("^"===f.charAt(0)&&(d=f.split(" "),i=i.closest(d[0].substr(1)),f=d.slice(1).join(" ")),f&&(i=i.find(f).filter(":first"))),a){case"modal":_="db-modal-response-modal-placeholder",e("#"+_).remove(),h=e(s),h.attr("id",_),e("body").append(h),l=new u({element_id:"response-modal-placeholder"}),m.push(l.show());break;case"html":m.push(i.html(s));break;case"replaceWith":m.push(i.replaceWith(s));break;case"after":s?m.push(i.after(s)):m.push(void 0);break;case"before":s?m.push(i.before(s)):m.push(void 0);break;case"toggleClass":m.push(i.toggleClass(s));break;case"addClass":m.push(i.addClass(s));break;case"removeClass":m.push(i.removeClass(s));break;case"notify":m.push(r.success(s));break;case"notifyError":m.push(r.error(new n(s),this.options.errorDuration||void 0));break;default:m.push(void 0)}return m},o.prototype.error=function(t,e,i){var n,o;return o=c.extract_errors(t.responseText),"abort"!==e&&this.handle_errors(o),"function"==typeof(n=this.options).error?n.error(t,e,i):void 0},o.prototype.handle_errors=function(t){var e;return t===!1?r.error(_("There was a problem completing this request.")):"string"==typeof t?(e=this.options.html_in_error_msg?new n(t):t,r.error(e)):c.fill_errors(this.$node,t)},o.prototype.complete=function(t,e){var i;if(!this.shouldDelayComplete)return this.$node.removeClass("ajax-loading"),"function"==typeof(i=this.options).complete?i.complete(t,e):void 0},o})()})}.call(this),define("modules/clean/js_basic_stopwatch",["require","exports","modules/core/exception"],function(t,e,i){"use strict";function n(t,i,n,o){return r?new a(t,i,n,o):e.NoopStopwatchInstance}Object.defineProperty(e,"__esModule",{value:!0});var o,r=!(!window.performance||!window.performance.now),s=0;(function(t){t[t.Span=1]="Span",t[t.AsyncSpan=2]="AsyncSpan",t[t.Trace=3]="Trace"})(o=e.TimingDataType||(e.TimingDataType={}));var a=(function(){function t(t,e,i,n){this.stopwatchName=t,this.strictAssert=e,this.reportSpanFn=i,this.activeSpans={},this.spanStack=[],this.stopwatchTags=n||[]}return t.prototype.reset=function(){this.activeSpans={},this.spanStack=[]},t.prototype.newSpanID=function(){var t=String(s);return s++,t},t.prototype._resolveTime=function(t){return void 0===t&&(t=window.performance.now()),Math.round(t)},t.prototype._resolveParent=function(t){if(t.type!==o.Span)return void(t.parent="");var e=this.spanStack[this.spanStack.length-1];if(e)if(e!==t.name)this._report_sw_misuse("Closing "+e+" while the latest open span is "+t.name+".\n        You are either mixing sync and async spans or closing sync spans out of order.");else{this.spanStack.pop();for(var i="",n=0,r=this.spanStack;n<r.length;n++){var s=r[n];i+=s+"#"}t.parent=i}else this._report_sw_misuse(t.name+' isn\'t a synchronous span and has to be started with "async:true".')},t.prototype.recordTrace=function(t,e){void 0===e&&(e={});var i=this._resolveTime(e.traceTime),n=this.newSpanID(),r=e.annotations||{},s={name:t,span_id:n,start_time:0,end_time:i,annotations:r,type:o.Trace,parent:""};return this.reportSpanFn&&this.reportSpanFn(this.stopwatchName,this.stopwatchTags,s),n},t.prototype.start=function(t,e){void 0===e&&(e={}),t||this._report_sw_misuse("Reporting a span without a name");var i=this._resolveTime(e.startTime);e.async||this.spanStack.push(t);var n=this.newSpanID(),r={name:t,span_id:n,start_time:i||0,annotations:{},type:e.async?o.AsyncSpan:o.Span};return t in this.activeSpans||(this.activeSpans[t]=[]),this.activeSpans[t].push(r),n},t.prototype.end=function(t,e){void 0===e&&(e={});var i=this.findTimerDataIndex(t,e.spanId);if(i!==-1){var n=this.activeSpans[t],o=n[i];n.splice(i,1),this._resolveParent(o);var r=this._resolveTime(e.endTime);return r<o.start_time?void this._report_sw_misuse("span "+t+" has set an endTime earlier than start_time"):(o.end_time=r,this.reportSpanFn&&this.reportSpanFn(this.stopwatchName,this.stopwatchTags,o),o.span_id)}},t.prototype.addSpanAnnotation=function(t,e,i,n){var o=this.findTimerDataIndex(t,n);if(o!==-1){this.activeSpans[t][o].annotations[e]=i}},t.prototype.findTimerDataIndex=function(t,e){if(!(t in this.activeSpans)||0===this.activeSpans[t].length)return this._report_sw_misuse("tried to find "+t+" but that span doesn't exist"),-1;var i=-1,n=this.activeSpans[t];if(void 0===e)i=0;else for(var o=0;o<n.length;o++)if(n[o].span_id===e){i=o;break}return i===-1&&this._report_sw_misuse("tried to find "+t+" with id "+e+" but that span doesn't exist"),i},t.prototype._report_sw_misuse=function(t){t="JSBasicStopwatch "+this.stopwatchName+": "+t,this.strictAssert?i.assert(!1,t):i.reportStack(t,{severity:i.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},t})();e.JSBasicStopwatchImpl=a;var c=(function(){function t(){}return t.prototype.reset=function(){},t.prototype.start=function(t,e){void 0===e&&(e={})},t.prototype.end=function(t,e){void 0===e&&(e={})},t.prototype.recordTrace=function(t,e){void 0===e&&(e={})},t.prototype.addSpanAnnotation=function(t,e,i,n){},t})();e.NoopStopwatchInstance=new c,e.createStopwatch=n}),define("modules/clean/js_client_stopwatch",["require","exports","modules/core/xhr","modules/clean/js_basic_stopwatch","modules/constants/request","modules/core/browser","modules/core/exception"],function(t,e,i,n,o,r,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=(function(){function t(t){this.id=t}return t})();a.REQUEST_ID=new a("dropbox.js_client_stopwatch.request_id"),a.CORRELATION_ID=new a("dropbox.js_client_stopwatch.correlation_id"),a.URL=new a("dropbox.js_client_stopwatch.url");var c=(function(){function t(){var t=this;this.GLOBAL_SW_NAME="GLOBAL_STOPWATCH",this.flush_interval=6e4,this.strictAssert=!1,this.intervalId=null,this._report_span_fn=function(e,i,o){e in t.storedAggregates||(t.storedAggregates[e]={});var r=t.storedAggregates[e],s=""+o.parent+o.name;s in r||(r[s]={name:o.name,start_time:o.start_time,total_time:0,num_calls:0,annotations:{},parent:o.parent||"",stopwatch_tags:i.length>0?i:void 0,type:o.type});var a=r[s];if(void 0===o.end_time)return void t._report_sw_misuse("Span "+s+" reported with undefined end_time");a.type===n.TimingDataType.Trace?(a.total_time=o.end_time-o.start_time,a.num_calls=1):(a.total_time+=o.end_time-o.start_time,a.num_calls+=1);for(var c in o.annotations)o.annotations.hasOwnProperty(c)&&(a.annotations[c]=o.annotations[c])},this.reset()}return t.prototype.reset=function(){this.stopwatches={},this.sentInitialData=!1,this.create_stopwatch(this.GLOBAL_SW_NAME),this.storedAggregates={},this.intervalId&&clearInterval(this.intervalId),this.intervalId=null},t.prototype.reset_individual_stopwatch=function(t){if(!this.stopwatch_exists(t))return void this._report_sw_misuse("tried to reset the stopwatch "+t+" but it does not exist");this.stopwatches[t].reset()},t.prototype.stopwatch_exists=function(t){return t in this.stopwatches},t.prototype.create_stopwatch=function(t,e){if(this.stopwatch_exists(t))return void this._report_sw_misuse("tried to create a new stopwatch "+t+" but it already exists");this.stopwatches[t]=n.createStopwatch(t,this.strictAssert,this._report_span_fn,e)},t.prototype.createDetachedStopwatch=function(t,e){return void 0===e&&(e={}),new p(t,this._report_span_fn,e.request_id,e.correlation_id,e.url,e.tags)},t.prototype.create_stopwatch_if_not_exist=function(t,e){this.stopwatch_exists(t)||this.create_stopwatch(t,e)},t.prototype.getStopwatch=function(t){return this.stopwatch_exists(t)?this.stopwatches[t]:(this._report_sw_misuse(t+" doesn't exist"),null)},t.prototype.recordTrace=function(t,e){void 0===e&&(e={});var i=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null!=i){var n={traceTime:e.traceTime};return i.recordTrace(t,n)}},t.prototype.startSpan=function(t,e){void 0===e&&(e={});var i=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null!=i){var n={startTime:e.startTime,async:e.async};return i.start(t,n)}},t.prototype.endSpan=function(t,e){void 0===e&&(e={});var i=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null!=i)return i.end(t,{spanId:e.spanId,endTime:e.endTime})},t.prototype.addSpanAnnotation=function(t,e,i,n){void 0===n&&(n={});var o=this.getStopwatch(n.stopwatchName||this.GLOBAL_SW_NAME);null!=o&&o.addSpanAnnotation(t,e,i,n.spanId)},t.prototype.log_stored_results=function(){if(this.sentInitialData)return void this._report_sw_misuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately");this.flush_current_data(),this.sentInitialData=!0,this.intervalId=setInterval(this.flush_current_data.bind(this),this.flush_interval)},t.prototype._report_sw_misuse=function(t){t="ClientStopwatch: "+t,this.strictAssert?s.assert(!1,t):s.reportStack(t,{severity:s.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},t.prototype.flush_current_data=function(){if(Object.keys(this.storedAggregates).length>0){var t=JSON.stringify(this.storedAggregates);this.storedAggregates={};var e={request_id:o.REQUEST_ID,url:r.get_href(),aggregated_sw_data:t};i.sendXhr("/log_js_sw_data",e)}},t.prototype.print_stopwatches_debug=function(){var t=this.get_debug_data();console.groupCollapsed("Request timeline"),console.table(t),console.groupEnd()},t.prototype.get_debug_data=function(){var t=[];for(var e in this.storedAggregates)if(this.storedAggregates.hasOwnProperty(e)){var i=this.storedAggregates[e];for(var o in i)if(i.hasOwnProperty(o)){var r=i[o],s={stopwatchName:e,spanName:r.name,time:r.start_time+r.total_time};r.type!==n.TimingDataType.AsyncSpan&&r.type!==n.TimingDataType.Span||(s.startTime=r.start_time),r.type===n.TimingDataType.Span&&(s.info="Total time: "+r.total_time+"ms"),t.push(s)}}return t.sort(function(t,e){return t.time-e.time}),t},t})();e.JSStopwatch=new c;var p=(function(){function t(t,e,i,o,r,s){var a=this;this.sentInitialData=!1,this.strictAssert=!1,this.cachedSpans=[],this.reportSpan=function(t,e,i){a.sentInitialData?(a.updateAnnotations(i),a.reportSpanFn(t,e,i)):a.cachedSpans.push({stopwatchName:t,tags:e,timingData:i})},this.stopwatch=n.createStopwatch(t,this.strictAssert,this.reportSpan,s),this.request_id=i,this.correlation_id=o,this.url=r,this.reportSpanFn=e}return t.prototype.startSpan=function(t,e){void 0===e&&(e={});var i={startTime:e.startTime,async:e.async};return this.stopwatch.start(t,i)},t.prototype.endSpan=function(t,e){return void 0===e&&(e={}),this.stopwatch.end(t,{spanId:e.spanId,endTime:e.endTime})},t.prototype.addSpanAnnotation=function(t,e,i,n){this.stopwatch.addSpanAnnotation(t,e,i,n)},t.prototype.recordTrace=function(t,e,i){var n={};if(this.request_id&&(n[a.REQUEST_ID.id]=this.request_id),this.url&&(n[a.URL.id]=this.url),i)for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o]);var r={traceTime:e,annotations:n};this.stopwatch.recordTrace(t,r)},t.prototype.logData=function(){var t=this;if(this.sentInitialData)return void this.reportMisuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately");this.cachedSpans.forEach(function(e){t.updateAnnotations(e.timingData),t.reportSpanFn(e.stopwatchName,e.tags,e.timingData)}),this.cachedSpans=[],this.sentInitialData=!0,setTimeout(function(){e.JSStopwatch.flush_current_data()},0)},t.prototype.reportMisuse=function(t){t="ClientStopwatch: "+t,this.strictAssert?s.assert(!1,t):s.reportStack(t,{severity:s.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},t.prototype.updateAnnotations=function(t){this.request_id?t.annotations[a.REQUEST_ID.id]=this.request_id:delete t.annotations[a.REQUEST_ID.id],this.correlation_id?t.annotations[a.CORRELATION_ID.id]=this.correlation_id:delete t.annotations[a.CORRELATION_ID.id],this.url?t.annotations[a.URL.id]=this.url:delete t.annotations[a.URL.id]},t})()}),define("modules/clean/loggers/cache_logger",["require","exports","modules/constants/request","modules/clean/ajax","modules/core/browser"],function(t,e,i,n,o){"use strict";function r(){if(!a&&(a=!0,window.caches)){var t=[];window.caches.keys().then(function(e){return Promise.all(e.map(function(e){return window.caches.open(e).then(function(t){return t.keys()}).then(function(e){for(var i=0,n=e;i<n.length;i++){var o=n[i];t.push(o.url)}})}))}).then(function(){n.SilentBackgroundRequest({url:"/log/service_worker_cache",data:{request_id:i.REQUEST_ID,routes_cached:JSON.stringify(t)}})})}}function s(){if(!c&&(c=!0,window.localStorage&&window.ensemble&&window.ensemble.getCacheInfo)){for(var t=o.get_uri(),e=t.getScheme()+"://"+t.getAuthority(),r=[],s=0;s<window.localStorage.length;s++){var a=window.localStorage.key(s);if(a&&a.startsWith("ensembleCache")){var p=a.split("_");if(!(p.length<1)&&p[1].startsWith("/")){var l=p[1];r.push(e+l)}}}var u=[],d=[],_=window.ensemble.getCacheInfo();for(var m in _)if(m.startsWith("/")){var h=e+m;u.push(h),_[m].isCacheHit&&d.push(h)}n.SilentBackgroundRequest({url:"/log/ensemble_cache",data:{request_id:i.REQUEST_ID,routes_cached:JSON.stringify(r),cache_hits:JSON.stringify(d),all_pagelets:JSON.stringify(u)}})}}Object.defineProperty(e,"__esModule",{value:!0});var a=!1;e.logSWCacheData=r;var c=!1;e.logEnsembleCacheData=s}),define("modules/clean/perf_tools/browser_perf_utils",["require","exports","modules/clean/ajax","modules/core/browser","modules/constants/request","modules/clean/js_client_stopwatch","modules/constants/webtiming"],function(t,e,i,n,o,r,s){"use strict";function a(t){c(t),p(t)}function c(t){var e=n.performance();if(e&&e.getEntriesByType){var i=r.JSStopwatch.createDetachedStopwatch("performance_marks",{correlation_id:t}),o=e.getEntriesByType("mark");if(o instanceof Array)for(var s=0,a=o;s<a.length;s++){var c=a[s];i.recordTrace(c.name,c.startTime)}i.logData()}}function p(t){var e=n.performance();if(e&&e.timing){var a=e.timing,c={navigation_start:a.navigationStart,unload_event_start:a.unloadEventStart,unload_event_end:a.unloadEventEnd,redirect_start:a.redirectStart,redirect_end:a.redirectEnd,fetch_start:a.fetchStart,domain_lookup_start:a.domainLookupStart,domain_lookup_end:a.domainLookupEnd,connect_start:a.connectStart,secure_connect_start:a.secureConnectionStart,connect_end:a.connectEnd,request_start:a.requestStart,response_start:a.responseStart,response_end:a.responseEnd,dom_loading:a.domLoading,dom_interactive:a.domInteractive,dom_content_loaded_event_start:a.domContentLoadedEventStart,dom_content_loded_event_end:a.domContentLoadedEventEnd,dom_complete:a.domComplete,load_event_start:a.loadEventStart,load_event_end:a.loadEventEnd},p={};p.request_id=o.REQUEST_ID,p.referrer=document.referrer;var l=r.JSStopwatch.createDetachedStopwatch("browser_perf",{correlation_id:t});for(var u in c)c.hasOwnProperty(u)&&(p[u]=c[u],c[u]&&l.recordTrace(u,c[u]-a.navigationStart));l.logData(),s.LOG_BROWSER_PERFORMANCE_INFO&&i.SilentBackgroundRequest({url:"/alternate_wtl_browser_performance_info",type:"POST",data:p})}}Object.defineProperty(e,"__esModule",{value:!0}),e.logBrowserPerfData=a,e.logBrowserPerformanceInfo=p}),define("modules/clean/perf_tools/resource_utils",["require","exports","modules/core/browser","modules/clean/js_client_stopwatch"],function(t,e,i,n){"use strict";function o(t){a(t),s(t)}function r(t){if(d&&(d.href=t.name,d.host.match(/dropboxstatic.com$/)&&d.pathname.match(/^\/static/))){var e=d.pathname,i=e.match(/vfl[a-zA-Z0-9]*\.[a-z]*$/);i&&i.index&&(e=e.substring(0,i.index-1));for(var n=["/static/compiled/js/","/static/"],o=0,r=n;o<r.length;o++){var s=r[o];e.startsWith(s)&&(e=e.substring(s.length))}return e}}function s(t){var e=i.performance();if(e&&e.getEntriesByType){var o=n.JSStopwatch.createDetachedStopwatch("resource_timeline",{correlation_id:t}),s=e.getEntriesByType("resource");if(s instanceof Array)for(var a=0,c=s;a<c.length;a++){var p=c[a],u=r(p);if(u){var d=o.startSpan(u,{startTime:p.startTime,async:!0}),_=l(p);o.addSpanAnnotation(u,"type",_,d),p.responseEnd<p.startTime?(o.addSpanAnnotation(u,"negativeSpanLength",(p.responseEnd-p.startTime).toString(),d),o.endSpan(u,{endTime:p.startTime,spanId:d})):o.endSpan(u,{endTime:p.responseEnd,spanId:d})}}o.logData()}}function a(t){var e=window.requireContexts;if(e){var i=n.JSStopwatch.createDetachedStopwatch("resource_init_timeline",{correlation_id:t});for(var o in e)if(e.hasOwnProperty(o)){var r=e[o],s=r.module_callback_times;for(var a in s)if(s.hasOwnProperty(a)){var c=s[a];if(c.callbackDuration&&c.callbackTime){var p=i.startSpan(a,{startTime:c.callbackTime});i.addSpanAnnotation(a,"totalTimeNs",Math.round(1e6*c.callbackDuration).toString(),p),i.endSpan(a,{endTime:c.callbackTime+c.callbackDuration,spanId:p})}}}i.logData()}}function c(t){var e=i.performance();if(e&&e.getEntriesByType){var o=e.getEntriesByType("resource").filter(function(e){return e.name.indexOf(t)!==-1}),r=o[0];if(r&&r.responseEnd){var s="resource_response_end_"+t;return n.JSStopwatch.create_stopwatch_if_not_exist("resource_timing"),n.JSStopwatch.recordTrace(s,{stopwatchName:"resource_timing",traceTime:r.responseEnd}),r}}}function p(){var t={},e=i.performance();if(!e)return t;var o=e.getEntriesByType("resource");if(n.JSStopwatch.create_stopwatch_if_not_exist("resource_timeline"),o instanceof Array)for(var r=0,s=o;r<s.length;r++){var a=s[r],c=l(a);c in t||(t[c]={count:0,total_time:0}),t[c].count++,t[c].total_time+=a.duration,u(c)&&a.encodedBodySize&&(t[c].total_size=t[c].total_size||0,t[c].total_size+=a.encodedBodySize),u(c)&&a.transferSize&&(t[c].transfer_size=t[c].transfer_size||0,t[c].transfer_size+=a.transferSize)}return t}function l(t){var e=t.name,i=t.initiatorType,n=e.lastIndexOf(".");if(n>0){var o=e.substring(n);if([".png",".gif",".jpg",".svg"].indexOf(o)>-1)return"img";if(".js"===o)return"script";if(".css"===o)return"css"}return["css","img","script","link"].indexOf(i)===-1?"xmlhttprequest"===i?"ajax":"other":i}function u(t){return"css"===t||"script"===t||"img"===t}Object.defineProperty(e,"__esModule",{value:!0}),e.logResourcesData=o;var d=document&&document.createElement?document.createElement("a"):null;e.logResourceTiming=c,e.getResourceSummary=p}),define("modules/clean/perf_tools/web_timing_logger_types",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(function(){function t(e,i,n,o,r){void 0===n&&(n=!1),void 0===o&&(o=!0),this.name=e,this.flag=1<<i,this.triggersLogging=n,this.timestampPrefix=r||e,this.ordered=o,t.allEvents.push(this)}return t})();i.allEvents=[],i.APPLICATION_START=new i("application_code_start",1),i.LOAD_END=new i("load_end",2,!0,!1),i.MARK_TIME_TO_VIEW=new i("mark_time_to_view",3,!0,!0,"TTV"),i.FETCHED_DATA_FOR_TTI=new i("fetched_data_required_for_tti",4),i.MARK_TIME_TO_INTERACTIVE=new i("mark_time_to_interactive",5),i.TIME_TO_INTERACTIVE=new i("time_to_interactive",6,!0,!0,"TTI"),e.WebTimerEvent=i}),define("modules/clean/perf_tools/web_timing_utils",["require","exports","modules/core/browser"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(function(){function t(){}return t.generateCorrelationId=function(){return Math.random().toString(36).substring(2)},t.getNow=function(){var t=i.performance();if(t&&t.timing&&t.now){var e=t.timing;return(e.navigationStart||e.fetchStart)+Math.floor(t.now())}return Date.now()},t.newContext=function(e){var n;if(e)n=t.getNow();else{var o=i.performance();if(o&&o.timing){var r=o.timing;n=r.navigationStart||r.fetchStart}else n=t.getNow()}return{initialized:!1,is_pagelet:!1,is_dws:!1,is_pre_load_js:!1,is_stream_jsconsts:!1,is_early_ensemble:!1,log_time_to_view:!1,log_time_to_interactive:!1,ttv_at_dom_interactive:!1,tti_at_dom_interactive:!1,source_type:"web",subtypes:{},tti_exclusion_flow:"",have_logged_web_timing:!1,delayed_tti_for_css:!1,timing_results:null,start_time:n,time_to_view:null,time_to_interactive:null,correlation_id:t.generateCorrelationId()}},t})();e.WebTimingUtil=n}),define("modules/clean/prompt/account_header_loader",["require","exports","jquery","modules/clean/admin/megaphone/prompt/api/utils","external/react","external/react-dom","modules/clean/upsell/exception","modules/clean/react/prompt/header_link","modules/clean/react/prompt/header_bubble"],function(t,e,i,n,o,r,s,a,c){"use strict";function p(t){try{if(!t.userID)return;var e=i("#prompt-silo .account-header-react-silo"),p=n.APIUtils.toCamelCase(t.campaignResponse);if(p.subjectUser=t.userID,p.campaign)switch(p.campaign.campaignLocationId){case"HEADER_LINK":r.render(o.createElement(a.HeaderLink,p),e[0]);break;case"HEADER_BUBBLE":r.render(o.createElement(c.HeaderBubble,p),e[0])}}catch(e){s.reportException({err:e,tags:[s.TAGS.PROMPT_ACCOUNT_HEADER_LOADER],exc_extra:{param_user_id:t.userID,param_controller:t.controller,param_action:t.action,param_is_maestro_design:t.isMaestroDesign,param_campaign_response:t.campaignResponse}})}}Object.defineProperty(e,"__esModule",{value:!0}),e.initialize_react=p}),define("modules/clean/prompt/ha_loader",["require","exports","jquery","modules/clean/admin/megaphone/prompt/api/utils","external/react","external/react-dom","modules/clean/ajax","modules/clean/upsell/exception","modules/clean/react/prompt/ha"],function(t,e,i,n,o,r,s,a,c){"use strict";function p(t){try{if(!t.userID)return;var e=i(t.isMaestroDesign?"#prompt-silo .ha-silo":"#ha-container");s.SilentBackgroundRequest({url:"/prompt/ha",subject_user:t.userID,data:{ref_controller:t.controller,ref_action:t.action,campaign_id:t.campaignID,is_maestro:t.isMaestroDesign}}).then(function(i){var s=n.APIUtils.jsonToCamelCase(i);s.campaign&&(s.subjectUser=t.userID,r.render(o.createElement(c.HA,s),e[0]))})}catch(e){a.reportException({err:e,tags:[a.TAGS.PROMPT_HA_LOADER],exc_extra:{param_user_id:t.userID,param_controller:t.controller,param_action:t.action,param_campaign_id:t.campaignID,param_is_maestro_design:t.isMaestroDesign}})}}Object.defineProperty(e,"__esModule",{value:!0}),e.initialize_module=p}),define("modules/clean/react/prompt/button",["require","exports","tslib","external/classnames","external/purify","external/react","modules/core/cookies"],function(t,e,i,n,o,r,s){"use strict";function a(t){return t?{__html:o.sanitize(t)}:void 0}Object.defineProperty(e,"__esModule",{value:!0}),e.sanitizeOptionalHTML=a;var c=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.render=function(){var t=n(this.props.className,{"confirm-button":!0,enabled:!0});if(this.props.confirmIsPost){var e=s.read("__Host-js_csrf");return r.createElement("form",{action:this.props.confirmUrl,method:"POST",target:this.getTarget(),onSubmit:this.props.onConfirm},r.createElement("input",{type:"hidden",name:"t",value:e}),r.createElement("button",{type:"submit",className:t,dangerouslySetInnerHTML:a(this.props.html)},this.props.children))}return r.createElement("a",{href:this.props.confirmUrl,className:t,target:this.getTarget(),dangerouslySetInnerHTML:a(this.props.html),onClick:this.props.onConfirm},this.props.children)},e.prototype.getTarget=function(){return this.props.confirmInNewTab?"_blank":"_self"},e})(r.Component);e.ConfirmButton=c;var p=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.render=function(){var t=n(this.props.className,{"dismiss-button":!0,enabled:!0});return r.createElement("a",{href:"#",className:t,dangerouslySetInnerHTML:a(this.props.html),onClick:this.props.onDismiss},this.props.children)},e})(r.Component);e.DismissButton=p}),define("modules/clean/react/prompt/campaign_state_manager",["require","exports","jquery","modules/core/uri","modules/clean/ajax","modules/clean/upsell/upsell_controller","modules/clean/upsell/prompt_event_logging"],function(t,e,i,n,o,r,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=(function(){function t(t){var e=this;this.onShow=function(){e.component.state.isShown||(e.component.setState(function(t){return t.isShown=!0,t}),e.triggerExternalEvent(r.ON_SHOW_EVENT_NAME),o.SilentBackgroundRequest({type:"POST",url:e.getUpsellControllerURI("/prompt/log_impression").toString()}))},this.onConfirm=function(t){e.isAckInProgress()||(e.component.setState(function(t){return t.isConfirmed=!0,t}),e.triggerExternalEvent(r.PRE_CONFIRM_EVENT_NAME),e.component.props.campaign.content.confirmInNewTab||"#"!==e.component.props.campaign.content.confirmUrl||t.preventDefault(),"#"===e.component.props.campaign.content.confirmUrl&&e.recordConfirm())},this.onDismiss=function(t){e.isAckInProgress()||(e.component.setState(function(t){return t.isDismissed=!0,t}),t.preventDefault(),e.triggerExternalEvent(r.PRE_DISMISS_EVENT_NAME),e.recordDismiss())},this.component=t}return t.prototype.getConfirmUrl=function(){if("#"===this.component.props.campaign.content.confirmUrl)return"#";var t=this.getUpsellControllerURI("/prompt/confirm_v2"),e=this.component.props.campaign.content.confirmIsPost;return t.updateQuery({redirect_url:this.getRedirectURL()}),e&&t.updateQuery({preserve_post:"1"}),t.toString()},t.prototype.getShouldUsePost=function(){return!("#"===this.component.props.campaign.content.confirmUrl&&!this.component.props.campaign.content.confirmIsPost)},t.prototype.recordConfirm=function(){var t=this.getUpsellControllerURI("/prompt/confirm");this.recordAck(t,r.ON_CONFIRM_EVENT_NAME)},t.prototype.recordDismiss=function(){var t=this.getUpsellControllerURI("/prompt/dismiss");this.recordAck(t,r.ON_DISMISS_EVENT_NAME)},t.prototype.recordAck=function(t,e){var i=this;o.SilentBackgroundRequest({type:"POST",url:t.toString()}).done(function(t){i.triggerExternalEvent(e)})},t.prototype.getUpsellControllerURI=function(t){return s.getUpsellControllerURI(t,{campaignId:this.component.props.campaign.campaignId,versionId:this.component.props.campaign.versionId,activeUserId:this.component.props.subjectUser,promptQueriedAtMs:this.component.props.promptQueriedAtMs,requestId:this.component.props.requestId})},t.prototype.getRedirectURL=function(){if(this.component.props.campaign.addTkParams){var t=n.parse(this.component.props.campaign.content.confirmUrl),e=this.component.props.campaign.versionId;return null==e&&(e=this.component.props.campaign.campaignId),t.updateQuery({_tk:this.component.props.campaign.campaignLocationTkId,_camp:e.toString()}),t.toString()}return this.component.props.campaign.content.confirmUrl},t.prototype.isAckInProgress=function(){return this.component.state.isConfirmed||this.component.state.isDismissed},t.prototype.triggerExternalEvent=function(t){i(document).trigger(t,{campaignName:this.component.props.campaign.campaignName})},t})();e.CampaignStateManager=a}),define("modules/clean/react/prompt/ha",["require","exports","tslib","jquery","external/classnames","external/react","external/react-dom","modules/clean/react/css","modules/clean/react/sprite","modules/clean/upsell/prompt_event_emitter","modules/clean/react/prompt/button","modules/clean/react/prompt/image","modules/clean/react/prompt/prompt_location","modules/core/i18n"],function(t,e,i,n,o,r,s,a,c,p,l,u,d,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m;(function(t){t[t.HIDE=1]="HIDE",t[t.NO_IMAGE=2]="NO_IMAGE",t[t.SHOW=3]="SHOW"})(m=e.ShowState||(e.ShowState={})),e.UpdateInterval=1e3;var h=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.renderImage=function(){var t=this.props.content;return t.imageUrl?r.createElement(l.ConfirmButton,{className:"confirm-button--illustration",confirmInNewTab:t.confirmInNewTab,confirmIsPost:this.props.confirmIsPost,confirmUrl:this.props.confirmUrl,onConfirm:this.props.onConfirm},r.createElement(u.Image,{src:t.imageUrl,srcHiRes:t.imageUrlHiRes,alt:t.confirmText,onLoad:this.props.onImageLoad
})):null},e.prototype.renderText=function(){var t=this.props.content;return r.createElement("p",null,r.createElement(l.ConfirmButton,{confirmInNewTab:t.confirmInNewTab,confirmIsPost:this.props.confirmIsPost,confirmUrl:this.props.confirmUrl,html:t.text,onConfirm:this.props.onConfirm}))},e.prototype.renderConfirmButton=function(){var t=this.props.content;return t.confirmText?r.createElement(l.ConfirmButton,{className:"button",confirmInNewTab:t.confirmInNewTab,confirmIsPost:this.props.confirmIsPost,confirmUrl:this.props.confirmUrl,html:t.confirmText,onConfirm:this.props.onConfirm}):null},e.prototype.renderDismissButton=function(){return this.props.isMaestroDesign?r.createElement(l.DismissButton,{onDismiss:this.props.onDismiss,"aria-label":_._("Close")},r.createElement(c,{group:"web",name:"close_small",alt:_._("Close")})):r.createElement(l.DismissButton,{onDismiss:this.props.onDismiss,"aria-label":_._("Close")})},e.prototype.render=function(){var t=this.props.isDismissed,e=o({ha:!0,"no-image":!t&&this.props.showState===m.NO_IMAGE,visible:!t&&this.props.showState===m.SHOW,invisible:this.props.isInvisible});return r.createElement("div",{className:e},this.renderImage(),this.renderText(),this.renderConfirmButton(),this.renderDismissButton())},e})(r.Component);h.displayName="HARendererWithoutCSS",e.HARendererWithoutCSS=h,e.HARendererWithCSS=a(h,["/static/css/upsell/ha-vflVUjNO9.css"]);var f=(function(t){function o(e){var i=t.call(this,e,{cloneShowState:m.SHOW,isConfirmed:!1,isDismissed:!1,isShown:!1,showState:m.HIDE})||this;return i.setHaRef=function(t){i.ha=t},i.setHaCloneRef=function(t){i.haClone=t},i.onPageUpdate=i.onPageUpdate.bind(i),i}return i.__extends(o,t),o.prototype.componentDidMount=function(){this.onUpdate(),n(window).resize(this.onPageUpdate),p.Emitter.addListener(p.Events.REACT_HA_DID_UPDATE,this.onPageUpdate),this.intervalID=setInterval(this.onPageUpdate,e.UpdateInterval)},o.prototype.componentWillUnmount=function(){n(window).off("resize",this.onPageUpdate),p.Emitter.off(p.Events.REACT_HA_DID_UPDATE,this.onPageUpdate),clearInterval(this.intervalID)},o.prototype.componentDidUpdate=function(){this.onUpdate()},o.prototype.onPageUpdate=function(){this.setState(function(t){return t.cloneShowState=m.SHOW,t})},o.prototype.onUpdate=function(){var t=this;if(this.state.cloneShowState>m.HIDE&&this.canFit())this.state.showState!==this.state.cloneShowState&&this.setState(function(t){return t.showState=t.cloneShowState,t},function(){t.state_manager.onShow()});else{var e=this.state.cloneShowState-1;e>m.HIDE?this.setState(function(t){return t.cloneShowState=e,t}):this.state.showState!==m.HIDE&&this.setState(function(t){return t.showState=m.HIDE,t})}},o.prototype.render=function(){return r.createElement("div",null,r.createElement(e.HARendererWithCSS,{isInvisible:!1,content:this.props.campaign.content,confirmUrl:this.state_manager.getConfirmUrl(),confirmIsPost:this.state_manager.getShouldUsePost(),isDismissed:this.state.isDismissed,isMaestroDesign:this.props.isMaestroDesign,onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss,ref:this.setHaRef,showState:this.state.showState}),r.createElement(e.HARendererWithCSS,{isInvisible:!0,content:this.props.campaign.content,confirmUrl:this.state_manager.getConfirmUrl(),confirmIsPost:this.state_manager.getShouldUsePost(),isDismissed:this.state.isDismissed,isMaestroDesign:this.props.isMaestroDesign,onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss,onImageLoad:this.onPageUpdate,ref:this.setHaCloneRef,showState:this.state.cloneShowState}))},o.prototype.canFit=function(){return this.props.isMaestroDesign?this.canFitMaestro():this.canFitOld()},o.prototype.canFitMaestro=function(){var t=this.getMenuHeight();if(null===t)return!1;var e=this.getHAHeight();return null!==e&&t+e<=this.getWindowHeight()},o.prototype.canFitOld=function(){var t=this.getHABottom();return null!==t&&(t+this.getFooterHeight()<=this.getWindowHeight()||!this.isHAFixed())},o.prototype.getHABottom=function(){var t=n(s.findDOMNode(this.ha)),e=n(s.findDOMNode(this.haClone));return t.length>0&&e.length>0?t.offset().top-n(document).scrollTop()+e.outerHeight():null},o.prototype.getHAHeight=function(){var t=n(s.findDOMNode(this.haClone));if(0===t.length)return null;return t.outerHeight()+75},o.prototype.getMenuHeight=function(){var t=n(".maestro-secondary-sidebar, .appactions-menu").first();if(0===t.length)return null;var e=t.children(),i=t.offset().top-n(document).scrollTop();return e.each(function(t,e){i+=n(e).outerHeight(!0)}),i},o.prototype.getFooterHeight=function(){return n("#page-footer").outerHeight()+5},o.prototype.getWindowHeight=function(){return n(window).height()},o.prototype.isHAFixed=function(){var t=n(s.findDOMNode(this.ha));return t.add(t.parents()).is(function(){return"fixed"===n(this).css("position")})},o})(d.PromptLocation);e.HA=f}),define("modules/clean/react/prompt/header_bubble",["require","exports","tslib","external/react","external/classnames","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/prompt/header_link","modules/clean/react/prompt/image","modules/clean/react/prompt/button"],function(t,e,i,n,o,r,s,a,c,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.render=function(){var t=this.props.campaign.content,e=n.createElement("div",null,n.createElement("p",{className:"message",dangerouslySetInnerHTML:p.sanitizeOptionalHTML(t.text)}),this.renderButtons()),i=o({"header-bubble-container":!0,show:!0,"header-bubble-container--with-image":!!t.imageUrl}),r=t.imageUrl?[n.createElement("div",{className:"left"},n.createElement(p.ConfirmButton,{className:"image-button",confirmInNewTab:t.confirmInNewTab,confirmUrl:this.state_manager.getConfirmUrl(),confirmIsPost:this.state_manager.getShouldUsePost(),onConfirm:this.state_manager.onConfirm},n.createElement(c.Image,{src:t.imageUrl,srcHiRes:t.imageUrlHiRes,alt:t.confirmText}))),n.createElement("div",{className:"right"},e)]:[e],s=["top-level-nav-item"];return this.state.isConfirmed||this.state.isDismissed||s.push("active"),n.createElement("li",{className:s.join(" ")},n.createElement(a.HeaderLinkRendererWithoutCSS,{content:t,confirmUrl:this.state_manager.getConfirmUrl(),onConfirm:this.state_manager.onConfirm}),n.createElement("div",{className:"sub-nav chat-bubble header-bubble upsell-bubble",id:"upsell-bubble"},n.createElement("div",{className:i},r,n.createElement("div",{className:"chat-bubble-arrow-border"}),n.createElement("div",{className:"chat-bubble-arrow"}))))},e.prototype.renderButtons=function(){var t,e=this.props.campaign.content;e.confirmText&&(t=n.createElement(p.ConfirmButton,{className:"button-primary",confirmInNewTab:e.confirmInNewTab,confirmIsPost:this.state_manager.getShouldUsePost(),confirmUrl:this.state_manager.getConfirmUrl(),onConfirm:this.state_manager.onConfirm,html:e.confirmText}));var i;return e.cancelText&&(i=n.createElement(p.DismissButton,{className:"cancel-button button-tertiary",onDismiss:this.state_manager.onDismiss,html:e.cancelText})),n.createElement("div",{className:"upsell-buttons"},t,i)},e})(s.PromptLocationWithDefaultState);l.displayName="HeaderBubbleWithoutCSS",e.HeaderBubbleWithoutCSS=l,e.HeaderBubble=r(l,["/static/css/upsell/buttons-vflXU0_uP.css","/static/css/upsell/header_bubble.css","/static/css/upsell/header_bubble_or_link-vflPMn-gS.css"])}),define("modules/clean/react/prompt/header_link",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/sprite_div"],function(t,e,i,n,o,r,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.render=function(){var t=this.props.content,e=["confirm-button","header-nav-link","enabled"];t.linkPretext&&e.push("header-nav-link--bold");var i;i=t.linkIcon?n.createElement("a",{className:e.join(" "),href:this.props.confirmUrl,onClick:this.props.onConfirm},n.createElement(s,{group:"web",name:t.linkIcon,text:t.linkText})):n.createElement("a",{className:e.join(" "),href:this.props.confirmUrl,onClick:this.props.onConfirm},t.linkText);var o=i;return t.linkPretext&&(o=n.createElement("div",{className:"header-nav-link--space"},n.createElement("span",{className:"header-link__pretext"},t.linkPretext),i)),n.createElement("div",{className:"header-link"},o)},e})(n.Component);a.displayName="HeaderLinkRendererWithoutCSS",e.HeaderLinkRendererWithoutCSS=a;var c=o(a,["/static/css/upsell/header_bubble_or_link-vflPMn-gS.css"]),p=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.render=function(){return n.createElement("li",{className:"top-level-nav-item"},n.createElement(c,{content:this.props.campaign.content,confirmUrl:this.state_manager.getConfirmUrl(),onConfirm:this.state_manager.onConfirm}))},e})(r.PromptLocationWithDefaultState);e.HeaderLink=p}),define("modules/clean/react/prompt/image",["require","exports","tslib","external/react"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.render=function(){var t=this.props.srcHiRes?this.props.srcHiRes+" 2x":void 0;return n.createElement("img",{src:this.props.src,srcSet:t,alt:this.props.alt,onLoad:this.props.onLoad})},e})(n.Component);e.Image=o}),define("modules/clean/react/prompt/prompt_location",["require","exports","tslib","external/react","modules/clean/react/prompt/campaign_state_manager"],function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(function(t){function e(e,i){var n=t.call(this,e)||this;return n.state=i,n.state_manager=new o.CampaignStateManager(n),n}return i.__extends(e,t),e.prototype.componentDidMount=function(){this.state_manager.onShow()},e})(n.Component);e.PromptLocation=r;var s=(function(t){function e(e){return t.call(this,e,{isConfirmed:!1,isDismissed:!1,isShown:!1})||this}return i.__extends(e,t),e})(r);e.PromptLocationWithDefaultState=s}),function(){define("modules/clean/react/sprite_div",["external/classnames","external/react","modules/clean/react/sprite"],function(t,e,i){var n,o;return n=e.createElement,o=e.DOM.div,e.createClass({displayName:"SpriteDiv",propTypes:{group:e.PropTypes.string.isRequired,name:e.PropTypes.string.isRequired,text:e.PropTypes.oneOfType([e.PropTypes.string,e.PropTypes.array]),alt:e.PropTypes.string,spritePosition:e.PropTypes.oneOf(["left","right"])},getDefaultProps:function(){return{alt:"",spritePosition:"left"}},render:function(){var e,r,s,a,c,p,l,u;switch(s=this.props.group,c=this.props.name,u=this.props.text,e=this.props.alt,l=t(["sprite-frame","small","icon-"+this.props.spritePosition]),p=o({className:l,key:0},n(i,{group:s,name:c,alt:e})),a=o({className:"sprite-text",key:1},u),this.props.spritePosition){case"left":r=[p,a];break;case"right":r=[a,p]}return o({className:"sprite-div"},r)}})})}.call(this),define("modules/clean/react_perf_logger",["require","exports","external/react","modules/core/xhr"],function(t,e,i,n){"use strict";function o(){try{return i.addons.Perf}catch(t){return null}}function r(){var t=o();t&&t.start()}function s(){var t=o();t&&t.stop()}function a(t,e){var i=o();if(i){var r={wastedComponents:[],components:[]};try{for(var s=i.getWasted(),a=0,c=s;a<c.length;a++){var p=c[a];r.wastedComponents.push({component:p.key,renderCount:p.renderCount,wastedTime:p.inclusiveRenderDuration})}for(var l=i.getExclusive(),u=0,d=l;u<d.length;u++){var _=d[u];r.components.push({component:_.key,instanceCount:_.instanceCount,renderTime:_.durations.render,renderCount:_.counts.render,lifecycleTime:_.totalDuration-_.durations.render,raw:{counts:_.counts,durations:_.durations}})}n.sendXhr("/log_react_perf_data",{request_id:t,url:e,react_perf_data:JSON.stringify(r)})}catch(t){}}}Object.defineProperty(e,"__esModule",{value:!0}),e.startProfiling=r,e.stopProfiling=s,e.logReactPerfSnapshot=a}),define("modules/clean/upsell/exception",["require","exports","modules/core/exception","modules/core/xhr"],function(t,e,i,n){"use strict";function o(t){var e=t.severity,o=void 0===e?i.SEVERITY.CRITICAL:e;n.sendXhr("/prompt/log_jse",{severity:o})}function reportException(t){var n=t.err,o=t.tags,r=void 0===o?[]:o,s=t.severity,a=void 0===s?i.SEVERITY.CRITICAL:s,c=t.exc_extra,p=void 0===c?{}:c;r.push(e.TAGS.PROMPT),r.push(e.TAGS.MEGAPHONE),i.reportException({err:n,tags:r,severity:a,exc_extra:p}),e.logExceptionRate({severity:a})}function r(t){var n=t.err,o=t.js_controller_options,r=void 0===o?{}:o,s=t.severity,a=void 0===s?i.SEVERITY.CRITICAL:s,c=[],p={"campaign-name":"campaignName",location:"campaignLocationId"};for(var l in p)if(p.hasOwnProperty(l)){var u=p[l],d=r[u];d&&c.push("prompt-"+l+"-"+d)}e.reportException({err:n,tags:c,severity:a,exc_extra:r})}Object.defineProperty(e,"__esModule",{value:!0}),e.SEVERITY=i.SEVERITY,e.TAGS={MEGAPHONE:"megaphone",PROMPT:"prompt",PROMPT_ADMIN:"prompt-admin",PROMPT_ACCOUNT_HEADER_LOADER:"prompt-account-header-loader",PROMPT_HA_LOADER:"prompt-ha-loader",PROMPT_LOADER:"prompt-loader",PROMPT_MAIN_AND_ACCOUNT_HEADER_LOADER:"prompt-main-and-account-header-loader",PROMPT_MUTUALLY_EXCLUSIVE_LOADER:"prompt-mutually-exclusive-loader",LEGACY_TOP_NOTIFICATIONS:"legacy-top-notifications"},e.logExceptionRate=o,e.reportException=reportException,e.reportJsControllerException=r}),function(){define("modules/clean/upsell/prompt_event_emitter",["external/eventemitter3"],function(t){return{Events:{REACT_HA_DID_UPDATE:"REACT_HA_DID_UPDATE"},Emitter:new t}})}.call(this),define("modules/clean/upsell/prompt_event_logging",["require","exports","modules/core/uri","modules/clean/ajax_minimal"],function(t,e,i,n){"use strict";function o(t,e){var n={campaign_id:e.campaignId.toString()};if(e.versionId&&(n.campaign_id=e.versionId.toString(),n.version_id=e.versionId.toString()),"number"==typeof e.promptQueriedAtMs&&(n.prompt_queried_at_ms=e.promptQueriedAtMs.toString()),window.performance&&window.performance.timing&&window.performance.timing.navigationStart){var o=(new Date).getTime(),r=o-window.performance.timing.navigationStart;n.delta_from_request_start_ms=r.toString()}return e.activeUserId&&(n._subject_uid=String(e.activeUserId)),e.requestId&&(n.prompt_parent_request_id=e.requestId),new i({path:t,query:n})}Object.defineProperty(e,"__esModule",{value:!0}),e.getUpsellControllerURI=o;var r=(function(){function t(t){this.params=t}return t.prototype.logImpression=function(){var t=o("/prompt/log_impression",this.params);n.post(t.toString(),"")},t.prototype.logDismissal=function(){var t=o("/prompt/dismiss",this.params);n.post(t.toString(),"")},t})();e.LegacyEventLogger=r}),define("modules/clean/upsell/prompt_loader",["require","exports","jquery","modules/clean/deprecated/uirequest","modules/clean/prompt/account_header_loader","modules/clean/prompt/ha_loader","modules/clean/upsell/exception","modules/clean/user_education/user_education_loader","modules/clean/web_timing_logger"],function(t,e,i,n,o,r,s,a,c){"use strict";function p(t){try{var e=window.performance&&window.performance.mark&&window.performance.measure&&window.location.search.indexOf("show_debug_spans")>-1;e&&window.performance.mark("PromptLoader init start"),t.mutually_exclusive_loading?new d({user_id:t.user_id,controller:t.controller,action:t.action,in_app:t.in_app,sprite_group:t.sprite_group,is_maestro:t.is_maestro,use_uirequest:t.use_uirequest}):(new u({user_id:t.user_id,controller:t.controller,action:t.action,in_app:t.in_app,sprite_group:t.sprite_group,is_maestro:t.is_maestro,use_uirequest:t.use_uirequest}),r.initialize_module({userID:t.user_id,controller:t.controller,action:t.action,isMaestroDesign:t.is_maestro})),e&&(window.performance.mark("PromptLoader init end"),window.performance.measure("PromptLoader init","PromptLoader init start","PromptLoader init end"))}catch(e){s.reportException({err:e,tags:[s.TAGS.PROMPT_LOADER],exc_extra:{param_config:t}})}}Object.defineProperty(e,"__esModule",{value:!0});var l=(function(){function t(t){this.response_data=t}return t.prototype.didCampaignLoad=function(t,e){for(var i=this.response_data.actions||[],n=0,o=i;n<o.length;n++){var r=o[n],s=r[1];if(r[2]===t&&s)return!e||s.indexOf(e)>=0}return!1},t.prototype.didHeaderBubbleLoad=function(){return this.didCampaignLoad("^body #prompt-silo .account-header-silo","header-bubble-container")||this.didCampaignLoad("^body #prompt-silo .account-header-react-silo","header-bubble-container")},t.prototype.didHeaderLinkLoad=function(){return!this.didHeaderBubbleLoad()&&(this.didCampaignLoad("^body #prompt-silo .account-header-silo","header-link")||this.didCampaignLoad("^body #prompt-silo .account-header-react-silo","header-link"))},t.prototype.didMainCampaignLoad=function(){return this.didHeaderBubbleLoad()||this.didCampaignLoad("^body #prompt-silo .main-silo")},t.prototype.didAccountHeaderCampaignLoad=function(){return this.didHeaderBubbleLoad()||this.didHeaderLinkLoad()},t.prototype.didCampaignForUserEducationLoad=function(){return this.didCampaignLoad("^body #prompt-silo .main-silo",'"onboardingModuleName":')&&!this.didCampaignLoad("^body #prompt-silo .main-silo",'"onboardingModuleName": null')},t.prototype.didAnyContentLoad=function(){for(var t=this.response_data.actions||[],e=0,i=t;e<i.length;e++){if(i[e][1])return!0}return!1},t})(),u=(function(){function e(t){var e=this;try{t.options||(t.options={});new n(i(t.is_maestro?"#prompt-silo .main-silo":"#outer-frame"),"/prompt/main_campaign",{data:{ref_controller:t.controller,ref_action:t.action,in_app:t.in_app,sprite_group:t.sprite_group,skip_main_campaign:t.options.skip_main_campaign,is_maestro:t.is_maestro},dataType:"json",subject_user:t.user_id,success:function(n){i(".db-modal-overlay").is(":visible")||i("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal"),"function"==typeof t.options.success&&t.options.success(n),e.checkAndNotifyUserEducation(n),e.checkAndNotifyInviteExp(n,t.controller,t.action);var r=n.data&&n.data.account_header_campaign_props;r&&o.initialize_react({userID:t.user_id,controller:t.controller,action:t.action,campaignResponse:r,isMaestroDesign:t.is_maestro})}})}catch(e){s.reportException({err:e,tags:[s.TAGS.PROMPT_MAIN_AND_ACCOUNT_HEADER_LOADER],exc_extra:{param_user_id:t.user_id,param_controller:t.controller,param_action:t.action,param_in_app:t.in_app,param_sprite_group:t.sprite_group,param_is_maestro:t.is_maestro,param_options_skip_main_campaign:t.options.skip_main_campaign}})}}return e.prototype.checkAndNotifyUserEducation=function(t){new l(t).didCampaignForUserEducationLoad()||a.UELoader.notifyModuleToLoad(null)},e.prototype.checkAndNotifyInviteExp=function(e,i,n){if("home"===i&&"pagelet_home_web"===n||"maestro"===i&&"pagelet_files_browse"===n){new l(e).didAnyContentLoad()||c.waitForTTI().then(function(){t(["modules/clean/react/teams/modals/multifield_invite_reminder_modal"],function(t){t.MultifieldInviteReminderModal.load()})})}},e})(),d=(function(){function t(t){try{this.didTopNotificationLoad()?t.options={skip_main_campaign:!0,success:function(e){new l(e).didAccountHeaderCampaignLoad()||r.initialize_module({userID:t.user_id,controller:t.controller,action:t.action,isMaestroDesign:t.is_maestro})}}:t.options={success:function(e){new l(e).didMainCampaignLoad()||r.initialize_module({userID:t.user_id,controller:t.controller,action:t.action,isMaestroDesign:t.is_maestro})}},new u(t)}catch(e){s.reportException({err:e,tags:[s.TAGS.PROMPT_MUTUALLY_EXCLUSIVE_LOADER],exc_extra:{param_user_id:t.user_id,param_controller:t.controller,param_action:t.action,param_in_app:t.in_app,param_sprite_group:t.sprite_group,param_is_maestro:t.is_maestro}})}}return t.prototype.didTopNotificationLoad=function(){return!!i("#top-notification-bar-container").length},t})();e.initialize_module=p}),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/upsell/upsell_controller",["jquery","modules/clean/ajax","modules/clean/upsell/exception","modules/core/dom","modules/core/uri"],function(e,i,n,o,r){return(function(){function s(i,n,o){this.options=o,this.post_confirm=t(this.post_confirm,this),this.post_dismiss=t(this.post_dismiss,this),this.confirm=t(this.confirm,this),this.dismiss=t(this.dismiss,this),this._keydown=t(this._keydown,this),i.length>0&&i.one("click",(function(t){return function(e){return t.confirm(e)}})(this)),n.length>0&&n.one("click",(function(t){return function(i){var n;return n=e(i.target).hasClass("remind-me-later"),t.dismiss(i,n)}})(this)),this.options.dismissWithKeys&&e(document).on("keydown",this._keydown),s.add_tk_params(i,{addTkParams:this.options.addTkParams,campaignId:this.options.campaignId,versionId:this.options.versionId,campaignLocationTkId:this.options.campaignLocationTkId}),i.add(n).addClass("enabled")}return s.ON_SHOW_EVENT_NAME="db:prompt:show",s.ON_CONFIRM_EVENT_NAME="db:prompt:confirm",s.ON_DISMISS_EVENT_NAME="db:prompt:dismiss",s.PRE_CONFIRM_EVENT_NAME="db:prompt:pre-confirm",s.PRE_DISMISS_EVENT_NAME="db:prompt:pre-dismiss",s.CONFIRM="confirm",s.DISMISS="dismiss",s.LOG_IMPRESSION="log_impression",s.prototype._keydown=function(t){if(27===t.keyCode||8===t.keyCode&&!o.focus_in_input())return t.preventDefault(),e(document).off("keydown",this._keydown),this.dismiss(t)},s.prototype._campaignUrl=function(t,e){var i,n;if(i=t===s.CONFIRM?"/prompt/confirm":t===s.DISMISS?"/prompt/dismiss":t===s.LOG_IMPRESSION?"/prompt/log_impression":void 0,this.options&&this.options.campaignId)return n=r({path:i}).updateQuery({campaign_id:this.options.campaignId}),this.options.versionId&&n.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),t===s.DISMISS&&e&&n.updateQuery({remind_me_later:!0}),n.toString()},s.prototype._confirmOrDismiss=function(t,n,o,r){return"keydown"===t.type||o||(t.stopImmediatePropagation(),t.preventDefault()),i.SilentBackgroundRequest({type:"POST",url:n,subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}}).done((function(i){return function(n){return"keydown"===t.type||o||t.target.click(),e(document).trigger(r,i.options)}})(this))},s.prototype.dismiss=function(t,i){var n;return n=this._campaignUrl(s.DISMISS,i),n&&this._confirmOrDismiss(t,n,!1,s.ON_DISMISS_EVENT_NAME),e(document).trigger(s.PRE_DISMISS_EVENT_NAME,this.options)},s.prototype.confirmUrl=function(t){var i,n;return i=e(t.currentTarget),n=i.is("button, input")&&"submit"===i.attr("type")?e(t.currentTarget).closest("form").attr("action"):i.is("a")?e(t.currentTarget).attr("href"):void 0,n||this.options.confirmUrl},s.prototype.confirmInNewTab=function(t){var i,n;return i=e(t.currentTarget),n=i.is("button, input")&&"submit"===i.attr("type")?e(t.currentTarget).closest("form").attr("target"):i.is("a")?e(t.currentTarget).attr("target"):void 0,n?"_blank"===n:this.options.confirmInNewTab},s.prototype.confirm=function(t){var i;return i=this._campaignUrl(s.CONFIRM),i&&this._confirmOrDismiss(t,i,this.confirmInNewTab(t),s.ON_CONFIRM_EVENT_NAME),e(document).trigger(s.PRE_CONFIRM_EVENT_NAME,this.options)},s.prototype.get_time_since_request_start=function(){var t,e;return e=window.performance&&window.performance.timing,e&&window.performance.timing.navigationStart?(t=(new Date).getTime(),t-window.performance.timing.navigationStart):void 0},s.prototype.log_impression=function(){var t;if(t=this._campaignUrl(s.LOG_IMPRESSION))return i.SilentBackgroundRequest({type:"POST",url:t,subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},s.prototype.log_event=function(t){var e;if(this.options&&this.options.campaignId)return e=r({path:"/prompt/log_event"}).updateQuery({event_name:t,campaign_id:this.options.campaignId}),this.options.versionId&&e.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),i.SilentBackgroundRequest({type:"POST",url:e.toString(),subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},s.prototype.post_dismiss=function(){var t;if(t=this._dismissUrl())return i.SilentBackgroundRequest({type:"POST",url:t,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},s.prototype.post_confirm=function(){var t;if(t=this._confirmUrl())return i.SilentBackgroundRequest({type:"POST",url:t,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},s.add_tk_params=function(t,i){var o;if(i.addTkParams)return i.campaignId&&i.campaignLocationTkId?t.each(function(t,n){var o,s,a,c;if(o=e(n),o.is("a")?a="href":(o=o.closest("form"),a="action"),c=o.attr(a),o.length>0&&c)return s=r.parse(c),s.updateQuery({_tk:i.campaignLocationTkId,_camp:i.versionId||i.campaignId}),o.attr(a,s.toString())}):(o=new Error("Missing campaignId or campaignLocationTkId."),void n.reportJsControllerException({err:o,js_controller_options:i,severity:n.SEVERITY.NONCRITICAL}))},s.register_custom_controller=function(t){var i,n,o,r,a;if(o=t.on_show,i=t.on_confirm,n=t.on_dismiss,r=t.pre_confirm,a=t.pre_dismiss,o&&e(document).on(s.ON_SHOW_EVENT_NAME,o),i&&e(document).on(s.ON_CONFIRM_EVENT_NAME,i),n&&e(document).on(s.ON_DISMISS_EVENT_NAME,n),r&&e(document).on(s.PRE_CONFIRM_EVENT_NAME,r),a)return e(document).on(s.PRE_DISMISS_EVENT_NAME,a)},s.unregister_custom_controller=function(t){var i,n,o,r,a;if(o=t.on_show,i=t.on_confirm,n=t.on_dismiss,r=t.pre_confirm,a=t.pre_dismiss,o&&e(document).off(s.ON_SHOW_EVENT_NAME,o),i&&e(document).off(s.ON_CONFIRM_EVENT_NAME,i),n&&e(document).off(s.ON_DISMISS_EVENT_NAME,n),r&&e(document).off(s.PRE_CONFIRM_EVENT_NAME,r),a)return e(document).off(s.PRE_DISMISS_EVENT_NAME,a)},s})()})}.call(this),define("modules/clean/user_education/user_education_loader",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(function(){function t(){this.loadMessage=null,this.callback=null}return t.prototype.notifyModuleToLoad=function(t){this.callback?(this.callback(t),this.callback=null):this.loadMessage={moduleName:t}},t.prototype.setLoadingCallback=function(t){this.loadMessage?t(this.loadMessage.moduleName):this.callback=t},t})();e.UELoader=new i}),define("modules/clean/web_module_timing",["require","exports"],function(t,e){"use strict";var i={module_times:[],reset:function(){i.module_times=[]},get_module_times:function(){return i.module_times},add_module:function(t,e,n,o){var r={load_time:e,callback_duration:o,callback_time:n};t&&t.url&&(r.url=t.url),t&&t.id&&(r.name=t.id),t&&t.parentMap&&t.parentMap.url&&(r.parent=t.parentMap.url),i.module_times.push(r)}};return i}),define("modules/clean/web_timing_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/devtools/perf_hub_actions","modules/clean/event_load","modules/constants/request","modules/constants/webtiming","modules/constants/page_load","modules/core/browser","modules/core/exception","modules/clean/web_module_timing","modules/clean/window_util","modules/clean/perf_tools/resource_utils","modules/clean/perf_tools/web_timing_logger_types","modules/clean/perf_tools/web_timing_utils","modules/clean/js_client_stopwatch","modules/clean/loggers/cache_logger","modules/clean/react_perf_logger","modules/clean/perf_tools/browser_perf_utils","modules/clean/init_react"],function(t,e,i,n,o,r,s,a,c,p,l,u,d,_,m,h,f,g,v,w,S){"use strict";function T(t){var e=t;return X[e]||(X[e]=new Y(h.WebTimingUtil.newContext(!0))),X[e]}function y(t){return t?T(t):$}function E(t){delete X[t]}function b(){return y().timeToView()}function I(){return y().timeToInteractive()}function x(t){void 0===t&&(t={}),y().initialize({requireTTV:!!t.log_time_to_view,requireTTI:!!t.log_time_to_interactive,is_pagelet:t.is_pagelet,is_dws:t.is_dws,is_pre_load_js:t.is_pre_load_js,is_stream_jsconsts:t.is_stream_jsconsts,is_early_ensemble:t.is_early_ensemble,ttv_at_dom_interactive:t.ttv_at_dom_interactive,tti_at_dom_interactive:t.tti_at_dom_interactive,source_type:t.source_type,subtypes:t.subtypes,tti_exclusion_flow:t.tti_exclusion_flow})}function N(){$=new K(h.WebTimingUtil.newContext(!1))}function C(){return y().startTime()}function A(){return y().timeSinceStart()}function D(t){y().excludeFromTTI(t)}function O(t,e){for(var i=0,n=e;i<n.length;i++){var o=n[i];if(0!==o.startTime){var r=t.startSpan(o.name,{startTime:o.startTime});if(void 0!==o.annotations)for(var s in o.annotations)o.annotations.hasOwnProperty(s)&&t.addSpanAnnotation(o.name,s,o.annotations[s],r);o.endTime<o.startTime?(t.addSpanAnnotation(o.name,"negativeSpanLength",(o.endTime-o.startTime).toString(),r),t.endSpan(o.name,{spanId:r,endTime:o.startTime})):t.endSpan(o.name,{spanId:r,endTime:o.endTime})}else t.recordTrace(o.name,o.endTime,o.annotations)}t.logData()}function R(t){if(window.ensemble&&window.ensemble.getJSStopwatchData){var e=f.JSStopwatch.createDetachedStopwatch("ensemble",{correlation_id:t}),i=window.ensemble.getJSStopwatchData(),n=[];for(var o in i)if(i.hasOwnProperty(o)){var r=i[o];n.push({name:o,startTime:r.start,endTime:r.end,annotations:r.annotations})}O(e,n)}}function M(t){var e=S.getReactInitData();O(f.JSStopwatch.createDetachedStopwatch("init_react",{correlation_id:t}),e)}function P(){y().markTimeToView()}function k(t){void 0===t&&(t={});var e=y();e.setExtraColumns(t),e.markTimeToInteractive()}function U(){return y().waitForTTI()}function L(){y().applicationStart()}function q(){y().fetchedDataRequiredForTTI()}function j(t){var e=_.getResourceSummary();for(var i in e)e.hasOwnProperty(i)&&(t["resource_"+i+"_count"]=e[i].count,t["resource_"+i+"_avg_time"]=e[i].total_time/e[i].count,void 0!==e[i].total_size&&(t["resource_"+i+"_total_size"]=e[i].total_size),void 0!==e[i].transfer_size&&(t["resource_"+i+"_transfer_size"]=e[i].transfer_size))}function H(t){var e=p.performance();if(e&&e.getEntriesByName){for(var i=u.get_module_times(),n=[],o=0,r=i;o<r.length;o++){var s=r[o],a=s.url;if(void 0===a&&s.name&&s.name.indexOf("!")===-1)l.reportStack("Module "+s.name+" with invalid map object fetched by requirejs",{severity:l.SEVERITY.NONCRITICAL,tags:["log_js_module_timing"]});else{var c=[];if(a&&(c=e.getEntriesByName(a,"resource")),0!==c.length)s.start_time=c[0].responseEnd;else{if(!("callback_duration"in s))continue;s.start_time=0}n.push(s)}}t.js_module_times=JSON.stringify(n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.ExtraColumns=m.ExtraColumns;var W;(function(t){t[t.NEW=1]="NEW",t[t.RUNNING=2]="RUNNING",t[t.ABORTED=3]="ABORTED",t[t.CLOSED=4]="CLOSED"})(W||(W={}));var B=[[m.WebTimerEvent.APPLICATION_START,m.WebTimerEvent.MARK_TIME_TO_VIEW,m.WebTimerEvent.FETCHED_DATA_FOR_TTI,m.WebTimerEvent.MARK_TIME_TO_INTERACTIVE],[m.WebTimerEvent.TIME_TO_INTERACTIVE]].reverse(),V=1,F=(function(){function t(){f.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger")}return t.prototype.buildBaseParams=function(t,e,i){void 0===i&&(i={});var n=t.start_time,o=t.subtypes||{};t.tti_flow&&(o.tti_flow=t.tti_flow);var r={log_source:e.name,subtypes:JSON.stringify(o),correlation_id:t.correlation_id};t.extra_columns&&Object.keys(t.extra_columns).forEach(function(e){var i=t.extra_columns[e];i&&(r[e]=i)}),Object.keys(i).forEach(function(t){var e=i[t];e&&(r[t]=e)}),s.IS_HTTP2&&(r.is_spdy=!0),t.is_pagelet&&(r.is_pagelet=!0),t.is_dws&&(r.is_dws=!0),t.is_pre_load_js&&(r.is_pre_load_js=!0),
t.is_stream_jsconsts&&(r.is_stream_jsconsts=!0),t.is_early_ensemble&&(r.is_early_ensemble=!0),navigator.serviceWorker&&(r.service_worker_supported=!0,navigator.serviceWorker.controller&&(r.service_worker_active=!0)),r.delayed_tti_for_css=t.delayed_tti_for_css,""!==t.tti_exclusion_flow&&(r.tti_exclusion_flow=t.tti_exclusion_flow);var a;a=t.log_time_to_view&&null!=t.time_to_view?t.time_to_view-n:null;var p;p=t.log_time_to_interactive&&null!=t.time_to_interactive?t.time_to_interactive-n:null;var l={navigation_type:this.get_navigation_type(),server_request_start_time:s.REQUEST_START_TIME,extra_columns:JSON.stringify(r),subtypes:JSON.stringify(o),source_type:t.source_type,page_load_time:t.end_time-t.start_time};return H(l),l.repo_rev=c.REPO_REV,t.log_time_to_view&&(l.time_to_view=a),t.log_time_to_interactive&&(l.time_to_interactive=p),t.request_id&&(l.request_id=t.request_id),l},t.prototype.get_navigation_type=function(){var t=p.performance();if(t&&t.navigation){var e=t.navigation;switch(e.type){case e.TYPE_NAVIGATE:return"navigate";case e.TYPE_RELOAD:return"reload";case e.TYPE_BACK_FORWARD:return"back_forward"}}},t.prototype.log=function(t,e,i){void 0===i&&(i=!1);var r=f.JSStopwatch.startSpan("wtl_endpoint",{stopwatchName:"web_timing_logger"});if(f.JSStopwatch.addSpanAnnotation("wtl_endpoint","navigation_type",t.navigation_type,{stopwatchName:"web_timing_logger",spanId:r}),t.url=p.get_href(),t.referrer=document.referrer,t.request_id=t.request_id||s.REQUEST_ID,t.request_tracing_enabled=s.REQUEST_TRACING_ENABLED,null!=e&&(t.url_info=e),window.ensemble&&window.ensemble.viewer){var a=window.ensemble.viewer.getActiveUser();a&&(t.active_user_id=a.userId)}n.SilentBackgroundRequest({url:"/alternate_wtl",type:"POST",data:t,success:function(t){f.JSStopwatch.endSpan("wtl_endpoint",{stopwatchName:"web_timing_logger",spanId:r});var e=document.getElementsByClassName("perf-hub-link-container");if(i&&e.length){var n=JSON.parse(t);n.status&&o.PerfHubActions.add_web_timing_details(n)}}})},t})(),J=(function(t){function e(){return t.call(this)||this}return i.__extends(e,t),e.prototype.shouldLog=function(t){return t.initialized&&!t.have_logged_web_timing&&void 0!==t.end_time&&(!t.log_time_to_view||null!=t.time_to_view)&&(!t.log_time_to_interactive||null!=t.time_to_interactive)},e.prototype.logTiming=function(t,e){t.have_logged_web_timing=!0;var i=this.buildBaseParams(t,e);this.log(i,void 0,!1)},e.prototype.get_navigation_type=function(){return"ajax"},e})(F),G=(function(t){function e(){return t.call(this)||this}return i.__extends(e,t),e.prototype.shouldLog=function(t){if(!t.initialized||t.have_logged_web_timing)return!1;var e=p.performance();if(!e||!e.timing)return!1;var i=e.timing,n=t.start_time,o=t.end_time;return!(!n||!o)&&(!(t.log_time_to_view&&!(t.ttv_at_dom_interactive&&i.domInteractive||null!=t.time_to_view))&&!(t.log_time_to_interactive&&!(t.tti_at_dom_interactive&&i.domInteractive||null!=t.time_to_interactive)))},e.prototype.logTiming=function(t,e){var i=p.performance().timing;t.ttv_at_dom_interactive&&(t.is_pagelet&&window.ensemble?t.time_to_view=window.ensemble.getEmbeddedAppDOMInteractive():t.time_to_view=i.domInteractive),t.tti_at_dom_interactive&&(t.time_to_interactive=i.domInteractive),g.logEnsembleCacheData(),g.logSWCacheData(),v.stopProfiling(),a.LOG_REACT_PERF_TIMING&&v.logReactPerfSnapshot(s.REQUEST_ID,p.get_href()),f.JSStopwatch.startSpan("process_nav_timing",{stopwatchName:"web_timing_logger"});var n={};t.is_pagelet&&window.ensemble&&(n.service_worker_active_initial=window.ensemble.serviceWorkerActiveOnInitialLoad),t.is_pagelet&&window.ensemble&&window.ensemble.isEmbeddedAppCacheHit&&(n.embedded_app_cache_hit=window.ensemble.isEmbeddedAppCacheHit());var o=this.buildBaseParams(t,e,n);o.browser_time=(i.redirectStart||i.fetchStart)-t.start_time,o.redirect_time=i.fetchStart-t.start_time,o.dns_time=i.domainLookupEnd-t.start_time,o.tcp_connect_time=(i.secureConnectionStart||i.requestStart)-t.start_time,o.ssl_connect_time=i.requestStart-t.start_time,o.time_to_first_byte=i.responseStart-t.start_time,o.time_to_last_byte=i.responseEnd-t.start_time,o.dom_load_time=i.domContentLoadedEventEnd-t.start_time,o.idle_cpu_time=t.timing_results?Math.round(t.timing_results.idleCPUTime):void 0,o.total_tracked_cpu_time=t.timing_results?Math.round(t.timing_results.totalTrackedCPUTime):void 0,o.untracked_time_after_first_byte=t.timing_results&&null!=t.timing_results.untrackedTimeAfterFirstByte?Math.round(t.timing_results.untrackedTimeAfterFirstByte):void 0,p.performance().getEntriesByType&&(j(o),f.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_resources","1",{stopwatchName:"web_timing_logger"})),H(o),f.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_modules","1",{stopwatchName:"web_timing_logger"}),f.JSStopwatch.endSpan("process_nav_timing",{stopwatchName:"web_timing_logger"}),t.is_pagelet&&R(t.correlation_id),w.logBrowserPerfData(t.correlation_id),("navigation"===this.get_navigation_type()||a.LOG_NON_NAVIGATION_RESOURCES)&&(M(t.correlation_id),_.logResourcesData(t.correlation_id)),f.JSStopwatch.log_stored_results(),t.have_logged_web_timing=!0,this.log(o,void 0,!0)},e})(F),z=(function(){function t(t,e,i,n){this.childSpans=[],this.spanName=t,this.startTime=void 0!==i?i:h.WebTimingUtil.getNow(),this.originTs=e,this.startTimeOffsetMS=this.startTime-e,this.endCallback=n}return t.prototype.startSpan=function(e){var i=new t(e,this.originTs);return this.childSpans.push(i),i},t.prototype.markSpan=function(e,i){var n=new t(e,this.originTs,this.startTime);this.childSpans.push(n),n.endSpan(i)},t.prototype.endSpan=function(t){var e=this;this.endTime=void 0!==t?t:h.WebTimingUtil.getNow(),this.childSpans.forEach(function(t){t.hasEnded()||t.endSpan(e.endTime)}),this.endCallback&&this.endCallback(this)},t.prototype.getEndTimeOffsetMS=function(){return void 0!==this.endTime?this.endTime-this.originTs:void 0},t.prototype.hasEnded=function(){return void 0!==this.endTime},t})(),Q=(function(){function t(t,e,i,n){void 0===n&&(n=!1),this.timerState=W.RUNNING,this.loggedEvents=0,this.activeSpans=[],this.endedSpans=[],this.context=t,this.timingStopwatch=e,this.userStopwatch=i,this.id=V++,this.strictAssert=n}return t.prototype.startSpan=function(t){var e=this,i=new z(t,this.context.start_time,void 0,function(t){e.endSpan(t)});return this.activeSpans.push(i),i},t.prototype.markSpan=function(t,e){if(void 0===e&&(e={}),this.userStopwatch){var i=void 0===e.startTime?0:e.startTime,n=this.timeSinceStart(e.endTime),o=this.userStopwatch.startSpan(t,{startTime:i});this.userStopwatch.endSpan(t,{spanId:o,endTime:n})}else{var r=new z(t,this.context.start_time,e.startTime);r.endSpan(e.endTime),this.endedSpans.push(r)}},t.prototype.endSpan=function(t){var e=this.activeSpans.indexOf(t);e>=0&&(delete this.activeSpans[e],this.userStopwatch?this.recordSpan(t):this.endedSpans.push(t))},t.prototype.recordSpan=function(t){var e=this,i=this.userStopwatch.startSpan(t.spanName,{startTime:t.startTimeOffsetMS});t.childSpans.forEach(function(t){e.recordSpan(t)}),this.userStopwatch.endSpan(t.spanName,{spanId:i,endTime:t.getEndTimeOffsetMS()})},t.prototype.applicationStart=function(){this.logEvent(m.WebTimerEvent.APPLICATION_START)},t.prototype.fetchedDataRequiredForTTI=function(){this.logEvent(m.WebTimerEvent.FETCHED_DATA_FOR_TTI)},t.prototype.startTime=function(){return this.context.start_time},t.prototype.timeSinceStart=function(t){return(t||h.WebTimingUtil.getNow())-this.context.start_time},t.prototype.timeToView=function(){return this.context.time_to_view},t.prototype.timeToInteractive=function(){return this.context.time_to_interactive},t.prototype.setExtraColumns=function(t){this.context.extra_columns=t},t.prototype.excludeFromTTI=function(t){""!==this.context.tti_exclusion_flow&&(this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+","),this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+t},t.prototype.logEvent=function(t,e){this.loggedEvents|=t.flag,t.ordered&&this.validateEventOrder(t),this.timingStopwatch.recordTrace(t.name,this.timeSinceStart(e)),console.timeStamp&&console.timeStamp(t.timestampPrefix),t.triggersLogging&&this.logIfReady(t)},t.prototype.validateEventOrder=function(t){for(var e=0,i=0,n=B;i<n.length;i++){var o=n[i];if(o.includes(t))break;for(var r=0,s=o;r<s.length;r++){e|=s[r].flag}}var a=e&this.loggedEvents;if(a>0){var c=m.WebTimerEvent.allEvents.filter(function(t){return(t.flag&a)>0}).map(function(t){return t.name});this.reportSwMisuse("Received "+t.name+" after ["+c.join(",")+"]")}},t.prototype.logIfReady=function(t){this.logger.shouldLog(this.context)&&(this.timingStopwatch.logData(),this.userStopwatch.logData(),this.logger.logTiming(this.context,t),this.timerState=W.CLOSED)},t.prototype.reportSwMisuse=function(t){t="WebTimer: "+t,this.strictAssert?l.assert(!1,t):l.reportStack(t,{severity:l.SEVERITY.NONCRITICAL,tags:["web_timing_logger"]})},t})(),Y=(function(t){function e(e){var i=t.call(this,e,f.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),f.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1)||this;return i.logger=new J,i}return i.__extends(e,t),e.prototype.initialize=function(t){this.context.initialized||(this.context.initialized=!0,this.context.log_time_to_view=t.requireTTV,this.context.log_time_to_interactive=t.requireTTI,this.context.tti_flow=t.url,this.timingStopwatch.url=this.context.tti_flow,this.userStopwatch.url=this.context.tti_flow)},e.prototype.start=function(){this.isUsable()&&this.timerState===W.NEW&&(this.context.start_time=h.WebTimingUtil.getNow(),this.timerState=W.RUNNING)},e.prototype.restart=function(){this.loggedEvents=0,this.context.correlation_id=h.WebTimingUtil.generateCorrelationId(),this.context.start_time=h.WebTimingUtil.getNow(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=W.RUNNING,this.timingStopwatch=f.JSStopwatch.createDetachedStopwatch("maestro_tracing",{url:this.context.tti_flow,correlation_id:this.context.correlation_id}),this.userStopwatch=f.JSStopwatch.createDetachedStopwatch("user_tracing",{url:this.context.tti_flow,correlation_id:this.context.correlation_id})},e.prototype.abort=function(){this.timerState!==W.CLOSED&&(this.timerState=W.ABORTED)},e.prototype.markTimeToView=function(){this.isUsable()&&(null==this.context.time_to_view&&(this.context.time_to_view=h.WebTimingUtil.getNow()),this.logEvent(m.WebTimerEvent.MARK_TIME_TO_VIEW))},e.prototype.markTimeToInteractive=function(){var t=this;this.isUsable()&&(this.logEvent(m.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),p.is_page_content_hidden()?this.reportTTI():window.requestAnimationFrame(function(){v.stopProfiling(),t.reportTTI()}))},e.prototype.reportTTI=function(){if(null==this.context.time_to_interactive){this.context.time_to_interactive=h.WebTimingUtil.getNow(),this.logEvent(m.WebTimerEvent.TIME_TO_INTERACTIVE);var t=document.createEvent("Event");t.initEvent("TTI."+this.id,!0,!0),window.dispatchEvent(t)}},e.prototype.end=function(t){this.isUsable()&&(void 0===this.context.end_time&&(this.context.end_time=h.WebTimingUtil.getNow()),this.context.request_id=t,this.timingStopwatch.request_id=t,this.userStopwatch.request_id=t,this.logEvent(m.WebTimerEvent.LOAD_END))},e.prototype.waitForTTI=function(){var t=this;return new Promise(function(e,i){if(null!=t.context.time_to_interactive)return void e();var n=function(i){window.removeEventListener("TTI."+t.id,n),e()};window.addEventListener("TTI."+t.id,n)})},e.prototype.isUsable=function(){return this.timerState===W.NEW||this.timerState===W.RUNNING},e})(Q),K=(function(t){function e(e){var i=t.call(this,e,f.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),f.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1)||this;return i.logger=new G,i}return i.__extends(e,t),e.prototype.initialize=function(t){var e=this;if(!this.context.initialized){if(!p.performance())return;this.context.log_time_to_view=t.requireTTV,this.context.log_time_to_interactive=t.requireTTI,this.context.is_pagelet=!!t.is_pagelet,this.context.is_dws=!!t.is_dws,this.context.is_pre_load_js=!!t.is_pre_load_js,this.context.is_stream_jsconsts=!!t.is_stream_jsconsts,this.context.is_early_ensemble=!!t.is_early_ensemble,this.context.ttv_at_dom_interactive=!!t.ttv_at_dom_interactive,this.context.tti_at_dom_interactive=!!t.tti_at_dom_interactive,this.context.source_type=null!=t.source_type?t.source_type:"web",this.context.subtypes=null!=t.subtypes?t.subtypes:{},this.context.tti_exclusion_flow=null!=t.tti_exclusion_flow?t.tti_exclusion_flow:"",this.context.have_logged_web_timing=!1,this.context.delayed_tti_for_css=!1,this.context.initialized=!0;var i=0;a.LOG_JS_MODULE_TIMING&&a.LOG_TIMING_DELAY&&(i=600),f.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),r.window_load(function(){setTimeout(function(){return e.end()},i)}),d.onPageRestore(function(t){var i=f.JSStopwatch.createDetachedStopwatch("browser_perf",{correlation_id:e.context.correlation_id});i.recordTrace("page_restore"),i.logData()}),!this.context.ttv_at_dom_interactive&&window._timingData&&(null!=window._timingData.ttv&&(this.context.time_to_view=window._timingData.ttv.getTime(),this.logEvent(m.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),null!=window._timingData.tti&&(this.context.time_to_interactive=window._timingData.tti.getTime(),this.logEvent(m.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive)))}},e.prototype.start=function(){this.isUsable()&&this.timerState===W.NEW&&(this.timerState=W.RUNNING)},e.prototype.restart=function(){this.loggedEvents=0,this.context.correlation_id=h.WebTimingUtil.generateCorrelationId(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=W.RUNNING,this.timingStopwatch=f.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:this.context.correlation_id}),this.userStopwatch=f.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:this.context.correlation_id})},e.prototype.abort=function(){this.timerState!==W.CLOSED&&(this.timerState=W.ABORTED)},e.prototype.markTimeToView=function(){this.isUsable()&&(null!=this.context.time_to_view||this.context.ttv_at_dom_interactive||(window._timingData&&null!=window._timingData.ttv?this.context.time_to_view=window._timingData.ttv.getTime():this.context.time_to_view=h.WebTimingUtil.getNow(),this.logEvent(m.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)))},e.prototype.markTimeToInteractive=function(){var t=this;if(this.isUsable())return window.ensemble&&window.ensemble.waitingForCss?(this.context.delayed_tti_for_css=!0,void(window.ensemble.mark_tti_callback=function(){t.markTimeToInteractive()})):void(null!=this.context.time_to_interactive||this.context.tti_at_dom_interactive||(this.logEvent(m.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),p.is_page_content_hidden()?this.reportTTI():window.requestAnimationFrame(function(){v.stopProfiling(),t.reportTTI()})))},e.prototype.reportTTI=function(){if(null==this.context.time_to_interactive)if(window._timingData&&null!=window._timingData.tti?this.context.time_to_interactive=window._timingData.tti.getTime():this.context.time_to_interactive=h.WebTimingUtil.getNow(),console.timeStamp&&console.timeStamp("TTI"),window.ensemble&&window.ensemble.snapshotTimingProfile&&(this.context.timing_results=window.ensemble.snapshotTimingProfile()||null),this.logEvent(m.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),window.ensemble&&window.ensemble.markTTI)window.ensemble.markTTI();else{var t=document.createEvent("Event");t.initEvent("TTI",!0,!0),window.dispatchEvent(t)}},e.prototype.end=function(t){this.isUsable()&&void 0===this.context.end_time&&(this.context.end_time=h.WebTimingUtil.getNow(),this.logEvent(m.WebTimerEvent.LOAD_END))},e.prototype.waitForTTI=function(){var t=this;return new Promise(function(e,i){if(window.ensemble){if(window.ensemble.ttiMarked)return void e()}else if(null!=t.context.time_to_interactive)return void e();var n=function(t){window.removeEventListener("TTI",n),e()};window.addEventListener("TTI",n)})},e.prototype.isUsable=function(){return this.timerState===W.NEW||this.timerState===W.RUNNING},e})(Q),X={},$=new K(h.WebTimingUtil.newContext(!1));e.get_timer=y,e.delete_timer=E,e.time_to_view=b,e.time_to_interactive=I,e.initialize_module=x,e.reset=N,e.start_time=C,e.time_since_start=A,e.set_tti_exclusion_flow=D,e.logEnsembleStopwatch=R,e.mark_time_to_view=P,e.mark_time_to_interactive=k,e.waitForTTI=U,e.log_js_modules_application_code_start=L,e.log_js_modules_fetched_data_required_for_tti=q}),define("modules/clean/window_util",["require","exports"],function(t,e){"use strict";function i(t){function e(){t(),window.removeEventListener("beforeunload",e)}window.addEventListener("beforeunload",e)}function n(t){function e(i){i.persisted&&(t(),window.removeEventListener("pageshow",e))}window.addEventListener("pageshow",e)}Object.defineProperty(e,"__esModule",{value:!0}),e.onBeforeUnload=i,e.onPageRestore=n});
//# sourceMappingURL=pkg-prompt.min.js-vflbqtsk8.map