define("modules/clean/profile_services/popup_handler",["require","exports","external/underscore"],function(e,t,r){"use strict";function i(e){var t=r.uniqueId(),i=function(t){var r;try{r=JSON.parse(t.data)}catch(e){return}r&&"db:profile_service:auth_complete"===r.type&&e(r.payload)};return window.addEventListener("message",i),o[t]=i,t}function s(e){var t=o[e];t&&(delete o[e],window.removeEventListener("message",t))}Object.defineProperty(t,"__esModule",{value:!0});var o={};t.addAuthCompleteListener=i,t.removeAuthCompleteListener=s}),function(){define("modules/clean/profile_services/profile_services_constants",["modules/core/exception","modules/core/i18n"],function(e,t){var r,assert;return assert=e.assert,r=t._,{GOOGLE:"1",YAHOO:"2",FACEBOOK:"3",TWITTER:"4",YAHOO_LEGACY:"5",MOBILE:"6",OUTLOOK:"7",SLACK:"8",NEVER_CONNECTED:0,WAS_CONNECTED:1,IS_CONNECTED:2,VARIOUS:"-1",NONE:"-2",services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK,this.TWITTER,this.YAHOO_LEGACY,this.OUTLOOK,this.SLACK]},importable_contact_services:function(){return[this.GOOGLE,this.YAHOO]},to_img:function(e){switch(e){case this.GOOGLE:return["/static/images/contacts/import_icon_gmail-vflFQwVYO.png","/static/images/contacts/import_icon_gmail@2x-vflO2fTFE.png"];case this.YAHOO:case this.YAHOO_LEGACY:return["/static/images/contacts/import_icon_yahoo-vfl5E728M.png","/static/images/contacts/import_icon_yahoo@2x-vflnVdi5R.png"];case this.FACEBOOK:return["/static/images/contacts/import_icon_facebook-vfluFbt1j.png","/static/images/contacts/import_icon_facebook@2x-vfl7Zk5rR.png"];case this.OUTLOOK:return["/static/images/contacts/import_icon_outlook-vflF1_UKs.png","/static/images/contacts/import_icon_outlook@2x-vflVjRgD3.png"];default:return assert(!1,"Should never get ProfileServicesConstants.to_img with service: "+e)}},to_name:function(e){switch(e){case this.GOOGLE:return r("Gmail");case this.YAHOO:return r("Yahoo! Mail");case this.FACEBOOK:return r("Facebook");case this.VARIOUS:return r("Email");case this.YAHOO_LEGACY:return r("Yahoo! Mail");case this.OUTLOOK:return r("Outlook");case this.SLACK:return r("Slack");default:return assert(!1,"Should never get ProfileServicesConstants.to_name with service: "+e)}},logging_identifiers:function(e){switch(e){case this.GOOGLE:return"google";case this.YAHOO:return"yahoo";case this.FACEBOOK:return"facebook";case this.VARIOUS:return"email";case this.YAHOO_LEGACY:return"yahoo_legacy";case this.OUTLOOK:return r("outlook");case this.SLACK:return r("slack");default:return assert(!1,"Should never get ProfileServicesConstants.logging_identifiers with service: "+e)}}}})}.call(this),define("modules/clean/profile_services/profile_services_link",["require","exports","jquery","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/analytics","modules/clean/profile_services/popup_handler","modules/clean/profile_services/profile_services_constants","modules/clean/viewer","modules/constants/login_and_register"],function(e,t,r,i,s,o,n,c,_,u,a,l,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(){function e(e,t){void 0===t&&(t=null);var i=this;this._update_on_auth_event=function(e){if(e.user_id===i.user_id){i.is_updated=!1,i.get_or_update_connected_state(!0);for(var t in i.serviceChangeCallbacks)i.serviceChangeCallbacks.hasOwnProperty(t)&&i.serviceChangeCallbacks[t](i)}},s.assert(null!==e,"No user id provided"),this.user_id=e,this.connectedServices={},this.is_updated=!1,this.get_or_update_connected_state(!0,t),this.serviceChangeCallbacks={},a.addAuthCompleteListener(this._update_on_auth_event),r(document).on("db:profile_service:deauth_complete",this._update_on_auth_event)}return e.get_linked_profile_services_for_user=function(t,r){void 0===r&&(r=null),s.assert(null!==t,"No user_id: LinkedProfileServices.get_linked_profile_services_for_user()");var i=this._LINKED_PROFILE_SERVICES[t];return void 0!==i?i.get_or_update_connected_state(!1,r):(i=new e(t,r),this._LINKED_PROFILE_SERVICES[t]=i),i},e.prototype.get_or_update_connected_state=function(e,t){var r=this;void 0===e&&(e=!1),void 0===t&&(t=null),this.is_updated&&!e?null!==t&&t(this):_.BackgroundRequest({url:"/profile_services/connected_services",subject_user:this.user_id,dataType:"json",success:function(e,i,s){r.connectedServices=e,r.is_updated=!0,null!==t&&t(r)}})},e.prototype.connected_accounts_for_service=function(e){return this.connectedServices[e]?r.map(this.connectedServices[e],function(e){return e.source_id}):[]},e.prototype.has_connected_services=function(){for(var e=0,t=l.services();e<t.length;e++){var r=t[e];if(this.service_is_connected(r))return!0}return!1},e.prototype.has_unconnected_services=function(e){void 0===e&&(e=!1);for(var t=e?l.importable_contact_services():l.services(),r=0,i=t;r<i.length;r++){var s=i[r];if(s!==l.YAHOO_LEGACY&&!this.service_is_connected(s))return!0}return!1},e.prototype.service_is_connected=function(e){if(s.assert(l.services().indexOf(e)!==-1,"Not a valid profile service"),null==this.connectedServices[e])return!1;for(var t=0,r=this.connectedServices[e];t<r.length;t++){if(r[t].connection_state===l.IS_CONNECTED)return!0}return!1},e.prototype.service_was_connected=function(e){if(s.assert(l.services().indexOf(e)!==-1,"Not a valid profile service"),null==this.connectedServices[e])return!1;for(var t=0,r=this.connectedServices[e];t<r.length;t++){if(r[t].connection_state===l.WAS_CONNECTED)return!0}return!1},e.prototype.register_for_service_changes=function(e,t){return this.serviceChangeCallbacks[e]=t},e})();v._LINKED_PROFILE_SERVICES={},t.LinkedProfileServices=v;var h=(function(){function e(){this._redirect_to_identity_provider=this._redirect_to_identity_provider.bind(this),this.deauth_service=this.deauth_service.bind(this),this._popup_window=null}return e.show_import_notifications=function(e){if(e.success)switch(u.TeamsWebActionsLogger.log("import_contacts_complete",{provider:l.logging_identifiers(e.provider),path:i.get_uri().getPath()}),e.provider){case l.GOOGLE:n.success(o._("Imported Gmail Contacts."));break;case l.YAHOO:n.success(o._("Imported Yahoo! Mail contacts."));break;case l.OUTLOOK:n.success(o._("Imported Outlook Mail contacts."));break;case l.FACEBOOK:n.success(o._("Successfully connected to Facebook."))}else null!==e.err_msg?n.error(e.err_msg):n.error(o._("There was a problem completing this request."))},e.show_verify_link_result=function(e){return e.success?n.success(o._("Verified account and imported contacts")):null!==e.err_msg&&void 0!==e.err_msg?n.error(e.err_msg):n.error(o._("Couldnâ€™t link account. Please try again."))},e.prototype._attach_popup_handlers=function(e){var t=this,r=null,i=function(i){a.removeAuthCompleteListener(r),null!=t._popup_window&&t._popup_window.close(),t._popup_window=null,null!=e&&e(i)};r=a.addAuthCompleteListener(i)},e.prototype._post_redirect_to_url=function(e,t,r,s){void 0===s&&(s=null);var o=new c({path:"/profile_services/redirect_to_identity_provider",query:t}).toString();if(r){this._attach_popup_handlers(s);var n=l.to_name(e);this._popup_window=window.open(o,n,"width=600,height=600,resizable=1,scrollbars=1")}else i.redirect(o)},e.prototype._redirect_to_identity_provider=function(e,t,r,i,s,o,n){void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=!0),void 0===n&&(n=null);var c={service:e,is_popup:o.toString(),action:t,prompt_select:"true",token:p.REDIRECT_WINDOW_TOKEN};return null!==r&&(c.user_id=r.toString()),null!==s&&(c.referrer=s),null==n?c.is_desktop="false":"desktop"===n.kind?(c.is_desktop="true",c.host_nonce=n.host_nonce,null!==n.login_hint&&(c.login_hint=n.login_hint)):(c.is_desktop="false",c.remember_me=n.remember_me.toString(),c.cont=n.cont,c.pair_user=n.pair_user.toString()),this._post_redirect_to_url(e,c,o,i)},e.prototype.auth_service_with_user=function(e,t,r,i){void 0===r&&(r=null),void 0===i&&(i=null),s.assert(null!==e,"No service provided to auth_service_with_user"),s.assert(null!==t,"No user_id provided to auth_service_with_user");var o=d.get_viewer().get_user_by_id(t);return s.assert(null!==o,"No user for user_id "+t),this._redirect_to_identity_provider(e,"link_contacts",t,r,i)},e.prototype.auth_service_with_user_promise=function(e,t){var r=this;return new Promise(function(i){r.auth_service_with_user(e,t,i)})},e.prototype.auth_service_with_specified_user=function(e,t,r,i){s.assert(null!==e,"No service provided"),s.assert(null!==t,"No user_id provided");var o=d.get_viewer().get_user_by_id(t);return s.assert(null!==o,"No user for user_id "+t),this._redirect_to_identity_provider(e,"link_target_user",t,r,i)},e.prototype.auth_service_create_user_if_needed=function(e,t,r,i){return void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=!0),s.assert(null!==e,"No service provided to create user"),this._redirect_to_identity_provider(e,"create_user",null,t,r,i)},e.prototype.auth_service_login_desktop=function(e,t,r,i){void 0===i&&(i=null),s.assert(null!==e,"No service provided to login desktop");var o={kind:"desktop",host_nonce:r,login_hint:i};this._redirect_to_identity_provider(e,"login_user",null,t,null,!0,o)},e.prototype.auth_service_login_web=function(e,t,r,i,o,n,c){s.assert(null!==e,"No service provided to login web");var _={kind:"web",remember_me:o,cont:n,pair_user:c};this._redirect_to_identity_provider(e,"login_user",null,t,r,i,_)},e.prototype.auth_service_link_calendar=function(e,t,r,i){s.assert(null!==e,"No service provided"),s.assert(null!==t,"No user_id provided");var o=d.get_viewer().get_user_by_id(t);return s.assert(null!==o,"No user for user_id "+t),this._redirect_to_identity_provider(e,"link_calendar",t,r,i,!0)},e.prototype.deauth_service=function(e,t,i,o){void 0===i&&(i=null),void 0===o&&(o=null);var n=parseInt(t,10),c=function(t){if(!t.service_is_connected(e)&&null!==o)return void o(!0);null!==i&&s.assert(t.connected_accounts_for_service(e).indexOf(i)!==-1,"Service is not currently connected"),_.WebRequest({url:"/profile_services/unlink",subject_user:n,data:{service:e,source_id:i},success:function(e,t,i){return r(document).trigger(r.Event("db:profile_service:deauth_complete",{user_id:n})),"function"==typeof o?o(!0):void 0},error:function(e,t,r){return"function"==typeof o?o(!1):void 0}})};s.assert(l.services().indexOf(e)!==-1,"Not a valid profile service"),s.assert(null!==n,"No user_id provided"),v.get_linked_profile_services_for_user(n,c)},e})();t.ProfileServicesLinkingHandler=h});
//# sourceMappingURL=pkg-profile_services.min.js-vflnc6mqt.map