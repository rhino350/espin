(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/captcha",["jquery","external/react","external/react-dom","modules/clean/ajax","modules/clean/react/recaptcha_challenge","modules/core/i18n","modules/core/notify"],function(t,i,r,o,n,s,a){var c,l;return c=s._,l=i.createElement,(function(){function i(t,i,r,o,n,s,a){var c;this.parent_form=t,this.captcha_div=i,this.other_recaptcha_div=r,this.endpoint=o,this.email_name=n,this.variant=s,this.is_v2=a,this.captcha_display_handler=e(this.captcha_display_handler,this),this._hide_other_captcha=e(this._hide_other_captcha,this),this._hide_captcha_v2=e(this._hide_captcha_v2,this),this._hide_captcha=e(this._hide_captcha,this),this._show_captcha_v2=e(this._show_captcha_v2,this),this._show_captcha=e(this._show_captcha,this),this.$recaptcha_container=null!=(c=this.parent_form.find(this.captcha_div))?c[0]:void 0,this.$recaptcha_react_component=null}return i.prototype._show_captcha=function(e,t){var i,o;return null==(null!=(o=this.$recaptcha_container)?o.children:void 0)&&(this.$recaptcha_react_component=null),null==this.$recaptcha_react_component?(i=l(n,{public_key:e,variant:this.variant,error:t}),this.$recaptcha_react_component=r.render(i,this.$recaptcha_container)):this.$recaptcha_react_component.reload(t)},i.prototype._show_captcha_v2=function(e,i){return t("#"+this.captcha_div).parent().show(),t("#"+this.captcha_div).children().length?"undefined"!=typeof grecaptcha&&null!==grecaptcha?grecaptcha.reset():void 0:"undefined"!=typeof grecaptcha&&null!==grecaptcha?grecaptcha.render(this.captcha_div,{sitekey:e}):void 0},i.prototype._hide_captcha=function(){var e;if(null==(null!=(e=this.$recaptcha_container)?e.children:void 0)&&(this.$recaptcha_react_component=null),null!=this.$recaptcha_react_component)return r.unmountComponentAtNode(this.$recaptcha_container),this.$recaptcha_react_component=null},i.prototype._hide_captcha_v2=function(){return t("#"+this.captcha_div).parent().hide()},i.prototype._hide_other_captcha=function(){var e;if(e=t(this.other_recaptcha_div)[0],null!=(null!=e?e.children:void 0))return r.unmountComponentAtNode(e)},i.prototype.captcha_display_handler=function(e){return o.WebRequest({url:this.endpoint,data:{email:this.parent_form.find("input[name='"+this.email_name+"']").val()},success:(function(t){return function(i){var r;try{return r=JSON.parse(i),r.needs_captcha?(t._hide_other_captcha(),t.is_v2?t._show_captcha_v2(r.recaptcha_v2_public_key,e):t._show_captcha(r.recaptcha_public_key,e)):t.is_v2?t._hide_captcha_v2():t._hide_captcha()}catch(e){return e,a.error(c("There was a problem completing this request."))}}})(this)})},i})()})}).call(this),function(){define("modules/clean/form_util/name_parser",[],function(){return(function(){function e(){}return e.splitFullName=function(e){var t,i,r;return r=e.split(" "),t=r[0],i=r.slice(1).join(" "),[t,i]},e})()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/header_bubble",[],function(){return(function(){function t(t,i){this.$element=t,this.options=i,this.hide=e(this.hide,this),this.$element.parent().addClass("active"),this.$element.find(".confirm-button").on("click",this.hide),this.$element.find(".dismiss-button").on("click",this.hide)}return t.prototype.hide=function(e){return"#"===e.target.getAttribute("href")&&e.preventDefault(),this.$element.parent().removeClass("active")},t})()})}.call(this),function(){define("modules/clean/hi_res",["jquery"],function(e){return(function(){function t(e){var t;this.constructor._show_hi_res()&&(t=e.attr("data-hi-res-no-resize"),this.constructor.set_src(e,e.attr("data-hi-res"),t),this.constructor.set_bg(e,e.attr("data-hi-res-background"),t))}return t.set_src=function(e,t,i){if(this._show_hi_res())return t&&t!==e.attr("src")?this._replace(e,t,!i,this._replace_img):void 0},t.set_bg=function(e,t,i){if(this._show_hi_res())return this._replace(e,t,!i,this._replace_background)},t._show_hi_res=function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1},t._replace=function(t,i,r,o){var n;if(i)return n=new Image,n.src=i,e(n).on("load",function(){return o(t,i,r,n.width,n.height)})},t._replace_img=function(e,t,i,r,o){if(e.attr("src",t),i)return e.width(r/2),e.height(o/2)},t._replace_background=function(e,t,i,r,o){var n;if(n="url('%(src)s')".format({src:t}),e.css("backgroundImage",n),i)return e.css("backgroundSize",r/2+"px "+o/2+"px")},t})()})}.call(this),define("modules/clean/legacy_pyxl_controllers/login_form",["require","exports","external/cyfd","external/pixie","external/u2f-api","jquery","modules/clean/ajax","modules/clean/captcha","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/sso_login_checks","modules/constants/pixie","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,i,r,o,n,s,a,c,l,h,u,p,d,_,m,g,f){"use strict";var v=new r.Pixie(p).get_specter();v.start();var b=(function(){function t(t,i,r,o,l,h,p,_,v,b,y){void 0===o&&(o=!1),void 0===l&&(l=!0),void 0===h&&(h=!1),void 0===p&&(p=null),void 0===_&&(_=null),void 0===v&&(v=!0),void 0===b&&(b=!0),void 0===y&&(y=!1);var w=this;this.loginType=i,this.variant=r,this.inlineGoogleLoginErrors=h,this.signupTag=p,this.signupEndpoint=_,this.canRedirect=v,this.keepUrlFragment=b,this.useCurrentUri=y,this.multiLogin="multi"===this.loginType,this.pairing="pairing"===this.loginType,this.$loginForm=t.find(".login-form"),this.$googleAuthContainer=t.find(".login-form-container__google-div"),this.$allTwoFactorForms=t.find(".two-factor-form"),this.$twoFactorPhoneForm=t.find(".two-factor-form.2fa-phone-form"),this.$twoFactorSeckeyForm=t.find(".two-factor-form.2fa-seckey-form"),this.$loginViaEmailForm=t.find(".login-via-email-link"),this.$twoFactorForm=this.$twoFactorPhoneForm,o||e(["modules/clean/unity/features/web_destiny_ui"],function(e){new e(t).maybe_show_web_destiny()}),this.loginController=new c(this.$loginForm,this.beforeSubmit.bind(this),{should_submit_once:!0});var F={preventDefault:function(){}};if(this.$loginForm.find(".recaptcha_invisible_challenge").length){var $=function(){var e=n(n("body").find("[title='recaptcha challenge']")).css("visibility");w.loginController.add_additional_data({invisible_captcha_present:w.$loginForm.find(".recaptcha_invisible_challenge").length>0,invisible_captcha_shown:"visible"===e}),w.loginController._submit_form(F)},k=n(this.$loginForm.find(".recaptcha_invisible_challenge"));this.invisible_widget_id=window.grecaptcha.render(k.attr("id"),{sitekey:k.attr("data-sitekey"),badge:"inline",callback:$},!0),this.$loginForm.off("submit"),this.$loginForm.submit(function(e){e.preventDefault(),e.stopImmediatePropagation(),s.WebRequest({type:"POST",url:"/needs_captcha",data:{email:w.$loginForm.find("input[name='#login_email']").val(),invisible:!0},success:function(e){JSON.parse(e).captcha_whitelisted?w.loginController._submit_form(F):window.grecaptcha.execute(w.invisible_widget_id)},error:function(){g.error(m._("There was a problem completing this request."))}})})}else if(this.$loginForm.find(".recaptcha_v2_challenge").length){var C=n(this.$loginForm.find(".recaptcha_v2_challenge"));this.$captchaComponent=new a(this.$loginForm,C.attr("id"),null,"/needs_captcha","login_email",this.variant,!0)}else this.$captchaComponent=new a(this.$loginForm,"#react-login-recaptcha-challenge-div","#react-signup-recaptcha-challenge-div","/needs_captcha","login_email",this.variant);this.$loginForm.on(c.SUCCESS_EVENT,this.loginSuccess.bind(this)),this.$loginForm.on(c.ERROR_EVENT,function(e,t){if(w.$loginForm.find(".recaptcha_invisible_challenge").length)window.grecaptcha.reset(w.invisible_widget_id);else{var i=null!=t?t.recaptcha_response:void 0;w.$captchaComponent.captcha_display_handler(i)}return w.$loginForm.find(".login-via-email-blade-link").click(w.loginViaEmailStart.bind(w))}),this.$loginForm.is(":visible")&&0===this.$loginForm.find(".recaptcha_invisible_challenge").length&&this.$captchaComponent.captcha_display_handler();var S=f.parse(this.$loginForm.find("input[name='cont']").val());this.useCurrentUri&&(S=f.parse(d.get_href())),this.keepUrlFragment&&S.setFragment(window.location.hash.substr(1)),this.cont=S.toString(),this.twoFactorPhoneController=new c(this.$twoFactorPhoneForm,function(){return null},{should_submit_once:!0}),this.twoFactorSeckeyController=new c(this.$twoFactorSeckeyForm,function(){return null},{should_submit_once:!0}),this.twoFactorController=this.twoFactorPhoneController,this.$twoFactorPhoneForm.on(c.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(c.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(c.ERROR_EVENT,function(e,t){return w.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions .error-msg").text(t.u2f.message_text),w.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle()}),this.$twoFactorPhoneForm.find(".resend-two-factor-code").click(this.resendCode.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-use-phone-instead").click(this.usePhoneInstead.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-seckey-retry").click(this.retryU2fChallenge.bind(this)),null!=this.$loginViaEmailForm&&this.$loginViaEmailForm.click(this.loginViaEmailStart.bind(this)),this.$googleAuthContainer.find(".auth-google").click(this.googleLogin.bind(this)),this.$googleAuthContainer.find(".auth-google").prop("disabled",!1);var E=this.$twoFactorSeckeyForm.find("input[name='u2f_challenge']").val();E&&this.signU2fChallenge(E),this.$loginForm.find(".sso-optout a").click(function(){return w.hideSso(!0)}),this.$loginForm.find(".login-button").attr("disabled",null),this.$loginForm.find(".login-button.disabled-button").prop("disabled",!0),l&&t.find(".login-need-help a").click(function(e){e.preventDefault();var t=n(e.target).attr("href"),i=encodeURIComponent(w.$loginForm.find("input[name='login_email']").val());return d.redirect(t+"?email_from_login="+i)}),this.setFocusToPassword(),new u.SsoLoginChecks(this.$loginForm.find("input[name='login_email']"),this.showSso.bind(this),this.hideSso.bind(this))}return t.prototype.ie8SafeFocus=function(e){try{e.focus()}catch(e){}},t.prototype.setFocusToPassword=function(){this.$loginForm.find("input[name='login_email']").first().val()&&this.ie8SafeFocus(this.$loginForm.find("input[name='login_password']")[0])},t.prototype.isRememberMeChecked=function(){return"on"===this.$loginForm.find("input[name='remember_me']:checked").val()},t.prototype.setFocusToTwofactor=function(){this.ie8SafeFocus(this.$twoFactorForm.find("input[name='code']").val(""))},t.prototype.googleLogin=function(){c.clear_errors(this.$loginForm);var e=this.isRememberMeChecked(),t=new h.ProfileServicesLinkingHandler,i=this.$googleAuthContainer.find(".auth-google").data("is-popup");t.auth_service_login_web(l.GOOGLE,this.googleLoginCallback.bind(this),"login_form",i,e,this.cont,this.pairing)},t.prototype.googleLoginCallback=function(e){if(e.success)g.success(m._("Log in successful! Your browser will be redirected in a few seconds.")),s.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success"}}),d.redirect(this.cont?this.cont:"/home");else if(s.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error"}}),"emails_do_not_match_redirect"===e.err_msg){var t=this.getThirdPartyAuthUrl(e,!0);d.redirect(t)}else"emails_do_not_match"===e.err_msg&&this.inlineGoogleLoginErrors&&!this.pairing?this.handleEmailsDoNotMatch(e):"tfa_required"===e.err_msg?this.redirectToPath(e,"/verify_code"):"not_verified"===e.err_msg?this.redirectToPath(e,"/show_password_form"):(e.localized_error&&g.error(e.localized_error),"google_login_not_allowed"!==e.err_msg&&"sso_required"!==e.err_msg||this.fillInEmail(e.profile.email))},t.prototype.handleEmailsDoNotMatch=function(e){var t=this.getThirdPartyAuthUrl(e,!1);this.$googleAuthContainer.find(".third-party-signup-link").attr("href",t),this.$googleAuthContainer.find(".google-login-error").removeClass("u-l-dn")},t.prototype.getThirdPartyAuthUrl=function(e,t){var i={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,refresh_token:e.refresh_token,email_sig:e.email_sig,automatic_redirect:t.toString(),cont:this.cont};return this.signupTag&&(i.signup_tag=this.signupTag),this.signupEndpoint&&(i.signup_endpoint=this.signupEndpoint),String(new f({path:"/third_party_signup"}).updateQuery(i))},t.prototype.fillInEmail=function(e){this.$loginForm.find("input[name='login_email']").val(e),this.$loginForm.find("input[name='login_email']").trigger("input"),this.setFocusToPassword()},t.prototype.redirectToPath=function(e,t){var i=new f({path:t}).updateQuery({cont:this.cont,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});d.redirect(i.toString())},t.prototype.beforeSubmit=function(){i.cfsubmit(),this.loginController.add_additional_data({specter_login_tm:v.dump()})},t.prototype.showSso=function(e){this.$loginForm.find("input[name='login_password']").val(""),this.$loginForm.addClass("sso-required"),e&&this.$loginForm.addClass("sso-optional")},t.prototype.hideSso=function(e){if(void 0===e&&(e=!1),this.$loginForm.removeClass("sso-required sso-optional"),e)try{this.$loginForm.find("input[name='login_password']").focus()}catch(e){}},t.prototype.browserSupportsU2F=function(){return void 0!==MessageChannel},t.prototype.showLogin=function(){this.$twoFactorForm.hide(),n(".login-register-header, .login-register-switch").show(),this.$loginForm.show(),this.$loginForm.find("input[name='login_password']").val(""),this.$googleAuthContainer.show()},t.prototype.setupTwoFactor=function(e){e.u2f_challenge&&this.browserSupportsU2F()&&(this.$twoFactorForm=this.$twoFactorSeckeyForm,this.twoFactorController=this.twoFactorSeckeyController,this.signU2fChallenge(e.u2f_challenge)),e.last_two_digits?(this.$allTwoFactorForms.addClass("hide-authenticator"),this.$twoFactorPhoneForm.find(".last-two-digits").text(e.last_two_digits)):this.$allTwoFactorForms.addClass("hide-sms"),this.$twoFactorForm.find("input[name='remember_me']").val(e.remember_me),e.remember_me&&this.$twoFactorForm.find("a[class='twofactor_recovery_url']").attr("href",function(e,t){return f.parse(t).updateQuery({remember_me:"true"}).toString()}),this.showTwoFactor()},t.prototype.showTwoFactor=function(){n(".login-register-header, .login-register-switch").hide(),this.$loginForm.hide(),this.$googleAuthContainer.hide(),this.$twoFactorForm.show(),this.setFocusToTwofactor()},t.prototype.loginSuccess=function(e,t){switch(t.status){case"OK":return this.finishLogin(t);case"TWOFACTOR":return this.setupTwoFactor(t);case"TWOFACTOR_REQUIRED":return d.redirect(t.cont);case"LOGIN_VIA_EMAIL_REQUIRED":var i=t.email,r=new f({path:t.cont}).updateQuery({email:i});return d.redirect(r.toString());case"SSO":return d.unsafeRedirect(t.sso_url);case"RATELIMIT":return this.fillLoginError(m._("You’ve tried to log in too many times. Please try again in a few minutes."));case"ERROR":var o=t.html_response?new _(t.message):t.message;return g.error(o),this.loginController._clear_pending(!0);case"PASSWORD_EXPIRED":return this.fillLoginError(m._("The password of the account associated with this email has expired.\n             Please login to this account and update its password before pairing."));case"EXPIRED":return d.redirect(t.cont);default:return g.error(m._("There was a problem completing this request."))}},t.prototype.twoFactorSuccess=function(e,t){switch(t.status){case"OK":return this.$twoFactorSeckeyForm.find(".seckey-loading-status").toggle(),this.finishLogin(t);case"EXPIRED":return this.switchFromTwoFactorToLoginError(t.message);case"REQUIRES_ROLE":return this.switchFromTwoFactorToLoginError(t.message);case"ERROR":return g.error(t.message);default:return g.error(m._("There was a problem completing this request."))}},t.prototype.switchFromTwoFactorToLoginError=function(e){this.twoFactorController._clear_pending(!0),this.loginController._clear_pending(!0),this.showLogin(),this.fillLoginError(e),this.setFocusToPassword()},t.prototype.resendCodeSuccess=function(e){switch(e){case"OK":return g.success(m._("We sent you a code. It may take a few minutes to arrive."));case"RATELIMIT":return this.fillTwoFactorError(m._("You’ve tried to log in too many times. Please try again in a few minutes."));case"UNREACHABLE":return this.fillTwoFactorError(m._("We couldn’t reach your phone number. Are you sure it’s correct?"));case"EXPIRED":return this.fillTwoFactorError(m._("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return this.fillTwoFactorError(m._("Unfortunately, your carrier isn’t supported at this time."));case"INVALIDNUMBER":return this.fillTwoFactorError(m._("That isn’t a valid phone number."));case"NOTAMOBILE":return this.fillTwoFactorError(m._("That phone number doesn’t appear to be a valid mobile number."));default:return g.error(m._("There was a problem completing this request."))}},t.prototype.resendCode=function(){return s.WebRequest({url:"/twofactor_resend",data:{backup:this.$twoFactorForm.find("input[name='backup']").val(),mobile_push:this.$twoFactorForm.find("input[name='mobile_push']").val()},success:this.resendCodeSuccess.bind(this),error:function(){return g.error(m._("There was a problem completing this request."))}}),!1},t.prototype.usePhoneInstead=function(){return this.$twoFactorSeckeyForm.hide(),this.$twoFactorPhoneForm.show(),this.$twoFactorForm=this.$twoFactorPhoneForm,this.$twoFactorPhoneForm.hasClass("hide-authenticator")&&this.resendCode(),this.setFocusToTwofactor(),!1},t.prototype.retryU2fChallenge=function(){var e=this;return s.WebRequest({url:"/account/twofactor/u2f_start_authentication",success:function(t){e.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle(),e.signU2fChallenge(t)},error:function(){g.error(m._("There was a problem completing this request."))}}),!1},t.prototype.signU2fChallenge=function(e){var t=this;if(this.browserSupportsU2F()){var i=JSON.parse(e);return o.sign(i.authenticateRequests,function(e){t.$twoFactorSeckeyForm.find(".text-input-input").val(JSON.stringify(e)),t.$twoFactorSeckeyForm.submit()})}},t.prototype.loginViaEmailStart=function(){var e=this;return c.clear_errors(this.$loginForm),s.WebRequest({url:"/ajax_login_via_email_start",data:{login_email:this.$loginForm.find("input[name='login_email']").val(),remember_me:this.isRememberMeChecked()},success:function(){g.success(m._("We emailed you a sign in link. Please check your inbox."))},error:function(t,i,r){return c.fill_errors(e.$loginForm,JSON.parse(r))}}),!1},t.prototype.fillLoginError=function(e){c.fill_errors(this.$loginForm,{login_email:{message_text:e}})},t.prototype.fillTwoFactorError=function(e){c.fill_errors(this.$twoFactorForm,{code:{message_text:e}})},t.prototype.finishLogin=function(e){var i=this.$loginForm.find("input[type='hidden'][name=refresh_token]").val(),r=this.$loginForm.find("input[type='hidden'][name=email_sig]").val();i&&r&&s.WebRequest({url:"/profile_services/link_google_service_with_user",subject_user:e.id,data:{service:l.GOOGLE,refresh_token:i,email_sig:r}});var o=this.multiLogin?t.MULTI_LOGIN_SUCCESS:t.LOGIN_SUCCESS;this.$loginForm.trigger(o,e),this.cont&&this.canRedirect&&d.redirect(this.cont)},t})();return b.LOGIN_SUCCESS="db:login:success",b.MULTI_LOGIN_SUCCESS="db:multilogin:success",b}),function(){define("modules/clean/legacy_pyxl_controllers/login_or_register",["jquery","modules/clean/register_form"],function(e,t){return(function(){function i(i){this.$login_form=i.find(".login-register-login-part"),this.$register_form=i.find(".login-register-register-part"),i.click((function(t){return function(i){if(e(i.target).hasClass("login-register-switch-link"))return i.preventDefault(),t._toggle_forms(),t.$login_form.find(".text-input input:visible").first().focus(),t.$register_form.find(".text-input input:visible").first().focus()}})(this)),this.$register_form.on(t.USER_EXISTS,(function(e){return function(t){var i,r,o;e._toggle_forms(),r=t.prefill;for(i in r)o=r[i],e.$login_form.find(i).val(o);return e.$login_form.find(t.focus).focus()}})(this))}return i.prototype._toggle_forms=function(){return this.$login_form.toggle(),this.$register_form.toggle()},i})()})}.call(this),function(){var e=function(e,i){function r(){this.constructor=e}for(var o in i)t.call(i,o)&&(e[o]=i[o]);return r.prototype=i.prototype,e.prototype=new r,e.__super__=i.prototype,e},t={}.hasOwnProperty;define("modules/clean/legacy_pyxl_controllers/tooltip",["jquery","external/underscore","modules/core/controller_helpers"],function(t,i,r){var o,n,s;return s=[],o=(function(){function e(e,t,o){var n,s,a,c;this.$wrapper=e,this.prompt=this.$wrapper.find(".tooltip-prompt"),this.tooltip=this.$wrapper.find(".tooltip-tooltip"),this.hover_target=this.find_hover_target(),this.position_global=t,this.tooltip_location=o,this.listen(),n=r.clone_element(this.tooltip).appendTo("body"),n.css({position:"static",display:"inline-block"}),s=500,c=n.width()+1,c>s&&(c=s),this.tooltip.css({width:c,position:"absolute",display:"none"}),n.remove(),this.position_global&&this.tooltip.remove().appendTo("body"),this.is_focusable()&&(a=i.uniqueId("tooltip-tooltip-"),this.tooltip.attr({role:"tooltip",id:a}),this.hover_target.attr({tabindex:0,"aria-describedby":a}))}return e.prototype.tooltip_shown=!1,e.prototype.position_global=!1,e.prototype.listen=function(){var e,t,i,r,o;for(r=[this.hover_target,this.tooltip],o=[],t=0,i=r.length;t<i;t++)e=r[t],e.mouseenter((function(e){return function(){return clearTimeout(e.tooltip.data("timeout_id")),e.show_tooltip()}})(this)),e.mouseleave((function(e){return function(){var t;return t=setTimeout(function(){return e.hide_tooltip()},200),e.tooltip.data("timeout_id",t)}})(this)),this.is_focusable()?(e.focusin((function(e){return function(){return clearTimeout(e.tooltip.data("timeout_id")),e.show_tooltip()}})(this)),o.push(e.focusout((function(e){return function(){var t;return t=setTimeout(function(){return e.hide_tooltip()},200),e.tooltip.data("timeout_id",t)}})(this)))):o.push(void 0);return o},e.prototype.find_hover_target=function(){return this.prompt},e.prototype.is_focusable=function(){return!1},e.prototype.show_tooltip=function(e){var t,i,r,o,n,a,c;if(!this.tooltip_shown){for(n=this.position_global?this.hover_target.offset():this.hover_target.position(),i=0,o=s.length;i<o;i++)c=s[i],c.hide_tooltip();return s.push(this),"top"===this.tooltip_location?(a=n.top-this.tooltip.outerHeight()-this.hover_target.height()/2,r=n.left-this.tooltip.outerWidth()/2,t={top:"-=7"}):"left"===this.tooltip_location?(a=n.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,r=n.left-this.tooltip.outerWidth()-2,t={left:"-=7"}):"bottom"===this.tooltip_location?(a=n.top+this.hover_target.outerHeight(),r=n.left-this.tooltip.outerWidth()/2+this.hover_target.outerWidth()/2,t={top:"+=7"}):(a=n.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,r=n.left+this.hover_target.width()+2,t={left:"+=7"}),this.tooltip.css({top:a,left:r}).show().animate(t,50),this.tooltip_shown=!0}},e.prototype.hide_tooltip=function(){var e;if(this.tooltip_shown)return clearTimeout(this.tooltip.data("timeout_id")),this.tooltip.hide(),this.tooltip_shown=!1,e=s.indexOf(this),e!==-1?s.splice(e,1):void 0},e})(),n=(function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.find_hover_target=function(){return this.prompt.find(".sprite")},i.prototype.is_focusable=function(){return!0},i})(o),{DBTooltip:o,InfoTooltip:n}})}.call(this),function(){define("modules/clean/legacy_ui_button",["jquery"],function(e){return function(){var t;return t=e(document),e(document).on("mouseover.ui-button",".ui-button",function(){return e(this).addClass("over")}).on("mouseout.ui-button",".ui-button",function(){return e(this).removeClass("over")}).on("mousedown.ui-button",".ui-button",function(){return e(this).addClass("down")}).on("click.ui-button",".ui-button",function(){var i;return i=e(this),i.hasClass("ui-button-dropdown")&&(i.hasClass("active")?t.trigger("dropdownClosed",[1]):t.trigger("dropdownOpened",[1])),i.toggleClass("active")}),t.on("click.ui-button",function(i){var r,o,n;return r=e(i.target),o=r.closest(".ui-button.active"),n=0,e(".ui-button.active").not(o).each(function(){var t;return t=e(this),t.hasClass("active")&&t.hasClass("ui-button-dropdown")&&(n+=1),t.removeClass("active")}),t.trigger("dropdownClosed",[n])}).on("mouseup.ui-button",function(){return e(".ui-button.down").removeClass("down")})}})}.call(this),function(){define("modules/clean/mailcheck",["jquery","modules/core/html","modules/core/i18n"],function(e,t,i){var r;return r=i._,(function(){function e(e,t,i){var r;this.$input=e,this.$suggestion_container=t,null==i&&(i={}),this.checkInput(),r=i.livecheck===!0?"keyup blur":"blur",this.$input.on(r,this.checkInput.bind(this))}return e.DOMAINS=["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],e.WHITELIST_REGEXS=[/ymail.com/,/yahoo\.co\./,/yahoo\.com\./,/hotmail\.co\./,/hotmail\.com\./,/gmx\.net/,/gmx\.at/,/gmx\.ch/,/gmx\.com/,/mail\.com/,/web\.com/],e.THRESHOLD=2,e.prototype.checkInput=function(){var e;e=this.suggest(this.$input.val()),e?this.populate(e):this.clear()},e.prototype.populate=function(e){var i,o,n;return n=t.escape(e.local).toHTML(),i=t.escape(e.domain).toHTML(),o=n+"@<span class='email_warning_area'>"+i+"</span>",this.$suggestion_container.html(new t(r("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:o})).toHTML()),this.$suggestion_container.show(),this.$suggestion_container.on("click",(function(t){return function(){return t.$input.val(e.full),t.clear()}})(this))},e.prototype.clear=function(){return this.$suggestion_container.empty(),this.$suggestion_container.hide()},e.prototype.suggest=function(e){var t,i,r,o;if(null==e&&(e=""),e.length)return e=e.toLowerCase(),!!(o=this.splitEmail(e))&&(r=o.local,i=o.domain,!this.whitelistedDomain(i)&&(t=this.findClosestDomain(i),!!t&&{local:r,domain:t,full:r+"@"+t}))},e.prototype.whitelistedDomain=function(t){var i,r,o,n;for(n=e.WHITELIST_REGEXS,i=0,r=n.length;i<r;i++)if(o=n[i],o.test(t))return!0;return!1},e.prototype.splitEmail=function(e){var t;return t=e.split("@"),2===t.length&&{local:t[0],domain:t[1]}},e.prototype.findClosestDomain=function(t){var i,r,o,n,s,a,c;for(a=99,r=null,c=e.DOMAINS,n=0,s=c.length;n<s;n++)i=c[n],o=this.stringDistance(t,i),o<a&&(a=o,r=i);return!!(r&&r!==t&&a<=e.THRESHOLD)&&r},e.prototype.stringDistance=function(e,t){var i,r,o,n,s,a;if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(i=0,s=0,a=0,o=0,n=5;i+s<e.length&&i+a<t.length;){if(e.charAt(i+s)===t.charAt(i+a))o++;else for(s=0,a=0,r=0;r<n;){if(i+r<e.length&&e.charAt(i+r)===t.charAt(i)){s=r;break}if(i+r<t.length&&e.charAt(i)===t.charAt(i+r)){a=r;break}r++}i++}return(e.length+t.length)/2-o},e})()})}.call(this),define("modules/clean/marketing_tracker",["require","exports","modules/core/exception"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){var t=this;this.push=function(r){var o=r.dataLayer;return t.src=r.src,i.assert(!!t.src,"MarketingTracker.push requires src"),e.el||(e.el=t.load(t.src)),!e.ready&&e.el?e.el.addEventListener("load",function(){if(e.ready=!0,e&&e.el)return e.el.contentWindow.postMessage(o,"https://marketing.dropbox.com")}):e.el.contentWindow.postMessage(o,"https://marketing.dropbox.com"),t},this.load=function(e){var t=document.createElement("iframe");return t.style.display="none",t.hidden=!0,t.src=e,t.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(t),t},e.el=null,e.ready=!1}return e})();r.ready=!1,t.MarketingTracker=new r}),function(){define("modules/clean/photos/legacy_thumb_loader",["jquery","modules/clean/photos/batch_thumb_loader","modules/clean/sprite"],function(e,t,i){return{MAX_THUMB_BATCH_REQUESTS:24,batch_load_thumbs:function(r,o,n,s){var a,c,l,h,u,p,d,_,m,g;for(g=e.grep(r,function(t){return e(t).data("src")}),this.img_map={},h=0,p=g.length;h<p;h++)l=g[h],_=String(e(l).data("src")),null==(c=this.img_map)[_]&&(c[_]=[]),this.img_map[_].push(l);for(this.instance?this.instance.reset({batch_size:o,batch_logger:s}):this.instance=new t({batch_size:o,max_parallel_requests:this.MAX_THUMB_BATCH_REQUESTS,on_batch:(function(t){return function(i){var r,o,n,s,a;for(s=[],o=0,n=i.length;o<n;o++)a=i[o],r=e(t.img_map[a]),r.data("src",null),s.push(r.data("loading-src",a));return s}})(this),batch_logger:s}),[],u=0,d=g.length;u<d;u++)l=g[u],a=e(l),m=a.data("src"),this.instance.queue_thumb(m,function(e,t,r,o){if(o||t.data("loading-src"))return t.data("loading-src",null),0===r.indexOf("data:image")?(t.attr("src",r),"function"==typeof n?n(t[0]):void 0):(t.error(function(){return t.attr("src",t.data("fail-src")||i.SPACER)}),t.load(function(){return"function"==typeof n?n(t[0]):void 0}),t.attr("src",r))}.bind(this,m,a));return this.instance.flush(),g.length},clear_all_pending_batches:function(){var e;return null!=(e=this.instance)?e.clear():void 0}}})}.call(this),define("modules/clean/profile_services/auth_callback_handler",["require","exports","modules/core/browser","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/core/i18n"],function(e,t,i,r,o,n,s){"use strict";function a(e,t,i){e.success&&e.user_id?l(t.cont||"/home"):e.success?h({emailSig:e.email_sig,refreshToken:e.refresh_token,profile:e.profile},t,i):d({errMsg:e.err_msg,rememberMe:e.remember_me,pairUser:e.pair_user,profile:e.profile,emailSig:e.email_sig,refreshToken:e.refresh_token},t.cont||"/home",i)}function c(e,t){if(e.success)r.success(s._("Log in successful!")),n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success",value:"success"}}),t.onSuccess(),t.redirectOnSuccess&&i.redirect(t.cont);else if(n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error",value:e.err_msg}}),"access_denied"===e.err_msg)r.error(s._("You need to accept Google’s request in order to log in."));else if("emails_do_not_match"===e.err_msg)r.error(s._("We couldn’t find a Dropbox account matching that email."));else if("google_login_not_allowed"===e.err_msg)r.error(s._("Google sign in is disabled. Sign in with your Dropbox password or ask your                      Dropbox admin for help."));else if("sso_required"===e.err_msg)r.error(s._("Your team has single sign-on. Sign in with your Dropbox password or ask your                      Dropbox admin for help."));else if("tfa_required"===e.err_msg){var a=new o({path:"/verify_code",query:{cont:t.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString();i.redirect(a)}else if("disabled_account"===e.err_msg)r.error(s._("This account is disabled."));else if("invalid_pair_target"===e.err_msg)r.error(s._("That account can’t be paired. Paired account must be a personal account."));else if("already_paired"===e.err_msg)r.error(s._("That account is already paired to another account."));else if("error_pairing"===e.err_msg)r.error(s._("There was an error pairing."));else if("not_verified"===e.err_msg){var a=new o({path:"/show_password_form",query:{cont:t.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString();i.redirect(a)}else r.error(s._("We couldn’t log you in with Google.  Try again?"))}function l(e){i.redirect(e)}function h(e,t,r){var n={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,email_sig:e.emailSig,refresh_token:e.refreshToken,cont:t.cont,signup_tag:t.signupTag};null!=t.k&&(n.k=t.k),null!=t.eh&&(n.eh=t.eh),
null!=t.signupEndpoint&&(n.signup_endpoint=t.signupEndpoint),r&&p(r.form,r.newAccount,n),t.canRedirect&&i.redirect(new o({path:"/third_party_signup",query:n}).toString())}function u(e,t){e.success?(r.success(s._("Successfully connected to your Google calendar")),t.onSuccess()):r.error(s._("Couldn’t connect to your Google Calendar"))}function p(e,t,i){e.trigger(t,i)}function d(e,t,n){if("tfa_required"===e.errMsg){var a={cont:t};null!=e.pairUser&&(a.pair_user=e.pairUser.toString()),null!=e.rememberMe&&(a.remember_me=e.rememberMe.toString()),i.redirect(new o({path:"/verify_code",query:a}).toString())}else if("sso_required"===e.errMsg){var a={email:e.profile.email,cont:t};i.redirect(new o({path:"/login",query:a}).toString())}else"user_exists"===e.errMsg?(n&&p(n.form,n.userExists,{focus:"input[name=login_password]",prefill:{".login-email":e.profile.email,"input[type='hidden'][name=refresh_token]":e.refreshToken,"input[type='hidden'][name=email_sig]":e.emailSig}}),r.error(s._("This email address is already taken. Please sign in."))):r.error(s._("Unable to link to Google. Please refresh the page to try again."))}Object.defineProperty(t,"__esModule",{value:!0}),t.handleRegisterResponse=a,t.handleLoginResponse=c,t.handleCalendarLinkResponse=u}),function(){define("modules/clean/react/recaptcha_challenge",["jquery","external/react","modules/clean/react/form_error_mixin","modules/clean/react/input","modules/core/i18n","modules/clean/static_urls"],function(e,t,i,r,o,n){var s,a,c,l,h;return a=o._,h=n.static_url,s=r.text,l=t.DOM,c=t.createElement,t.createClass({displayName:"RecaptchaChallenge",mixins:[i],getDefaultProps:function(){return{public_key:"",errorWrapperClassName:"text-input-error-wrapper",variant:"standard",onInputChange:null}},componentDidMount:function(){var t;return t=this.props.public_key,e.getScript("https://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){return Recaptcha.create(t,"recaptcha_widget",{theme:"custom"})})},handleReloadLinkClick:function(){return Recaptcha.reload()},handleSwitchTypeToAudioLinkClick:function(){return Recaptcha.switch_type("audio")},handleSwitchTypeToImageLinkClick:function(){return Recaptcha.switch_type("image")},handleHelpLinkClick:function(){return Recaptcha.showhelp()},_renderButtons:function(){return l.div({className:this.props.variant+" recaptcha-buttons"},l.a({className:"recaptcha-button recaptcha-reload",onClick:this.handleReloadLinkClick},l.img({src:h("/static/images/icons/captcha-reload-vflqH90Ce.png")})),l.a({className:"recaptcha-button recaptcha_only_if_image",onClick:this.handleSwitchTypeToAudioLinkClick},l.img({src:h("/static/images/icons/captcha-audio-vfl_VBPgQ.png")})),l.a({className:"recaptcha-button recaptcha_only_if_audio",onClick:this.handleSwitchTypeToImageLinkClick},l.img({src:h("/static/images/icons/captcha-words-vfl-bt9Xw.png")})),l.a({className:"recaptcha-button recaptcha-show-help",onClick:this.handleHelpLinkClick},l.img({src:h("/static/images/icons/captcha-help-vfleUYtSD.png")})))},_renderRecaptchaResponseInput:function(){return c(s,{id:"recaptcha_response",name:"recaptcha_response",className:"login-text-input","disable-errors":!0,placeholder:a("Type the text"),onChange:this.props.onInputChange})},_renderDummyInput:function(){return l.input({type:"hidden",id:"recaptcha_response_field"})},_renderStandard:function(){var e;return e=this.renderErrorIfEnabled(),l.div({id:"recaptcha_widget",className:"standard recaptcha-container"},e,l.div({id:"recaptcha_image",className:"standard login-recaptcha-challenge-container"}),this._renderRecaptchaResponseInput(),this._renderButtons(),this._renderDummyInput())},_renderSmall:function(){var e;return e=this.renderErrorIfEnabled(),l.div({id:"recaptcha_widget",className:"small recaptcha-container"},e,l.div({id:"recaptcha_image",className:"small login-recaptcha-challenge-container"}),this._renderButtons(),this._renderRecaptchaResponseInput(),this._renderDummyInput())},render:function(){return"standard"===this.props.variant?this._renderStandard():"small"===this.props.variant?this._renderSmall():void 0},reload:function(){return Recaptcha.reload()}})})}.call(this),define("modules/clean/register_form",["require","exports","jquery","external/cyfd","external/pixie","external/underscore","modules/clean/captcha","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/em_string","modules/clean/form_util/name_parser","modules/clean/mailcheck","modules/clean/profile_services/auth_callback_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/constants/pixie","modules/core/accessible_announce","modules/core/browser"],function(e,t,i,r,o,n,s,a,c,l,h,u,p,d,_,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=new o.Pixie(_).get_specter();f.start();var v=function(){return r.cfsubmit()},b=(function(){function e(e,t,r){var o;if(this.$form=i(t),this.$form.find(".recaptcha_v2_challenge").length>0){var n=i(this.$form.find(".recaptcha_v2_challenge"));this.$captchaComponent=new s(this.$form,n.attr("id"),null,"/ajax_needs_business_signup_captcha","email",e,!0)}else this.$captchaComponent=new s(this.$form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_business_signup_captcha","email",e);r&&(o={message_text:r}),this.$captchaComponent.captcha_display_handler(o),this.$form.on("submit",function(e){return v()})}return e})();t.RegisterNamesAndCredentialsWithCaptcha=b;var y=(function(){function e(e,t,r,o,n,l,u,_,m){var g=this;this._handle_google_callback=this._handle_google_callback.bind(this),this._before_submit=this._before_submit.bind(this),this._on_register_success=this._on_register_success.bind(this),this._on_register_error=this._on_register_error.bind(this),this._animate_form=this._animate_form.bind(this),this._index_error_handler=this._index_error_handler.bind(this),this._combined_name_handler=this._combined_name_handler.bind(this),this.$registerFormContainer=e,this.canRedirect=r,this.showForm=o,this.clientSideValidation=n,this.customErrorHandler=l,this.combinedName=u,this.lastNameGoesFirst=_,this.signupEndpoint=m,this.$registerForm=this.$registerFormContainer.find(".register-form");var f;if("index"===this.customErrorHandler&&(f=this._index_error_handler,this.$registerForm.on("click change","input",this._index_clear_error_handler)),this.registerController=new a(this.$registerForm,this._before_submit,{client_side_validation:this.clientSideValidation,error_handler:f}),this.cont=this.$registerForm.find("input[name='cont']").val(),this.$registerForm.find(".login-button, .auth-google").prop("disabled",!1),this.$registerForm.find(".login-button.disabled-button").prop("disabled",!0),this.$registerForm.find(".recaptcha_v2_challenge").length>0){var v=i(this.$registerForm.find(".recaptcha_v2_challenge"));this.$captchaComponent=new s(this.$registerForm,v.attr("id"),null,"/ajax_needs_signup_captcha","email",t,!0)}else this.$captchaComponent=new s(this.$registerForm,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_signup_captcha","email",t);var b=this.$registerForm.find("label[for='tos_agree']"),y=parseInt(b.css("font-size"),10);if(new c(b.text()).length*y>200&&this.$registerForm.find(".checkbox").removeClass("checkbox-inline"),this.$registerForm.on(a.SUCCESS_EVENT,this._on_register_success),this.$registerForm.on(a.ERROR_EVENT,this._on_register_error),this.showForm){if(this.$registerForm.find("input[type='hidden'][name='is_third_party_auth']").val()){var w=function(e,t){return!i(t).val()};this.$registerFormContainer.find("input").filter(":visible").filter(w).first().focus()}this.$registerForm.is(":visible")&&this.$captchaComponent.captcha_display_handler()}else this.$registerForm.find(".login-button").on("click",function(e){g.$registerFormContainer.hasClass("form_shown")||(e.preventDefault(),g._animate_form())});this.$registerForm.find(".auth-google").click(function(e){var t=function(e){g._handle_google_callback(e)},i="true"===e.target.getAttribute("data-third-party-no-popup");(new d.ProfileServicesLinkingHandler).auth_service_create_user_if_needed(p.GOOGLE,t,"register_form",!i)}),"small"===t?(this.$registerForm.find(".bubble-dropdown-container .bubble-dropdown").css({visibility:"hidden"}),this.$registerForm.find(".password-input-meter").css({cursor:"default"})):new h(this.$registerForm.find(".input-email"),this.$registerForm.find(".email-suggestion"),{livecheck:!1});var F=this.$registerForm.find("input[type='checkbox'][name='tos_agree']");F.length>0&&F.on("change",function(e){var t=g.$registerForm.find(".agree .error-message");t.length>0&&t[0].remove()})}return e.prototype._handle_google_callback=function(t){var i=this.$registerForm.find("input[type='hidden'][name='cont']").val(),r=this.$registerForm.find("input[type='hidden'][name='signup_tag']").val(),o=this.$registerForm.find("input[type='hidden'][name='k']").val(),n=this.$registerForm.find("input[type='hidden'][name='eh']").val();u.handleRegisterResponse(t,{cont:i,signupTag:r,canRedirect:this.canRedirect,k:o,eh:n,signupEndpoint:this.signupEndpoint},{form:this.$registerForm,newAccount:e.NEW_ACCOUNT_FROM_3RD_PARTY,userExists:e.USER_EXISTS})},e.prototype._before_submit=function(){this.combinedName===!0&&this._combined_name_handler(),v(),this.registerController.add_additional_data({specter_signup_tm:f.dump(),signup_endpoint:this.signupEndpoint})},e.prototype._on_register_success=function(t,i){this.$registerForm.trigger(e.REGISTER_SUCCESS,i),this.canRedirect&&(this.cont?g.redirect(this.cont):i.redirect_url&&g.redirect(i.redirect_url))},e.prototype._on_register_error=function(e,t){this.$captchaComponent.captcha_display_handler(null!=t?t.recaptcha_response:void 0)},e.prototype._animate_form=function(){var e=this;this.$registerFormContainer.hasClass("form_shown")||i.when(this.$registerFormContainer.animate({height:this.$registerForm.height()},{easing:"easeInOutCubic",duration:500})).done(function(){e.$registerFormContainer.addClass("form_shown"),e.$registerFormContainer.filter(":input").filter(":visible").first().focus(),e.$captchaComponent.captcha_display_handler()})},e.prototype.fill=function(e){var t=this;n.each(e,function(e,i){return t.$registerForm.find("[name="+i+"]").val(e)})},e.prototype._index_error_handler=function(e){this.$registerFormContainer.find(".register-form__errors").remove();var t=i("<ul />").addClass("register-form__errors"),r=[];for(var o in e)if(e.hasOwnProperty(o)){var n=e[o],s=n.message_text||n.message_html;r.push(s),i("<li />").addClass("register-form__error").html(s).appendTo(t),this.$registerForm.find(".input-"+o).addClass("text-input--error"),"tos_agree"===o&&this.$registerForm.find(".checkbox-inline.agree").addClass("checkbox-inline--error"),this.combinedName&&"fname"===o&&(this.$registerForm.find(".input-fullname").addClass("text-input--error"),this.$registerForm.find("input[name='fullname']").addClass("input-error")),this.$registerForm.find("input[name='"+o+"']").addClass("input-error")}return this.$registerFormContainer.append(t),m.AccessibleAnnounce.assertive(r.join(". "))},e.prototype._index_clear_error_handler=function(e){var t=i(e.target);t.removeClass("input-error"),"checkbox"===t.attr("type")?t.parents(".checkbox-inline--error").removeClass("checkbox-inline--error"):t.parents(".text-input--error").removeClass("text-input--error")},e.prototype._combined_name_handler=function(){var e=this.$registerFormContainer.find('input[name="fullname"]'),t=this.$registerFormContainer.find('input[name="fname"]'),i=this.$registerFormContainer.find('input[name="lname"]'),r=l.splitFullName(e.val()),o=r[0],n=r[1];this.lastNameGoesFirst!==!0?(t.val(o),void 0!==n&&n!==o&&i.val(n)):(i.val(o),void 0!==n&&n!==o&&t.val(n))},e})();y.REGISTER_SUCCESS="db:register:success",y.NEW_ACCOUNT_FROM_3RD_PARTY="db:register:new_account_from_3rd_party",y.USER_EXISTS="db:register:user_exists",t.RegisterForm=y}),function(){define("modules/clean/shared_link_error",["jquery","modules/clean/ajax"],function(e,t){return(function(){function i(){e("#broken-share-article").on("click",function(){return t.WebRequest({url:"/shared_link_error_log",data:{evt:r}})})}var r;return r="click-sharing-article",i})()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sso_login_checks",["modules/clean/ajax"],function(t){var i;return i=(function(){function i(t,i,r,o){this.$email_input=t,this.show_sso_fn=i,this.hide_sso_fn=r,this.should_trigger_check=null==o||o,this.check_sso_state=e(this.check_sso_state,this),this._trigger_check_sso_state=e(this._trigger_check_sso_state,this),this.should_trigger_check&&(this._trigger_check_sso_state(),this.$email_input.on("input keyup change",this._trigger_check_sso_state))}return i._sso_check_in_flight={},i._sso_check_cache={},i.prototype._trigger_check_sso_state=function(){var e;return e=this.$email_input.val(),this.check_sso_state(e)},i.prototype.check_sso_state=function(e){var r,o;return o=e.trim(),o.match(/^[^@\s]+@[^@\s]+\.[A-Za-z]{2,}$/)?(r=o.toLowerCase(),r in i._sso_check_cache?this._handle_sso_state(i._sso_check_cache[r]):i._sso_check_in_flight[r]?void 0:(i._sso_check_in_flight[r]=!0,t.WebRequest({url:"/sso_state",data:{email:o},success:(function(t){return function(o){return o=JSON.parse(o),delete i._sso_check_in_flight[r],i._sso_check_cache[r]=o.user_sso_state,t.should_trigger_check&&t.$email_input.val()!==e?t._trigger_check_sso_state():t._handle_sso_state(o.user_sso_state)}})(this),error:(function(e){return function(){return delete i._sso_check_in_flight[r],e.hide_sso_fn()}})(this)}))):this.hide_sso_fn()},i.prototype._handle_sso_state=function(e){return"required"===e?this.show_sso_fn(!1):"optional"===e?this.show_sso_fn(!0):this.hide_sso_fn()},i})(),{SsoLoginChecks:i}})}.call(this),function(){var e=function(e,i){function r(){this.constructor=e}for(var o in i)t.call(i,o)&&(e[o]=i[o]);return r.prototype=i.prototype,e.prototype=new r,e.__super__=i.prototype,e},t={}.hasOwnProperty;define("modules/clean/upsell/header_bubble_or_link",["modules/clean/header_bubble","modules/clean/upsell/exception","modules/clean/upsell/upsell_controller"],function(t,i,r){return(function(t){function o(e,t){var n,s;this.$el=e,this.options=t;try{s=new r(this.$el.find(".confirm-button"),this.$el.find(".dismiss-button"),this.options),s.log_impression(),o.__super__.constructor.apply(this,arguments)}catch(e){n=e,i.reportJsControllerException({err:n,js_controller_options:this.options})}}return e(o,t),o})(t)})}.call(this),function(){define("modules/core/ordered_dictionary",[],function(){return(function(){function e(e,t){this.list=e,this.dict=t}return e.list=[],e.dict={},e.prototype.push=function(e,t){this.list.push(e),this.dict[e]=t},e.prototype.remove=function(e){this.list.removeItem(e),delete this.dict[e]},e.prototype.indexOfKey=function(e){return this.list.indexOf(e)},e.prototype.keyAtIndex=function(e){return this.list[e]},e.prototype.valueFromKey=function(e){return this.dict[e]},e.prototype.valueAtIndex=function(e){return this.dict[this.list[e]]},e.prototype.getValues=function(){var e;return function(){var t,i,r,o;for(r=this.list,o=[],t=0,i=r.length;t<i;t++)e=r[t],o.push(this.dict[e]);return o}.call(this)},e.prototype.length=function(){return this.list.length},e.prototype.insertAtIndex=function(e,t,i){return this.list.splice(e,0,t),this.dict[t]=i},e})()})}.call(this);
//# sourceMappingURL=pkg-legacy-ab.min.js-vfl3HpNR_.map